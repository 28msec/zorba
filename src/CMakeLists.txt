INCLUDE(../cmake_modules/AddSrcSubfolder.cmake)

INCLUDE_DIRECTORIES(BEFORE ${CMAKE_CURRENT_SOURCE_DIR})
INCLUDE_DIRECTORIES(BEFORE ${CMAKE_SOURCE_DIR}/external) # must be removed if pthread.h is removed from util/rwlock.h/cpp

SET(ZORBA_SRCS)

ADD_SRC_SUBFOLDER(ZORBA_SRCS api API_SRCS )
ADD_SRC_SUBFOLDER(ZORBA_SRCS compiler COMPILER_SRCS)
FOREACH (SRCS ${COMPILER_BUILD_SRCS})
    LIST(APPEND ZORBA_SRCS ${SRCS})
ENDFOREACH (SRCS)

ADD_SRC_SUBFOLDER(ZORBA_SRCS system SYSTEM_SRCS)
ADD_SRC_SUBFOLDER(ZORBA_SRCS context CONTEXT_SRCS)
ADD_SRC_SUBFOLDER(ZORBA_SRCS errors	ERRORS_SRCS)
ADD_SRC_SUBFOLDER(ZORBA_SRCS functions FUNCTIONS_SRCS)
ADD_SRC_SUBFOLDER(ZORBA_SRCS runtime RUNTIME_SRCS)
ADD_SRC_SUBFOLDER(ZORBA_SRCS store STORE_SRCS)
ADD_SRC_SUBFOLDER(ZORBA_SRCS types TYPES_SRCS)
ADD_SRC_SUBFOLDER(ZORBA_SRCS util UTIL_SRCS)

IF (MSVC)
	ADD_LIBRARY(zorba ${ZORBA_SRCS})
	IF (BUILD_STATIC_LIBRARY)
		ADD_LIBRARY(zorba_static ${ZORBA_SRCS})
	ENDIF (BUILD_STATIC_LIBRARY)
ELSE (MSVC)
	ADD_LIBRARY(zorba SHARED ${ZORBA_SRCS})
	IF (BUILD_STATIC_LIBRARY)
		ADD_LIBRARY(zorba_static STATIC ${ZORBA_SRCS})
	ENDIF (BUILD_STATIC_LIBRARY)
ENDIF (MSVC)

TARGET_LINK_LIBRARIES(zorba ${requiredlibs})

IF (BUILD_STATIC_LIBRARY)
	TARGET_LINK_LIBRARIES(zorba_static ${requiredlibs})
ENDIF (BUILD_STATIC_LIBRARY)
