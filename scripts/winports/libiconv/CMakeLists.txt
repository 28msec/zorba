CMAKE_MINIMUM_REQUIRED(VERSION 2.6)
PROJECT(libiconv)

INCLUDE_DIRECTORIES(${CMAKE_CURRENT_SOURCE_DIR}/libcharset)
INCLUDE_DIRECTORIES(${CMAKE_CURRENT_SOURCE_DIR}/libcharset/include)

CONFIGURE_FILE(${CMAKE_CURRENT_SOURCE_DIR}/libcharset/config.h.in ${CMAKE_CURRENT_SOURCE_DIR}/libcharset/config.h)
CONFIGURE_FILE(${CMAKE_CURRENT_SOURCE_DIR}/libcharset/include/localcharset.h.in ${CMAKE_CURRENT_SOURCE_DIR}/libcharset/include/localcharset.h)

FILE(APPEND ${CMAKE_CURRENT_SOURCE_DIR}/libcharset/config.h "\n#define LIBDIR \"\"\n")
FILE(APPEND ${CMAKE_CURRENT_SOURCE_DIR}/libcharset/config.h "\n#define HAVE_WORKING_O_NOFOLLOW 1\n")

ADD_LIBRARY(charset libcharset/lib/localcharset.c)

INSTALL(TARGETS charset DESTINATION lib)
INSTALL(FILES ${CMAKE_CURRENT_SOURCE_DIR}/libcharset/include/localcharset.h DESTINATION include)

ADD_DEFINITIONS(-DLIBICONV_PLUG)

INCLUDE_DIRECTORIES(${CMAKE_CURRENT_SOURCE_DIR}/include)
INCLUDE_DIRECTORIES(${CMAKE_CURRENT_SOURCE_DIR}/lib)

CONFIGURE_FILE(${CMAKE_CURRENT_SOURCE_DIR}/config.h.in ${CMAKE_CURRENT_SOURCE_DIR}/config.h)
CONFIGURE_FILE(${CMAKE_CURRENT_SOURCE_DIR}/include/iconv.h.in ${CMAKE_CURRENT_SOURCE_DIR}/include/iconv.h)
CONFIGURE_FILE(${CMAKE_CURRENT_SOURCE_DIR}/lib/config.h.in ${CMAKE_CURRENT_SOURCE_DIR}/lib/config.h)

FILE(APPEND ${CMAKE_CURRENT_SOURCE_DIR}/config.h "\n#define ICONV_CONST \"\"\n")

ADD_LIBRARY(iconv lib/iconv.c)

INSTALL(TARGETS iconv DESTINATION lib)
INSTALL(FILES ${CMAKE_CURRENT_SOURCE_DIR}/include/iconv.h DESTINATION include)
