import string
import sys

ctest_failed_file = "@zorbaBuildDir@/Testing/Temporary/LastTestsFailed.log"
ctest_log_file = "@zorbaBuildDir@/Testing/Temporary/LastTest.log"


def has_testing ( s ):
    yes = string.find ( s, 'Testing:' )
    yes2 = s.find ( 'w3c_testsuite' )
    return yes > 0 and yes2 > 0 

def get_test_name ( s ) :
    words = string.split ( s, '/' )
    l = len ( words )
    name = words[ l -1]
    name = string.strip ( name )
    return name

try:
    failedfile = open ( ctest_failed_file, 'r' )
    failed = True
except IOError :
    print "CTest failed log not found"
    print "Assuming that CTest was run and that there were no failures"
    failed = False

failures = set()
if failed :
    for line in failedfile:
        i = string.find ( line, "w3c_testsuite" )
        if i > 0 :
            name = get_test_name ( line )
            print name
            failures.add ( name )

try:
    file = open ( ctest_log_file, 'r' )
except IOError :
    print "Ctest log file not found"
    print "Run CTest before this script"
    sys.exit ( 1 )

for line in file:
    if has_testing ( line ):
        name = get_test_name ( line )
        if  name in failures :
            print '<test-case name="%s" result="failed" />' % name
        else :
            print '<test-case name="%s" result="passed" />' % name
