Iterator tree for main query:
<flwor::TupleStreamIterator>
  <flwor::LetIterator>
    <LetVariable name="y" materialize="true"/>
    <flwor::CountIterator>
      <flwor::ForIterator>
        <ForVariable name="x"/>
        <flwor::LetIterator>
          <LetVariable name="$$opt_temp_2" materialize="true"/>
          <flwor::ForIterator>
            <ForVariable name="a"/>
            <flwor::TupleSourceIterator/>
            <FnConcatIterator>
              <SingletonIterator value="xs:integer(1)"/>
              <SingletonIterator value="xs:integer(2)"/>
            </FnConcatIterator>
          </flwor::ForIterator>
          <CreateInternalIndexIterator name="xs:QName(,,tempIndex0)">
            <flwor::FLWORIterator>
              <ForVariable name="$$opt_temp_0">
                <UDFunctionCallIterator function="local:foo">
                  <ForVarIterator varname="a"/>
                </UDFunctionCallIterator>
              </ForVariable>
              <ReturnClause>
                <ValueIndexEntryBuilderIterator>
                  <ForVarIterator varname="$$opt_temp_0"/>
                  <ForVarIterator varname="$$opt_temp_0"/>
                </ValueIndexEntryBuilderIterator>
              </ReturnClause>
            </flwor::FLWORIterator>
          </CreateInternalIndexIterator>
        </flwor::LetIterator>
        <FnConcatIterator>
          <ElementIterator>
            <SingletonIterator value="xs:QName(,,a)"/>
            <TextIterator>
              <SingletonIterator value="xs:string(1)"/>
            </TextIterator>
          </ElementIterator>
          <ElementIterator>
            <SingletonIterator value="xs:QName(,,a)"/>
            <TextIterator>
              <SingletonIterator value="xs:string(2)"/>
            </TextIterator>
          </ElementIterator>
          <ElementIterator>
            <SingletonIterator value="xs:QName(,,a)"/>
            <TextIterator>
              <SingletonIterator value="xs:string(3)"/>
            </TextIterator>
          </ElementIterator>
        </FnConcatIterator>
      </flwor::ForIterator>
    </flwor::CountIterator>
    <flwor::FLWORIterator>
      <ForVariable name="z">
        <ProbeIndexPointValueIterator>
          <SingletonIterator value="xs:QName(,,tempIndex0)"/>
          <CastIterator type="xs:integer">
            <FnDataIterator>
              <ForVarIterator varname="x"/>
            </FnDataIterator>
          </CastIterator>
        </ProbeIndexPointValueIterator>
      </ForVariable>
      <ReturnClause>
        <ForVarIterator varname="z"/>
      </ReturnClause>
    </flwor::FLWORIterator>
  </flwor::LetIterator>
  <FnConcatIterator>
    <ElementIterator>
      <SingletonIterator value="xs:QName(,,res)"/>
      <EnclosedIterator attr_cont="false">
        <FnConcatIterator>
          <ForVarIterator varname="x"/>
          <ForVarIterator varname="w"/>
          <FnCountIterator>
            <LetVarIterator varname="y"/>
          </FnCountIterator>
          <FnSumIntegerIterator>
            <LetVarIterator varname="y"/>
          </FnSumIntegerIterator>
        </FnConcatIterator>
      </EnclosedIterator>
    </ElementIterator>
    <SingletonIterator value="xs:string(
)"/>
  </FnConcatIterator>
</flwor::TupleStreamIterator>

Iterator tree for local:foo:
<flwor::FLWORIterator>
  <ForVariable name="x">
    <LetVarIterator varname="x"/>
  </ForVariable>
  <ReturnClause>
    <FnConcatIterator>
      <SpecificNumArithIterator_MultiplyOperation_INTEGER>
        <ForVarIterator varname="x"/>
        <ForVarIterator varname="x"/>
      </SpecificNumArithIterator_MultiplyOperation_INTEGER>
      <FunctionTraceIterator>
        <ForVarIterator varname="x"/>
      </FunctionTraceIterator>
    </FnConcatIterator>
  </ReturnClause>
</flwor::FLWORIterator>

