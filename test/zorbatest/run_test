#!/bin/sh

TEST=$1
DIR=`dirname $TEST`
echo Running test $TEST
cd $DIR
mkdir -p $SNAPSHOT/test_results/$DIR
TMP=`mktemp /tmp/zorbatest.XXXXXX`
OUTDIR=$SNAPSHOT/test_results/$DIR
OUT=$OUTDIR/result.txt
./`basename $TEST` >$TMP
{ if test $? -eq 0; then echo SUCCESS; else echo FAILURE; fi; } > $OUT
cat $TMP >>$OUT
rm -f $TMP

for f in `find . -type f -o -type l`; do
  test -f $TESTS/tests/$DIR/$f || mv $f $OUTDIR
done
