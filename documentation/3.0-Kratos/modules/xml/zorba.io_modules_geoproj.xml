<xqdoc:xqdoc xmlns:xqdoc="http://www.xqdoc.org/1.0"><xqdoc:control><xqdoc:date>2013-12-04T01:28:38.942159+01:00</xqdoc:date><xqdoc:version>1.0</xqdoc:version></xqdoc:control><xqdoc:module type="library"><xqdoc:uri>http://zorba.io/modules/geoproj</xqdoc:uri><xqdoc:name>geoproj</xqdoc:name><xqdoc:comment><xqdoc:description> <p>Geographic projection module.</p>
 <p>Forward and inverse projection from WGS84 lat-long coordinates to Oblique Mercator x-y projection.</p>
 <p>Oblique Mercator projection is a sphere to cylinder projection.</p>
 <p>This projection results in a conformal output, meaning the shape of small areas is preserved,
 no matter the distance from the origin. But it is not equal area, meaning the area size increases heavily
 when getting closer to North or South. The area size increases with the same amount on x and y axes,
 so the relative shape remains almost the same.</p>
 <p>Mercator projection is the oldest projection, and it is still widely used because it produces a rectangular map.</p>
 <p>This projection is used in Google Maps because of its conformal output.</p>
 <p>For military or measurements purposes the UTM projection is used (or variants). This splits the Earth into small
 areas and computes the cartesian coordinates relative to each area.</p>
 <p/>
 <p>Here we use Oblique Mercator projection. Its advantage over the normal Mercator is that you can set the tangent point
 between the cylinder and the sphere to be anywhere on Earth. So you can set the center of the map to be close
 to the area you want projected and be able to measure accurately the distances between points and lines.</p>
 <p>The map deformation is minimal close to the center point and close to the "equator" line.</p>
 <p>The advantage over the UTM projection is that it can also produce a global rectangular map, like Mercator,
 which is great for viewing.</p>
 <p>The disadvantage over Mercator is that it needs more processing power.</p>
 <p/>
 <p>WGS84 is the ellipsoid aproximation of the Earth, with big radius of 6,378,137 m and small radius of 6,356,752.3 m.</p>
 <p>The geographic coordinates expressed for this ellipsoid are widely used today in maps and gps coordinates.</p>
 <p>It is the default standard for representing geographic coordinates.</p>
 <p/>
 <p>The purpose of this module is to provide convertion from polar to cartesian coordinates, so you can
 process the geographic data with the Simple Features API functions implemented in the geo module.</p>
 <p>That module works only with cartesian coordinates, but most maps have polar coordinates.</p>
 <p/>
 <p>The projection formulas are taken from lib_proj library and implemented in XQuery.</p>
</xqdoc:description><xqdoc:author>Daniel Turcanu</xqdoc:author><xqdoc:custom tag="project">Zorba/Geo Projection/Geo Projection</xqdoc:custom><xqdoc:custom tag="language">xquery</xqdoc:custom><xqdoc:custom tag="version">3.0</xqdoc:custom><xqdoc:custom tag="encoding">utf-8</xqdoc:custom></xqdoc:comment><xqdoc:custom tag="namespaces"><xqdoc:namespace prefix="err" uri="http://www.w3.org/2005/xqt-errors" isSchema="false"/><xqdoc:namespace prefix="geoproj" uri="http://zorba.io/modules/geoproj" isSchema="false"/><xqdoc:namespace prefix="geoproj-param" uri="http://zorba.io/modules/geoproj-param" isSchema="true"/><xqdoc:namespace prefix="gml" uri="http://www.opengis.net/gml" isSchema="false"/><xqdoc:namespace prefix="math" uri="http://www.w3.org/2005/xpath-functions/math" isSchema="false"/><xqdoc:namespace prefix="schemaOptions" uri="http://zorba.io/modules/schema" isSchema="false"/><xqdoc:namespace prefix="ver" uri="http://zorba.io/options/versioning" isSchema="false"/></xqdoc:custom></xqdoc:module><xqdoc:imports><xqdoc:import type="schema"><xqdoc:uri>http://zorba.io/modules/geoproj-param</xqdoc:uri></xqdoc:import><xqdoc:import type="library"><xqdoc:uri>http://zorba.io/modules/schema</xqdoc:uri><xqdoc:comment><xqdoc:description> <p>Import module for checking if geoproj parameters are validated.</p>
</xqdoc:description></xqdoc:comment></xqdoc:import></xqdoc:imports><xqdoc:variables/><xqdoc:collections/><xqdoc:indexes/><xqdoc:functions><xqdoc:function arity="1"><xqdoc:comment><xqdoc:description> <p>Convert angle from degrees to radians.</p>
 <p>The parameter is first reduced to value range of (-360, 360).</p>
</xqdoc:description><xqdoc:param>$deg angle in degrees</xqdoc:param><xqdoc:return>value in radians (-2PI, 2PI)</xqdoc:return></xqdoc:comment><xqdoc:name>geoproj:deg-to-rad</xqdoc:name><xqdoc:signature>declare function geoproj:deg-to-rad($deg as xs:double) as xs:double</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>deg</xqdoc:name><xqdoc:type>xs:double</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type>xs:double</xqdoc:type></xqdoc:return><xqdoc:invoked arity="0"><xqdoc:uri>http://www.w3.org/2005/xpath-functions/math</xqdoc:uri><xqdoc:name>pi</xqdoc:name></xqdoc:invoked></xqdoc:function><xqdoc:function arity="1"><xqdoc:comment><xqdoc:description> <p>Convert angle from radians to degrees.</p>
</xqdoc:description><xqdoc:param>$rad value in radians</xqdoc:param><xqdoc:return>value in degrees (-360, 360)</xqdoc:return></xqdoc:comment><xqdoc:name>geoproj:rad-to-deg</xqdoc:name><xqdoc:signature>declare function geoproj:rad-to-deg($rad as xs:double) as xs:double</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>rad</xqdoc:name><xqdoc:type>xs:double</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type>xs:double</xqdoc:type></xqdoc:return><xqdoc:invoked arity="0"><xqdoc:uri>http://www.w3.org/2005/xpath-functions/math</xqdoc:uri><xqdoc:name>pi</xqdoc:name></xqdoc:invoked></xqdoc:function><xqdoc:function arity="1"><xqdoc:comment><xqdoc:description> <p>Compute the isometric latitude of $phi latitude.</p>
</xqdoc:description><xqdoc:param>$phi a latitude</xqdoc:param><xqdoc:return>isometric latitude in radians</xqdoc:return></xqdoc:comment><xqdoc:name>geoproj:proj-tsfn</xqdoc:name><xqdoc:annotations><xqdoc:annotation prefix="" namespace="http://www.w3.org/2005/xpath-functions" localname="private" value=""/></xqdoc:annotations><xqdoc:signature>declare %private function geoproj:proj-tsfn($phi as xs:double) as xs:double</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>phi</xqdoc:name><xqdoc:type>xs:double</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type>xs:double</xqdoc:type></xqdoc:return><xqdoc:invoked arity="0"><xqdoc:uri>http://www.w3.org/2005/xpath-functions/math</xqdoc:uri><xqdoc:name>pi</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="2"><xqdoc:uri>http://www.w3.org/2005/xpath-functions/math</xqdoc:uri><xqdoc:name>pow</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions/math</xqdoc:uri><xqdoc:name>sin</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions/math</xqdoc:uri><xqdoc:name>tan</xqdoc:name></xqdoc:invoked></xqdoc:function><xqdoc:function arity="4"><xqdoc:name>geoproj:wgs84-to-omerc-validated</xqdoc:name><xqdoc:annotations><xqdoc:annotation prefix="" namespace="http://www.w3.org/2005/xpath-functions" localname="private" value=""/></xqdoc:annotations><xqdoc:signature>declare %private function geoproj:wgs84-to-omerc-validated($lat_0 as xs:double, $long_c as xs:double, $k0 as xs:double, $lat_long_degrees as element(geoproj-param:latlong,geoproj-param:latlongType)*) as element(geoproj-param:coord)*</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>lat_0</xqdoc:name><xqdoc:type>xs:double</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>long_c</xqdoc:name><xqdoc:type>xs:double</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>k0</xqdoc:name><xqdoc:type>xs:double</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>lat_long_degrees</xqdoc:name><xqdoc:type occurrence="*">element(geoproj-param:latlong,geoproj-param:latlongType)</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type occurrence="*">element(geoproj-param:coord)*</xqdoc:type></xqdoc:return><xqdoc:invoked arity="2"><xqdoc:uri>http://www.w3.org/2005/xpath-functions/math</xqdoc:uri><xqdoc:name>atan2</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions/math</xqdoc:uri><xqdoc:name>cos</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions/math</xqdoc:uri><xqdoc:name>log</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="0"><xqdoc:uri>http://www.w3.org/2005/xpath-functions/math</xqdoc:uri><xqdoc:name>pi</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="2"><xqdoc:uri>http://www.w3.org/2005/xpath-functions/math</xqdoc:uri><xqdoc:name>pow</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions/math</xqdoc:uri><xqdoc:name>sin</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions/math</xqdoc:uri><xqdoc:name>sqrt</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>abs</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://zorba.io/modules/geoproj</xqdoc:uri><xqdoc:name>deg-to-rad</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://zorba.io/modules/geoproj</xqdoc:uri><xqdoc:name>proj-tsfn</xqdoc:name></xqdoc:invoked></xqdoc:function><xqdoc:function arity="4"><xqdoc:comment><xqdoc:description> <p>Forward projection from geographic coordinates lat-long on WGS84 ellipsoid to Oblique Mercator cylinder.</p>
 <p>The Oblique Mercator projection is like the standard Mercator projection, but you can choose the point of origin.</p>
 <p>Specify the coordinates of the center point somewhere near the points being projected,
 so the projection deformation is small.</p>
 <p>The azimuth in the center point, alpha, is hardcoded to zero, so the true north is preserved.</p>
 <p>This is a simplification of the standard Oblique Mercator projection.</p>
 <p>Gamma, the azimuth of the rectified bearing of center line is also zero, calculated from alpha.</p>
 <p/>
 <p>The radius of the Earth in WGS84 is 6378137 m.</p>
 <p>Reverse flatening 298.257223563.</p>
 <p>Eccentricity e 0.0818192.</p>
</xqdoc:description><xqdoc:param>$lat_0 is the latitude for center point, in degrees (-90, 90)</xqdoc:param><xqdoc:param>$long_c is the longitude for center point, in degrees (-180, 180)</xqdoc:param><xqdoc:param>$k0 is the scale in the center point. The scale will increase when going far to north and south. Use value 1 to get the true distances between points, in meters. At equator, the distance for 1 degree is aproximately 110 km.</xqdoc:param><xqdoc:param>$lat_long_degrees a sequence of nodes of type &lt;latlong&gt;&lt;lat&gt;<i>latitude degree</i>&lt;/lat&gt;&lt;long&gt;<i>longitude degree</i>&lt;/long&gt;&lt;/latlong&gt; in namespace "http://zorba.io/modules/geoproj-param". Each node in the sequence is validated against the according schema.</xqdoc:param><xqdoc:return>a sequence of x-y coordinates in format &lt;coord&gt;&lt;x&gt;<i>x</i>&lt;/x&gt;&lt;y&gt;<i>y</i>&lt;/y&gt;&lt;/coord&gt; in namespace "http://zorba.io/modules/geoproj-param" Note that the x coordinate corresponds to the longitude, and y coordinate to the latitude. The coordinates are expressed in meters. The coordinates are relative to the center point.</xqdoc:return><xqdoc:error>err:XQDY0027 if any of the nodes passed in the $lat-long-degress parameter is not valid according to the schema.</xqdoc:error></xqdoc:comment><xqdoc:name>geoproj:wgs84-to-omerc</xqdoc:name><xqdoc:signature>declare function geoproj:wgs84-to-omerc($lat-0 as xs:double, $long-c as xs:double, $k0 as xs:double, $lat-long-degrees as element(geoproj-param:latlong)*) as element(geoproj-param:coord)*</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>lat-0</xqdoc:name><xqdoc:type>xs:double</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>long-c</xqdoc:name><xqdoc:type>xs:double</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>k0</xqdoc:name><xqdoc:type>xs:double</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>lat-long-degrees</xqdoc:name><xqdoc:type occurrence="*">element(geoproj-param:latlong)</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type occurrence="*">element(geoproj-param:coord)*</xqdoc:type></xqdoc:return><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>empty</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="4"><xqdoc:uri>http://zorba.io/modules/geoproj</xqdoc:uri><xqdoc:name>wgs84-to-omerc-validated</xqdoc:name></xqdoc:invoked></xqdoc:function><xqdoc:function arity="4"><xqdoc:comment><xqdoc:description> <p>Forward projection from geographic coordinates lat-long on WGS84 ellipsoid to Oblique Mercator cylinder.</p>
 <p>This is an intermediate function for wgs84-to-omerc.</p>
 <p>The difference is that it returns the x-y coordinates in gml:pos format,
 gml being the prefix for the GML namespace "http://www.opengis.net/gml".</p>
</xqdoc:description><xqdoc:param>$lat_0 is the latitude for center point, in degrees (-90, 90)</xqdoc:param><xqdoc:param>$long_c is the longitude for center point, in degrees (-180, 180)</xqdoc:param><xqdoc:param>$k0 is the scale in the center point.</xqdoc:param><xqdoc:param>$lat_long_degrees a sequence of nodes of type &lt;latlong&gt;&lt;lat&gt;<i>latitude degree</i>&lt;/lat&gt;&lt;long&gt;<i>longitude degree</i>&lt;/long&gt;&lt;/latlong&gt; in namespace "http://zorba.io/modules/geoproj-param". Each node in this sequence is validated according to the according schema.</xqdoc:param><xqdoc:return>a sequence of x-y coordinates in format &lt;gml:pos&gt;<i>x</i> <i>y</i>&lt;/gml:pos&gt; in namespace "http://www.opengis.net/gml"</xqdoc:return><xqdoc:error>err:XQDY0027 if any of the nodes passed in the $lat-long-degress parameter is not valid according to the schema.</xqdoc:error></xqdoc:comment><xqdoc:name>geoproj:wgs84-to-omerc-gmlpos</xqdoc:name><xqdoc:signature>declare function geoproj:wgs84-to-omerc-gmlpos($lat-0 as xs:double, $long-c as xs:double, $k0 as xs:double, $lat-long-degrees as element(geoproj-param:latlong)*) as element(gml:pos)*</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>lat-0</xqdoc:name><xqdoc:type>xs:double</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>long-c</xqdoc:name><xqdoc:type>xs:double</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>k0</xqdoc:name><xqdoc:type>xs:double</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>lat-long-degrees</xqdoc:name><xqdoc:type occurrence="*">element(geoproj-param:latlong)</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type occurrence="*">element(gml:pos)*</xqdoc:type></xqdoc:return><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>empty</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="4"><xqdoc:uri>http://zorba.io/modules/geoproj</xqdoc:uri><xqdoc:name>wgs84-to-omerc-gmlpos-validated</xqdoc:name></xqdoc:invoked></xqdoc:function><xqdoc:function arity="4"><xqdoc:name>geoproj:wgs84-to-omerc-gmlpos-validated</xqdoc:name><xqdoc:annotations><xqdoc:annotation prefix="" namespace="http://www.w3.org/2005/xpath-functions" localname="private" value=""/></xqdoc:annotations><xqdoc:signature>declare %private function geoproj:wgs84-to-omerc-gmlpos-validated($lat_0 as xs:double, $long_c as xs:double, $k0 as xs:double, $lat_long_degrees as element(geoproj-param:latlong,geoproj-param:latlongType)*) as element(gml:pos)*</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>lat_0</xqdoc:name><xqdoc:type>xs:double</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>long_c</xqdoc:name><xqdoc:type>xs:double</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>k0</xqdoc:name><xqdoc:type>xs:double</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>lat_long_degrees</xqdoc:name><xqdoc:type occurrence="*">element(geoproj-param:latlong,geoproj-param:latlongType)</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type occurrence="*">element(gml:pos)*</xqdoc:type></xqdoc:return><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>string</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="4"><xqdoc:uri>http://zorba.io/modules/geoproj</xqdoc:uri><xqdoc:name>wgs84-to-omerc</xqdoc:name></xqdoc:invoked></xqdoc:function><xqdoc:function arity="4"><xqdoc:comment><xqdoc:description> <p>Function for iterative computing of the inverse isometric latitude.</p>
</xqdoc:description><xqdoc:param>$i the maximum iterations</xqdoc:param><xqdoc:param>$ts precomputed value</xqdoc:param><xqdoc:param>$e the Earth eccentricity. For WGS84 is hardcoded to 0.0818192.</xqdoc:param><xqdoc:param>$prev_phi previous computed inverse isometric latitude</xqdoc:param><xqdoc:return>isometric latitude in radians</xqdoc:return></xqdoc:comment><xqdoc:name>geoproj:proj-phi2-helper</xqdoc:name><xqdoc:annotations><xqdoc:annotation prefix="" namespace="http://www.w3.org/2005/xpath-functions" localname="private" value=""/></xqdoc:annotations><xqdoc:signature>declare %private function geoproj:proj-phi2-helper($i as xs:integer, $ts as xs:double, $e as xs:double, $prev_phi as xs:double) as xs:double</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>i</xqdoc:name><xqdoc:type>xs:integer</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>ts</xqdoc:name><xqdoc:type>xs:double</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>e</xqdoc:name><xqdoc:type>xs:double</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>prev_phi</xqdoc:name><xqdoc:type>xs:double</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type>xs:double</xqdoc:type></xqdoc:return><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions/math</xqdoc:uri><xqdoc:name>atan</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="0"><xqdoc:uri>http://www.w3.org/2005/xpath-functions/math</xqdoc:uri><xqdoc:name>pi</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="2"><xqdoc:uri>http://www.w3.org/2005/xpath-functions/math</xqdoc:uri><xqdoc:name>pow</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions/math</xqdoc:uri><xqdoc:name>sin</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>abs</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="4"><xqdoc:uri>http://zorba.io/modules/geoproj</xqdoc:uri><xqdoc:name>proj-phi2-helper</xqdoc:name></xqdoc:invoked></xqdoc:function><xqdoc:function arity="2"><xqdoc:comment><xqdoc:description> <p>Function for computing the inverse isometric latitude.</p>
</xqdoc:description><xqdoc:param>$ts precomputed value, based on an initial latitude.</xqdoc:param><xqdoc:param>$e the Earth eccentricity. For WGS84 is hardcoded to 0.0818192.</xqdoc:param><xqdoc:return>inverse isometric latitude in radians</xqdoc:return></xqdoc:comment><xqdoc:name>geoproj:proj-phi2</xqdoc:name><xqdoc:annotations><xqdoc:annotation prefix="" namespace="http://www.w3.org/2005/xpath-functions" localname="private" value=""/></xqdoc:annotations><xqdoc:signature>declare %private function geoproj:proj-phi2($ts as xs:double, $e as xs:double) as xs:double</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>ts</xqdoc:name><xqdoc:type>xs:double</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>e</xqdoc:name><xqdoc:type>xs:double</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type>xs:double</xqdoc:type></xqdoc:return><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions/math</xqdoc:uri><xqdoc:name>atan</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="0"><xqdoc:uri>http://www.w3.org/2005/xpath-functions/math</xqdoc:uri><xqdoc:name>pi</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="4"><xqdoc:uri>http://zorba.io/modules/geoproj</xqdoc:uri><xqdoc:name>proj-phi2-helper</xqdoc:name></xqdoc:invoked></xqdoc:function><xqdoc:function arity="4"><xqdoc:comment><xqdoc:description> <p>Inverse projection from cartesian coordinates on Oblique Mercator cylinder
 to geographic coordinates lat-long on WGS84 ellipsoid.</p>
 <p>The parameters for center point and scale should be the same as for the initial forward projection,
 otherwise you will get wrong results.</p>
</xqdoc:description><xqdoc:param>$lat_0 is the latitude for center point, in degrees (-90, 90)</xqdoc:param><xqdoc:param>$long_c is the longitude for center point, in degrees (-180, 180)</xqdoc:param><xqdoc:param>$k0 is the scale in the center point.</xqdoc:param><xqdoc:param>$coords a sequence of nodes of type &lt;coord&gt;&lt;x&gt;<i>x</i>&lt;/x&gt;&lt;y&gt;<i>y</i>&lt;/y&gt;&lt;/coord&gt; in namespace "http://zorba.io/modules/geoproj-param" The coordinates are expressed in meters.</xqdoc:param><xqdoc:return>a sequence of geographic coordinates in format &lt;latlong&gt;&lt;lat&gt;<i>latitude degree</i>&lt;/lat&gt;&lt;long&gt;<i>longitude degree</i>&lt;/long&gt;&lt;/latlong&gt; in namespace "http://zorba.io/modules/geoproj-param" Note that the longitude corresponds to the x coordinate, and the latitude to the y coordinate.</xqdoc:return><xqdoc:error>err:XQDY0027 if any of the coordinates passed in the $coords parameter is not valid according to the schema.</xqdoc:error></xqdoc:comment><xqdoc:name>geoproj:omerc-to-wgs84</xqdoc:name><xqdoc:signature>declare function geoproj:omerc-to-wgs84($lat-0 as xs:double, $long-c as xs:double, $k0 as xs:double, $coords as element(geoproj-param:coord)*) as element(geoproj-param:latlong)*</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>lat-0</xqdoc:name><xqdoc:type>xs:double</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>long-c</xqdoc:name><xqdoc:type>xs:double</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>k0</xqdoc:name><xqdoc:type>xs:double</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>coords</xqdoc:name><xqdoc:type occurrence="*">element(geoproj-param:coord)</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type occurrence="*">element(geoproj-param:latlong)*</xqdoc:type></xqdoc:return><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>empty</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="4"><xqdoc:uri>http://zorba.io/modules/geoproj</xqdoc:uri><xqdoc:name>omerc-to-wgs84-validated</xqdoc:name></xqdoc:invoked></xqdoc:function><xqdoc:function arity="4"><xqdoc:name>geoproj:omerc-to-wgs84-validated</xqdoc:name><xqdoc:annotations><xqdoc:annotation prefix="" namespace="http://www.w3.org/2005/xpath-functions" localname="private" value=""/></xqdoc:annotations><xqdoc:signature>declare %private function geoproj:omerc-to-wgs84-validated($lat_0 as xs:double, $long_c as xs:double, $k0 as xs:double, $coords as element(geoproj-param:coord,geoproj-param:coordType)*) as element(geoproj-param:latlong)*</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>lat_0</xqdoc:name><xqdoc:type>xs:double</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>long_c</xqdoc:name><xqdoc:type>xs:double</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>k0</xqdoc:name><xqdoc:type>xs:double</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>coords</xqdoc:name><xqdoc:type occurrence="*">element(geoproj-param:coord,geoproj-param:coordType)</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type occurrence="*">element(geoproj-param:latlong)*</xqdoc:type></xqdoc:return><xqdoc:invoked arity="2"><xqdoc:uri>http://www.w3.org/2005/xpath-functions/math</xqdoc:uri><xqdoc:name>atan2</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions/math</xqdoc:uri><xqdoc:name>cos</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions/math</xqdoc:uri><xqdoc:name>exp</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="2"><xqdoc:uri>http://www.w3.org/2005/xpath-functions/math</xqdoc:uri><xqdoc:name>pow</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions/math</xqdoc:uri><xqdoc:name>sin</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions/math</xqdoc:uri><xqdoc:name>sqrt</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>abs</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://zorba.io/modules/geoproj</xqdoc:uri><xqdoc:name>deg-to-rad</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="2"><xqdoc:uri>http://zorba.io/modules/geoproj</xqdoc:uri><xqdoc:name>proj-phi2</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://zorba.io/modules/geoproj</xqdoc:uri><xqdoc:name>proj-tsfn</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://zorba.io/modules/geoproj</xqdoc:uri><xqdoc:name>rad-to-deg</xqdoc:name></xqdoc:invoked></xqdoc:function><xqdoc:function arity="4"><xqdoc:comment><xqdoc:description> <p>Inverse projection from cartesian coordinates on Oblique Mercator cylinder
 to geographic coordinates lat-long on WGS84 ellipsoid.</p>
 <p>This is an intermediate function for omerc-to-wgs84.</p>
 <p>The difference is that it works with coordinates in gml:pos format,
 gml being the prefix for the GML namespace "http://www.opengis.net/gml".</p>
</xqdoc:description><xqdoc:param>$lat_0 is the latitude for center point, in degrees (-90, 90)</xqdoc:param><xqdoc:param>$long_c is the longitude for center point, in degrees (-180, 180)</xqdoc:param><xqdoc:param>$k0 is the scale in the center point.</xqdoc:param><xqdoc:param>$gmlposs a sequence of nodes of type &lt;gml:pos&gt;<i>x</i> <i>y</i>&lt;/gml:pos&gt; in namespace "http://www.opengis.net/gml"</xqdoc:param><xqdoc:return>a sequence of geographic coordinates in format v &lt;latlong&gt;&lt;lat&gt;<i>latitude degree</i>&lt;/lat&gt;&lt;long&gt;<i>longitude degree</i>&lt;/long&gt;&lt;/latlong&gt; in namespace "http://zorba.io/modules/geoproj-param"</xqdoc:return></xqdoc:comment><xqdoc:name>geoproj:omerc-gmlpos-to-wgs84</xqdoc:name><xqdoc:signature>declare function geoproj:omerc-gmlpos-to-wgs84($lat_0 as xs:double, $long_c as xs:double, $k0 as xs:double, $gmlposs as element(gml:pos)*) as element(geoproj-param:latlong)*</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>lat_0</xqdoc:name><xqdoc:type>xs:double</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>long_c</xqdoc:name><xqdoc:type>xs:double</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>k0</xqdoc:name><xqdoc:type>xs:double</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>gmlposs</xqdoc:name><xqdoc:type occurrence="*">element(gml:pos)</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type occurrence="*">element(geoproj-param:latlong)*</xqdoc:type></xqdoc:return><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>normalize-space</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>string</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="2"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>tokenize</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="4"><xqdoc:uri>http://zorba.io/modules/geoproj</xqdoc:uri><xqdoc:name>omerc-to-wgs84</xqdoc:name></xqdoc:invoked></xqdoc:function><xqdoc:function arity="1"><xqdoc:comment><xqdoc:description> <p>Convertion from Degrees-Minutes-Seconds (DMS) to Degrees.</p>
 <p>The values for DMS can be like 11d12'13", meaning 11 degrees, 12 minutes and 13 seconds.</p>
 <p>One degree has 60 minutes, and one minute has 60 seconds.</p>
 <p>The separator for degrees can be one of the characters [dDoO].</p>
 <p>The separator for minutes can be one of the characters ['m].</p>
 <p>The separator for seconds can be " or nothing.</p>
 <p>The seconds can be a floating point number.</p>
 <p/>
 <p>The seconds can be missing, and if it is missing, the minutes can be missing too.</p>
 <p>The negative value can be expressed as -11d12'13" or 11d12'13"S or 11d12'13"W.</p>
 <p>Values for N (North) and E (East) are positive, and S (South) and W (West) are negative.</p>
</xqdoc:description><xqdoc:param>$dms the degree-minutes-seconds string expressed in the format described above</xqdoc:param><xqdoc:return>the value in degrees</xqdoc:return></xqdoc:comment><xqdoc:name>geoproj:dms-to-deg</xqdoc:name><xqdoc:signature>declare function geoproj:dms-to-deg($dms as xs:string) as xs:double</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>dms</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type>xs:double</xqdoc:type></xqdoc:return><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>abs</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>count</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="2"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>matches</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>normalize-space</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>string-length</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="2"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>substring</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="2"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>tokenize</xqdoc:name></xqdoc:invoked></xqdoc:function><xqdoc:function arity="1"><xqdoc:comment><xqdoc:description> <p>Convertion from Degrees to Degrees-Minutes-Seconds (DMS).</p>
</xqdoc:description><xqdoc:param>$deg the degree value</xqdoc:param><xqdoc:return>the value in DMS format, <i>[-]degree</i><b>d</b><i>minutes</i><b>'</b><i>seconds</i></xqdoc:return></xqdoc:comment><xqdoc:name>geoproj:deg-to-dms</xqdoc:name><xqdoc:signature>declare function geoproj:deg-to-dms($deg as xs:double) as xs:string</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>deg</xqdoc:name><xqdoc:type>xs:double</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type>xs:string</xqdoc:type></xqdoc:return><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>abs</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="5"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>concat</xqdoc:name></xqdoc:invoked></xqdoc:function></xqdoc:functions></xqdoc:xqdoc>