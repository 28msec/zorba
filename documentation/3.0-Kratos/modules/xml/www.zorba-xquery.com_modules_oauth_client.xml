<xqdoc:xqdoc xmlns:xqdoc="http://www.xqdoc.org/1.0"><xqdoc:control><xqdoc:date>2013-12-04T01:28:38.942159+01:00</xqdoc:date><xqdoc:version>1.0</xqdoc:version></xqdoc:control><xqdoc:module type="library"><xqdoc:uri>http://www.zorba-xquery.com/modules/oauth/client</xqdoc:uri><xqdoc:name>client</xqdoc:name><xqdoc:comment><xqdoc:description> This module provides the functions necessary to acquire access to the personal
 resources of a user through the open standard called
 <a href="http://oauth.net/" target="_blank">OAuth</a>.
 The application/mashup creator does not need to know the
 specifics of <a href="http://oauth.net/" target="_blank">OAuth</a> to use this module.
</xqdoc:description><xqdoc:author>Stephanie Russell</xqdoc:author><xqdoc:author><a href="mailto:william.candillon@28msec.com">William Candillon</a></xqdoc:author><xqdoc:see><a href="http://oauth.net/" target="_blank">OAuth Website</a></xqdoc:see><xqdoc:custom tag="project">Zorba/OAuth/Client</xqdoc:custom><xqdoc:custom tag="language">xquery</xqdoc:custom><xqdoc:custom tag="version">3.0</xqdoc:custom><xqdoc:custom tag="encoding">utf-8</xqdoc:custom></xqdoc:comment><xqdoc:custom tag="namespaces"><xqdoc:namespace prefix="an" uri="http://zorba.io/annotations" isSchema="false"/><xqdoc:namespace prefix="base64" uri="http://zorba.io/modules/base64" isSchema="false"/><xqdoc:namespace prefix="f" uri="http://zorba.io/features" isSchema="false"/><xqdoc:namespace prefix="hmac" uri="http://zorba.io/modules/hmac" isSchema="false"/><xqdoc:namespace prefix="http" uri="http://expath.org/ns/http-client" isSchema="true"/><xqdoc:namespace prefix="http-client" uri="http://expath.org/ns/http-client" isSchema="false"/><xqdoc:namespace prefix="oauth" uri="http://www.zorba-xquery.com/modules/oauth/client" isSchema="false"/><xqdoc:namespace prefix="oerr" uri="http://www.zorba-xquery.com/modules/oauth/error" isSchema="false"/><xqdoc:namespace prefix="op" uri="http://zorba.io/options/features" isSchema="false"/><xqdoc:namespace prefix="p" uri="http://www.zorba-xquery.com/schemas/oauth/parameters" isSchema="true"/><xqdoc:namespace prefix="ra" uri="http://zorba.io/modules/random" isSchema="false"/><xqdoc:namespace prefix="sp" uri="http://www.zorba-xquery.com/schemas/oauth/service-provider" isSchema="true"/><xqdoc:namespace prefix="ver" uri="http://zorba.io/options/versioning" isSchema="false"/></xqdoc:custom></xqdoc:module><xqdoc:imports><xqdoc:import type="schema"><xqdoc:uri>http://expath.org/ns/http-client</xqdoc:uri></xqdoc:import><xqdoc:import type="schema"><xqdoc:uri>http://www.zorba-xquery.com/schemas/oauth/service-provider</xqdoc:uri></xqdoc:import><xqdoc:import type="schema"><xqdoc:uri>http://www.zorba-xquery.com/schemas/oauth/parameters</xqdoc:uri></xqdoc:import><xqdoc:import type="library"><xqdoc:uri>http://zorba.io/modules/random</xqdoc:uri></xqdoc:import><xqdoc:import type="library"><xqdoc:uri>http://zorba.io/modules/hmac</xqdoc:uri></xqdoc:import><xqdoc:import type="library"><xqdoc:uri>http://expath.org/ns/http-client</xqdoc:uri></xqdoc:import><xqdoc:import type="library"><xqdoc:uri>http://zorba.io/modules/base64</xqdoc:uri></xqdoc:import><xqdoc:import type="library"><xqdoc:uri>http://www.zorba-xquery.com/modules/oauth/error</xqdoc:uri><xqdoc:comment><xqdoc:description> Use err module functions for throwing errors.
</xqdoc:description></xqdoc:comment></xqdoc:import></xqdoc:imports><xqdoc:variables/><xqdoc:collections/><xqdoc:indexes/><xqdoc:functions><xqdoc:function arity="10"><xqdoc:comment><xqdoc:description> Utility function to build a service provider object.
 This object contains the information required by the
 OAuth client to interact with an OAuth service provider.
 For instance the following expression:
 <pre class="ace-static" ace-mode="xquery">
 let $consumer-key     := "#"
 let $consumer-secret  := "#"
 let $signature-method := "HMAC-SHA1"
 let $realm            := "twitter.com"
 let $authorize-url    := "http://api.twitter.com/oauth/authorize"
 let $request-token-method := "POST"
 let $request-token-url := "https://twitter.com/oauth/request_token"
 let $request-token-callback-url := "https://twitter.com/oauth/request_token"
 let $access-token-method := "POST"
 let $access-token-url := "https://api.twitter.com/oauth/access_token"
 return oauth:service-provider(
   $consumer-key, $consumer-secret, $signature-method,
   $realm, $authorize-url, $request-token-method,
   $request-token-url, $request-token-callback-url,
   $access-token-method, $access-token-url
 )
 </pre>
 Will return the following XML schema instance:
 <pre class="ace-static" ace-mode="xml">
 <sp:service-provider xmlns:sp="http://www.zorba-xquery.com/schemas/oauth/service-provider" consumer-key="#" consumer-secret="#" signature-method="HMAC-SHA1" realm="twitter.com" authorize-url="http://api.twitter.com/oauth/authorize">
   <sp:request-token method="POST" href="https://twitter.com/oauth/request_token" callback-url="https://twitter.com/oauth/request_token"/>
   <sp:access-token method="POST" href="https://api.twitter.com/oauth/access_token"/>
 </sp:service-provider>
 </pre>
</xqdoc:description><xqdoc:param>$consumer-key Client Identifier, also known as the consumer-key</xqdoc:param><xqdoc:param>$consumer-secret Client Shared-Secret, also known as the consumer-secret</xqdoc:param><xqdoc:param>$signature-method Method with which the signing key is signed (typically HMAC-SHA1)</xqdoc:param><xqdoc:param>$realm Realm that defines the protection space</xqdoc:param><xqdoc:param>$authorize-url authorize-url</xqdoc:param><xqdoc:param>$request-token-method request-token-method</xqdoc:param><xqdoc:param>$request-token-url request-token-url</xqdoc:param><xqdoc:param>$request-token-callback-url request-token-callback-url</xqdoc:param><xqdoc:param>$access-token-method access-token-method</xqdoc:param><xqdoc:param>$access-token-url access-token-url</xqdoc:param><xqdoc:return>instance of the OAuth service provider XML schema.</xqdoc:return></xqdoc:comment><xqdoc:name>oauth:service-provider</xqdoc:name><xqdoc:signature>declare function oauth:service-provider($consumer-key as xs:string, $consumer-secret as xs:string, $signature-method as xs:string, $realm as xs:string, $authorize-url as xs:string, $request-token-method as xs:string, $request-token-url as xs:string, $request-token-callback-url as xs:string, $access-token-method as xs:string, $access-token-url as xs:string) as schema-element(sp:service-provider)</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>consumer-key</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>consumer-secret</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>signature-method</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>realm</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>authorize-url</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>request-token-method</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>request-token-url</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>request-token-callback-url</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>access-token-method</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>access-token-url</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type>schema-element(sp:service-provider)</xqdoc:type></xqdoc:return></xqdoc:function><xqdoc:function arity="2"><xqdoc:comment><xqdoc:description> Create an OAuth Parameters instance.
 Instances of OAuth parameters are used to
 contain value/pair data such as <em>oauth_token</em>
 and <em>oauth_token_secret</em>.
 For instance the following code snippet:
 <pre class="ace-static" ace-mode="xquery">
  oauth:parameters("oauth_token", "#")
 </pre>
 Returns the following XML schema instance:
 <pre class="ace-static" ace-mode="xml">
 <p:parameters xmlns:p="http://www.zorba-xquery.com/schemas/oauth/parameters">
   <p:parameter name="oauth_token" value="#"/>
 </p:parameters>
 </pre>
</xqdoc:description><xqdoc:param>$name parameter name</xqdoc:param><xqdoc:param>$value parameter value</xqdoc:param><xqdoc:return>instance of the OAuth parameters XML schema.</xqdoc:return></xqdoc:comment><xqdoc:name>oauth:parameters</xqdoc:name><xqdoc:signature>declare function oauth:parameters($name as xs:string, $value as xs:string) as element(p:parameters)</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>name</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>value</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type>element(p:parameters)</xqdoc:type></xqdoc:return></xqdoc:function><xqdoc:function arity="3"><xqdoc:comment><xqdoc:description> Adds an OAuth parameter to an OAuth Parameters instance.
 Instances of OAuth parameters are used to
 contain value/pair data such as <em>oauth_token</em>
 and <em>oauth_token_secret</em>.
 For instance the following code snippet:
 <pre class="ace-static" ace-mode="xquery">
  let $params := oauth:parameters("oauth_token", "#")
  let $params := oauth:add-parameter($params, "oauth_token_secret", "#")
  return $params
 </pre>
 Returns the following XML schema instance:
 <pre class="ace-static" ace-mode="xquery">
 <p:parameters xmlns:p="http://www.zorba-xquery.com/schemas/oauth/parameters">
   <p:parameter name="oauth_token" value="#"/>
   <p:parameter name="oauth_token_secret" value="#"/>
 </p:parameters>
 </pre>
</xqdoc:description><xqdoc:param>$parameters parameters</xqdoc:param><xqdoc:param>$name parameter name</xqdoc:param><xqdoc:param>$value parameter value</xqdoc:param><xqdoc:return>instance of the OAuth parameters XML schema.</xqdoc:return></xqdoc:comment><xqdoc:name>oauth:add-parameter</xqdoc:name><xqdoc:signature>declare function oauth:add-parameter($parameters as schema-element(p:parameters)?, $name as xs:string, $value as xs:string) as schema-element(p:parameters)</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>parameters</xqdoc:name><xqdoc:type occurrence="?">schema-element(p:parameters)</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>name</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>value</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type>schema-element(p:parameters)</xqdoc:type></xqdoc:return></xqdoc:function><xqdoc:function arity="2"><xqdoc:comment><xqdoc:description> This function returns the string value of the parameters whose key matches a $string input.
</xqdoc:description><xqdoc:param>$params element parameters</xqdoc:param><xqdoc:param>$string string as the "key" name</xqdoc:param><xqdoc:return>string value of the parameter with key $string <pre class="ace-static" ace-mode="xquery"> let $params := oauth:parameters("oauth_token", "token") let $params := oauth:add-parameter($params, "oauth_token_secret", "secret") let $token-secret := oauth:parameter($params, "oauth_token_secret") return $token-secret </pre></xqdoc:return></xqdoc:comment><xqdoc:name>oauth:parameter</xqdoc:name><xqdoc:signature>declare function oauth:parameter($params as schema-element(p:parameters), $string as xs:string) as xs:string</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>params</xqdoc:name><xqdoc:type>schema-element(p:parameters)</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>string</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type>xs:string</xqdoc:type></xqdoc:return><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2001/XMLSchema</xqdoc:uri><xqdoc:name>string</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="2"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>concat</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>empty</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="2"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>error</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>string</xqdoc:name></xqdoc:invoked></xqdoc:function><xqdoc:function arity="1"><xqdoc:comment><xqdoc:description> This function allows the client to obtain a set of temporary credentials from the service provider by making an authenticated HTTP request to the Temporary Credential Request endpoint.
 This function is provided for convenience for <a href="#request-token-2">request-token#2</a>.
 Invoking this function is equivalent to:
 <pre class="ace-static" ace-mode="xquery">
 oauth:request-token($service-provider, ())
 </pre>
</xqdoc:description><xqdoc:param>$service-provider Information about the service provider</xqdoc:param><xqdoc:return>temporary credentials correctly parsed as parameter elements, or an error if http response status is not 200 OK</xqdoc:return><xqdoc:see>http://tools.ietf.org/html/rfc5849#section-2.1</xqdoc:see></xqdoc:comment><xqdoc:name>oauth:request-token</xqdoc:name><xqdoc:annotations><xqdoc:annotation prefix="an" namespace="http://zorba.io/annotations" localname="sequential" value=""/></xqdoc:annotations><xqdoc:signature>declare %an:sequential function oauth:request-token($service-provider as schema-element(sp:service-provider)) as schema-element(p:parameters)</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>service-provider</xqdoc:name><xqdoc:type>schema-element(sp:service-provider)</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type>schema-element(p:parameters)</xqdoc:type></xqdoc:return><xqdoc:invoked arity="2"><xqdoc:uri>http://www.zorba-xquery.com/modules/oauth/client</xqdoc:uri><xqdoc:name>request-token</xqdoc:name></xqdoc:invoked></xqdoc:function><xqdoc:function arity="2"><xqdoc:comment><xqdoc:description> This function allows the client to obtain a set of temporary credentials from the service provider by making an authenticated HTTP request to the Temporary Credential Request endpoint.
 This function is provided for convenience.
</xqdoc:description><xqdoc:param>$service-provider Information about the service provider</xqdoc:param><xqdoc:param>$parameters Additionnal parameters to the request</xqdoc:param><xqdoc:return>temporary credentials correctly parsed as parameter elements, or an error if http response status is not 200 OK <pre class="ace-static" ace-mode="xquery"> let $twitter-config := oauth:service-provider(...) let $additional-parameter := oauth:parameters("foo", "bar") let $tokens := oauth:request-token($twitter-config, $additional-parameter) let $token := oauth:parameter($tokens, "oauth_token") let $token-secret := oauth:parameter($tokens, "oauth_token_secret") ... </pre></xqdoc:return><xqdoc:see>http://tools.ietf.org/html/rfc5849#section-2.1</xqdoc:see></xqdoc:comment><xqdoc:name>oauth:request-token</xqdoc:name><xqdoc:annotations><xqdoc:annotation prefix="an" namespace="http://zorba.io/annotations" localname="sequential" value=""/></xqdoc:annotations><xqdoc:signature>declare %an:sequential function oauth:request-token($service-provider as schema-element(sp:service-provider), $parameters as schema-element(p:parameters)?) as schema-element(p:parameters)</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>service-provider</xqdoc:name><xqdoc:type>schema-element(sp:service-provider)</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>parameters</xqdoc:name><xqdoc:type occurrence="?">schema-element(p:parameters)</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type>schema-element(p:parameters)</xqdoc:type></xqdoc:return><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>string</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.zorba-xquery.com/modules/oauth/client</xqdoc:uri><xqdoc:name>additional-parameters</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="8"><xqdoc:uri>http://www.zorba-xquery.com/modules/oauth/client</xqdoc:uri><xqdoc:name>request-token</xqdoc:name></xqdoc:invoked></xqdoc:function><xqdoc:function arity="2"><xqdoc:comment><xqdoc:description> This function allows the client to obtain a set of token credentials from the service provider by making an authenticated HTTP request to the Token Request endpoint.
 This function is provided for convenience.
</xqdoc:description><xqdoc:param>$service-provider Contains service provider information</xqdoc:param><xqdoc:param>$parameters parameters</xqdoc:param><xqdoc:return>token credentials correctly parsed as parameter elements, or an error if http response status is not 200 OK <pre class="ace-static" ace-mode="xquery"> let $service-provider := oauth:service-provider(...) let $parameters := oauth:parameters("oauth_token", "#") let $parameters := oauth:add-parameter($parameters, "oauth_token_secret", "#") let $tokens := oauth:access-token($service-provider, $parameters) ... </pre></xqdoc:return><xqdoc:see>http://tools.ietf.org/html/rfc5849#section-2.3</xqdoc:see></xqdoc:comment><xqdoc:name>oauth:access-token</xqdoc:name><xqdoc:annotations><xqdoc:annotation prefix="an" namespace="http://zorba.io/annotations" localname="sequential" value=""/></xqdoc:annotations><xqdoc:signature>declare %an:sequential function oauth:access-token($service-provider as schema-element(sp:service-provider), $parameters as schema-element(p:parameters)) as schema-element(p:parameters)</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>service-provider</xqdoc:name><xqdoc:type>schema-element(sp:service-provider)</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>parameters</xqdoc:name><xqdoc:type>schema-element(p:parameters)</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type>schema-element(p:parameters)</xqdoc:type></xqdoc:return><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>string</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="9"><xqdoc:uri>http://www.zorba-xquery.com/modules/oauth/client</xqdoc:uri><xqdoc:name>access-token</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.zorba-xquery.com/modules/oauth/client</xqdoc:uri><xqdoc:name>additional-parameters</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="2"><xqdoc:uri>http://www.zorba-xquery.com/modules/oauth/client</xqdoc:uri><xqdoc:name>parameter</xqdoc:name></xqdoc:invoked></xqdoc:function><xqdoc:function arity="3"><xqdoc:comment><xqdoc:description> This function allows the client access to the protected resources of the user.
 This function is provided for convenience.
</xqdoc:description><xqdoc:param>$protected-resource (Not schema-validated) http:request element with http method and href.</xqdoc:param><xqdoc:param>$service-provider Information about the service provider</xqdoc:param><xqdoc:param>$parameters parameters</xqdoc:param><xqdoc:return>protected resources parsed as parameter elements, or an error if http response status is not 200 OK <pre class="ace-static" ace-mode="xquery"> let $tokens := oauth:parameters("oauth_token", "#") let $tokens := oauth:add-parameter($tokens, "oauth_token_secret", "#") let $service-provider := oauth:service-provider(...) let $request := validate { <request xmlns="http://expath.org/ns/http-client" href="http://twitter.com/account/verify_credentials.xml" method="GET"/> } return oauth:protected-resource($request, $service-provider, $tokens) </pre></xqdoc:return><xqdoc:see>http://tools.ietf.org/html/rfc5849#section-3</xqdoc:see></xqdoc:comment><xqdoc:name>oauth:protected-resource</xqdoc:name><xqdoc:annotations><xqdoc:annotation prefix="an" namespace="http://zorba.io/annotations" localname="sequential" value=""/></xqdoc:annotations><xqdoc:signature>declare %an:sequential function oauth:protected-resource($protected-resource as schema-element(http:request), $service-provider as schema-element(sp:service-provider), $parameters as schema-element(p:parameters)) as item()*</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>protected-resource</xqdoc:name><xqdoc:type>schema-element(http:request)</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>service-provider</xqdoc:name><xqdoc:type>schema-element(sp:service-provider)</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>parameters</xqdoc:name><xqdoc:type>schema-element(p:parameters)</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type occurrence="*">item()*</xqdoc:type></xqdoc:return><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>string</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.zorba-xquery.com/modules/oauth/client</xqdoc:uri><xqdoc:name>additional-parameters</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="2"><xqdoc:uri>http://www.zorba-xquery.com/modules/oauth/client</xqdoc:uri><xqdoc:name>parameter</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="8"><xqdoc:uri>http://www.zorba-xquery.com/modules/oauth/client</xqdoc:uri><xqdoc:name>protected-resource</xqdoc:name></xqdoc:invoked></xqdoc:function><xqdoc:function arity="0"><xqdoc:comment><xqdoc:description> The timestamp is expressed in the number of seconds since January 1, 1970 00:00:00 GMT.
</xqdoc:description><xqdoc:return>integer time in seconds since Unix epoch</xqdoc:return><xqdoc:see>http://tools.ietf.org/html/rfc5849#section-3.3</xqdoc:see></xqdoc:comment><xqdoc:name>oauth:timestamp</xqdoc:name><xqdoc:annotations><xqdoc:annotation prefix="" namespace="http://www.w3.org/2005/xpath-functions" localname="private" value=""/><xqdoc:annotation prefix="an" namespace="http://zorba.io/annotations" localname="nondeterministic" value=""/></xqdoc:annotations><xqdoc:signature>declare %private %an:nondeterministic function oauth:timestamp() as xs:decimal</xqdoc:signature><xqdoc:return><xqdoc:type>xs:decimal</xqdoc:type></xqdoc:return><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2001/XMLSchema</xqdoc:uri><xqdoc:name>dateTime</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2001/XMLSchema</xqdoc:uri><xqdoc:name>dayTimeDuration</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="2"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>adjust-dateTime-to-timezone</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="0"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>current-dateTime</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>round</xqdoc:name></xqdoc:invoked></xqdoc:function><xqdoc:function arity="2"><xqdoc:comment><xqdoc:description> This function returns a string key which is the client and temporary credential concatenated with an ampersand.
</xqdoc:description><xqdoc:param>$oauth-consumer-secret Client credential referred to as the "consumer secret"</xqdoc:param><xqdoc:param>$oauth-token-secret Temporary credential referred to as the "oauth token secret"</xqdoc:param><xqdoc:return>String signing key</xqdoc:return><xqdoc:see>http://tools.ietf.org/html/rfc5849#section-3.4.2</xqdoc:see></xqdoc:comment><xqdoc:name>oauth:key</xqdoc:name><xqdoc:annotations><xqdoc:annotation prefix="" namespace="http://www.w3.org/2005/xpath-functions" localname="private" value=""/></xqdoc:annotations><xqdoc:signature>declare %private function oauth:key($oauth-consumer-secret as xs:string, $oauth-token-secret as xs:string?) as xs:string</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>oauth-consumer-secret</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>oauth-token-secret</xqdoc:name><xqdoc:type occurrence="?">xs:string</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type>xs:string</xqdoc:type></xqdoc:return><xqdoc:invoked arity="3"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>concat</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>empty</xqdoc:name></xqdoc:invoked></xqdoc:function><xqdoc:function arity="0"><xqdoc:comment><xqdoc:description> This function should return a new UUID every time the function is invoked.
</xqdoc:description><xqdoc:return>random string</xqdoc:return><xqdoc:see>http://tools.ietf.org/html/rfc5849#section-3.3</xqdoc:see></xqdoc:comment><xqdoc:name>oauth:nonce</xqdoc:name><xqdoc:annotations><xqdoc:annotation prefix="" namespace="http://www.w3.org/2005/xpath-functions" localname="private" value=""/><xqdoc:annotation prefix="an" namespace="http://zorba.io/annotations" localname="nondeterministic" value=""/></xqdoc:annotations><xqdoc:signature>declare %private %an:nondeterministic function oauth:nonce() as xs:string</xqdoc:signature><xqdoc:return><xqdoc:type>xs:string</xqdoc:type></xqdoc:return><xqdoc:invoked arity="0"><xqdoc:uri>http://zorba.io/modules/random</xqdoc:uri><xqdoc:name>uuid</xqdoc:name></xqdoc:invoked></xqdoc:function><xqdoc:function arity="4"><xqdoc:comment><xqdoc:description> This function normalizes parameters into a single string.
</xqdoc:description><xqdoc:param>$params Element containing OAuth specific parameters</xqdoc:param><xqdoc:param>$divide String, usually an equal sign(=)</xqdoc:param><xqdoc:param>$option Optional string, quotation mark '"' in the creation of the authorization header</xqdoc:param><xqdoc:param>$comma String, typically a comma (,) in the authorization header</xqdoc:param><xqdoc:return>string formatted specifically for the authorization header, or for parameterization</xqdoc:return><xqdoc:see>http://tools.ietf.org/html/rfc5849#section-3.4.1.3.2</xqdoc:see></xqdoc:comment><xqdoc:name>oauth:normalization</xqdoc:name><xqdoc:annotations><xqdoc:annotation prefix="" namespace="http://www.w3.org/2005/xpath-functions" localname="private" value=""/></xqdoc:annotations><xqdoc:signature>declare %private function oauth:normalization($params as schema-element(p:parameters), $divide as xs:string, $option as xs:string?, $comma as xs:string) as xs:string</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>params</xqdoc:name><xqdoc:type>schema-element(p:parameters)</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>divide</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>option</xqdoc:name><xqdoc:type occurrence="?">xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>comma</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type>xs:string</xqdoc:type></xqdoc:return><xqdoc:invoked arity="4"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>concat</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>string</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="2"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>string-join</xqdoc:name></xqdoc:invoked></xqdoc:function><xqdoc:function arity="3"><xqdoc:comment><xqdoc:description> This function formats the authorization header.
</xqdoc:description><xqdoc:param>$params Element containing OAuth specific parameters</xqdoc:param><xqdoc:param>$realm Realm that defines the protection space</xqdoc:param><xqdoc:param>$signature string signed signature</xqdoc:param><xqdoc:return>string authorization header</xqdoc:return><xqdoc:see>http://tools.ietf.org/html/rfc5849#section-3.5.1</xqdoc:see></xqdoc:comment><xqdoc:name>oauth:authorization-header</xqdoc:name><xqdoc:annotations><xqdoc:annotation prefix="" namespace="http://www.w3.org/2005/xpath-functions" localname="private" value=""/></xqdoc:annotations><xqdoc:signature>declare %private function oauth:authorization-header($params as element(p:parameters), $realm as xs:string, $signature as xs:string) as xs:string</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>params</xqdoc:name><xqdoc:type>element(p:parameters)</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>realm</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>signature</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type>xs:string</xqdoc:type></xqdoc:return><xqdoc:invoked arity="2"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>concat</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="3"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>concat</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="2"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>string-join</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="4"><xqdoc:uri>http://www.zorba-xquery.com/modules/oauth/client</xqdoc:uri><xqdoc:name>normalization</xqdoc:name></xqdoc:invoked></xqdoc:function><xqdoc:function arity="3"><xqdoc:comment><xqdoc:description> This function constructs the Signature Base String; a consistent, reproducible concatenation of several of the HTTP request elements into a single string.
</xqdoc:description><xqdoc:param>$http-method string method for posting the request to the url</xqdoc:param><xqdoc:param>$base-uri string base-uri for request, access, or protected resources</xqdoc:param><xqdoc:param>$params Element containing OAuth specific parameters</xqdoc:param><xqdoc:return>signature base string formatted to create the signature</xqdoc:return><xqdoc:see>http://tools.ietf.org/html/rfc5849#section-3.4.1</xqdoc:see></xqdoc:comment><xqdoc:name>oauth:signature-base-string</xqdoc:name><xqdoc:annotations><xqdoc:annotation prefix="" namespace="http://www.w3.org/2005/xpath-functions" localname="private" value=""/></xqdoc:annotations><xqdoc:signature>declare %private function oauth:signature-base-string($http-method as xs:string, $base-uri as xs:string, $params as element(p:parameters)) as xs:string</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>http-method</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>base-uri</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>params</xqdoc:name><xqdoc:type>element(p:parameters)</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type>xs:string</xqdoc:type></xqdoc:return><xqdoc:invoked arity="3"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>concat</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="5"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>concat</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>encode-for-uri</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="2"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>matches</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="3"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>replace</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>string</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="2"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>trace</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="0"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>true</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="4"><xqdoc:uri>http://www.zorba-xquery.com/modules/oauth/client</xqdoc:uri><xqdoc:name>normalization</xqdoc:name></xqdoc:invoked></xqdoc:function><xqdoc:function arity="3"><xqdoc:comment><xqdoc:description> This function generates a signature string which becomes the "oauth_signature" parameter. The service provider verifies the signature as specified for each method.
</xqdoc:description><xqdoc:param>$base-string signature base string</xqdoc:param><xqdoc:param>$oauth-signature-method string signing method</xqdoc:param><xqdoc:param>$key string signing key</xqdoc:param><xqdoc:return>signature base string formatted to create the signature</xqdoc:return><xqdoc:see>http://tools.ietf.org/html/rfc5849#section-3.4</xqdoc:see></xqdoc:comment><xqdoc:name>oauth:signature</xqdoc:name><xqdoc:annotations><xqdoc:annotation prefix="" namespace="http://www.w3.org/2005/xpath-functions" localname="private" value=""/></xqdoc:annotations><xqdoc:signature>declare %private function oauth:signature($base-string as xs:string, $oauth-signature-method as xs:string, $key as xs:string) as xs:string</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>base-string</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>oauth-signature-method</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>key</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type>xs:string</xqdoc:type></xqdoc:return><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2001/XMLSchema</xqdoc:uri><xqdoc:name>QName</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2001/XMLSchema</xqdoc:uri><xqdoc:name>string</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="2"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>concat</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="2"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>error</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="2"><xqdoc:uri>http://zorba.io/modules/hmac</xqdoc:uri><xqdoc:name>sha1</xqdoc:name></xqdoc:invoked></xqdoc:function><xqdoc:function arity="1"><xqdoc:comment><xqdoc:description> This function takes an input string and parses the parameters into parameter elements.
</xqdoc:description><xqdoc:param>$input string of parameters to be parsed into element parameters</xqdoc:param><xqdoc:return>element parameters</xqdoc:return></xqdoc:comment><xqdoc:name>oauth:parse-parameters</xqdoc:name><xqdoc:annotations><xqdoc:annotation prefix="" namespace="http://www.w3.org/2005/xpath-functions" localname="private" value=""/></xqdoc:annotations><xqdoc:signature>declare %private function oauth:parse-parameters($input as xs:string) as element(p:parameters)</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>input</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type>element(p:parameters)</xqdoc:type></xqdoc:return><xqdoc:invoked arity="3"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>replace</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="2"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>tokenize</xqdoc:name></xqdoc:invoked></xqdoc:function><xqdoc:function arity="6"><xqdoc:comment><xqdoc:description> This function makes the request, and sends it to the specified url using the specified http request method.
</xqdoc:description><xqdoc:param>$consumer-secret Client Shared-Secret, also known as the consumer-secret</xqdoc:param><xqdoc:param>$method HTTP request method (e.g., "GET", "POST", etc.)</xqdoc:param><xqdoc:param>$oauth-token-secret the temporary credentials shared-secret</xqdoc:param><xqdoc:param>$params Element containing OAuth specific parameters</xqdoc:param><xqdoc:param>$realm Realm that defines the protection space</xqdoc:param><xqdoc:param>$signature-method Method with which the signing key is signed (typically HMAC-SHA1)</xqdoc:param><xqdoc:param>$url Target URL</xqdoc:param><xqdoc:return>HTTP response.</xqdoc:return><xqdoc:see>http://tools.ietf.org/html/rfc5849#section-3.1</xqdoc:see></xqdoc:comment><xqdoc:name>oauth:http-request</xqdoc:name><xqdoc:annotations><xqdoc:annotation prefix="" namespace="http://www.w3.org/2005/xpath-functions" localname="private" value=""/><xqdoc:annotation prefix="an" namespace="http://zorba.io/annotations" localname="sequential" value=""/></xqdoc:annotations><xqdoc:signature>declare %private %an:sequential function oauth:http-request($consumer-secret as xs:string, $protected-resource as element(http:request), $oauth-token-secret as xs:string?, $params as element(p:parameters), $realm as xs:string?, $signature-method as xs:string) as item()*</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>consumer-secret</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>protected-resource</xqdoc:name><xqdoc:type>element(http:request)</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>oauth-token-secret</xqdoc:name><xqdoc:type occurrence="?">xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>params</xqdoc:name><xqdoc:type>element(p:parameters)</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>realm</xqdoc:name><xqdoc:type occurrence="?">xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>signature-method</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type occurrence="*">item()*</xqdoc:type></xqdoc:return><xqdoc:invoked arity="1"><xqdoc:uri>http://expath.org/ns/http-client</xqdoc:uri><xqdoc:name>send-request</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>encode-for-uri</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>string</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="2"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>tokenize</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="2"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>trace</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="3"><xqdoc:uri>http://www.zorba-xquery.com/modules/oauth/client</xqdoc:uri><xqdoc:name>authorization-header</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="2"><xqdoc:uri>http://www.zorba-xquery.com/modules/oauth/client</xqdoc:uri><xqdoc:name>key</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="3"><xqdoc:uri>http://www.zorba-xquery.com/modules/oauth/client</xqdoc:uri><xqdoc:name>signature</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="3"><xqdoc:uri>http://www.zorba-xquery.com/modules/oauth/client</xqdoc:uri><xqdoc:name>signature-base-string</xqdoc:name></xqdoc:invoked></xqdoc:function><xqdoc:function arity="9"><xqdoc:comment><xqdoc:description> This function creates the parameters to be given to the http-request function. It parses the response into
 parameter elements if the response status is 200 (OK).
</xqdoc:description><xqdoc:param>$consumer-key Client Identifier, also known as the consumer-key</xqdoc:param><xqdoc:param>$consumer-secret Client Shared-Secret, also known as the consumer-secret</xqdoc:param><xqdoc:param>$method HTTP request method (e.g., "GET", "POST", etc.)</xqdoc:param><xqdoc:param>$oauth-token The temporary credentials identifier</xqdoc:param><xqdoc:param>$oauth-token-secret The temporary credentials shared-secret</xqdoc:param><xqdoc:param>$realm Realm that defines the protection space</xqdoc:param><xqdoc:param>$signature-method Method with which the signing key is signed (typically HMAC-SHA1)</xqdoc:param><xqdoc:param>$url Target URL</xqdoc:param><xqdoc:param>$additional-parameters Parameters specific to a certain step (request-token, authorize, access-token, protected-resource) of the OAuth authorization</xqdoc:param><xqdoc:return>correctly parsed parameters, or an error if http response status is not 200 OK</xqdoc:return><xqdoc:error>XQP0021(oerr:OC003) if we receive http 401 error from the server.</xqdoc:error><xqdoc:error>XQP0021(oerr:OC004) if we receive http 500 error from the server.</xqdoc:error></xqdoc:comment><xqdoc:name>oauth:format-request</xqdoc:name><xqdoc:annotations><xqdoc:annotation prefix="" namespace="http://www.w3.org/2005/xpath-functions" localname="private" value=""/><xqdoc:annotation prefix="an" namespace="http://zorba.io/annotations" localname="sequential" value=""/></xqdoc:annotations><xqdoc:signature>declare %private %an:sequential function oauth:format-request($consumer-key as xs:string, $consumer-secret as xs:string, $protected-resource as element(http:request), $oauth-token as xs:string?, $oauth-token-secret as xs:string?, $realm as xs:string?, $signature-method as xs:string, $additional-parameters as element(p:parameters)?, $format-params as xs:boolean) as item()*</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>consumer-key</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>consumer-secret</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>protected-resource</xqdoc:name><xqdoc:type>element(http:request)</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>oauth-token</xqdoc:name><xqdoc:type occurrence="?">xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>oauth-token-secret</xqdoc:name><xqdoc:type occurrence="?">xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>realm</xqdoc:name><xqdoc:type occurrence="?">xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>signature-method</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>additional-parameters</xqdoc:name><xqdoc:type occurrence="?">element(p:parameters)</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>format-params</xqdoc:name><xqdoc:type>xs:boolean</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type occurrence="*">item()*</xqdoc:type></xqdoc:return><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2001/XMLSchema</xqdoc:uri><xqdoc:name>QName</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2001/XMLSchema</xqdoc:uri><xqdoc:name>integer</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="10"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>concat</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="2"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>concat</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="4"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>concat</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>data</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>empty</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="2"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>error</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="2"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>trace</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="9"><xqdoc:uri>http://www.zorba-xquery.com/modules/oauth/client</xqdoc:uri><xqdoc:name>format-request</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="6"><xqdoc:uri>http://www.zorba-xquery.com/modules/oauth/client</xqdoc:uri><xqdoc:name>http-request</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="0"><xqdoc:uri>http://www.zorba-xquery.com/modules/oauth/client</xqdoc:uri><xqdoc:name>nonce</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.zorba-xquery.com/modules/oauth/client</xqdoc:uri><xqdoc:name>parse-parameters</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="0"><xqdoc:uri>http://www.zorba-xquery.com/modules/oauth/client</xqdoc:uri><xqdoc:name>timestamp</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://zorba.io/modules/base64</xqdoc:uri><xqdoc:name>decode</xqdoc:name></xqdoc:invoked></xqdoc:function><xqdoc:function arity="8"><xqdoc:name>oauth:format-request</xqdoc:name><xqdoc:annotations><xqdoc:annotation prefix="" namespace="http://www.w3.org/2005/xpath-functions" localname="private" value=""/><xqdoc:annotation prefix="an" namespace="http://zorba.io/annotations" localname="sequential" value=""/></xqdoc:annotations><xqdoc:signature>declare %private %an:sequential function oauth:format-request($consumer-key as xs:string, $consumer-secret as xs:string, $protected-resource as element(http:request), $oauth-token as xs:string?, $oauth-token-secret as xs:string?, $realm as xs:string?, $signature-method as xs:string, $additional-parameters as element(p:parameters)?) as item()*</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>consumer-key</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>consumer-secret</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>protected-resource</xqdoc:name><xqdoc:type>element(http:request)</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>oauth-token</xqdoc:name><xqdoc:type occurrence="?">xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>oauth-token-secret</xqdoc:name><xqdoc:type occurrence="?">xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>realm</xqdoc:name><xqdoc:type occurrence="?">xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>signature-method</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>additional-parameters</xqdoc:name><xqdoc:type occurrence="?">element(p:parameters)</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type occurrence="*">item()*</xqdoc:type></xqdoc:return><xqdoc:invoked arity="0"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>true</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="9"><xqdoc:uri>http://www.zorba-xquery.com/modules/oauth/client</xqdoc:uri><xqdoc:name>format-request</xqdoc:name></xqdoc:invoked></xqdoc:function><xqdoc:function arity="1"><xqdoc:comment><xqdoc:description> This function finds the server-specific parameters. The specification states, "Servers MAY specify additional parameters..."
</xqdoc:description><xqdoc:param>$request element containing the client's request</xqdoc:param><xqdoc:return>may return parsed parameters or empty sequence if there were no server specific parameters</xqdoc:return><xqdoc:see>http://tools.ietf.org/html/rfc5849#section-2.1</xqdoc:see></xqdoc:comment><xqdoc:name>oauth:additional-parameters</xqdoc:name><xqdoc:annotations><xqdoc:annotation prefix="" namespace="http://www.w3.org/2005/xpath-functions" localname="private" value=""/></xqdoc:annotations><xqdoc:signature>declare %private function oauth:additional-parameters($parameters as element(p:parameters)?) as element(p:parameters)?</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>parameters</xqdoc:name><xqdoc:type occurrence="?">element(p:parameters)</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type occurrence="?">element(p:parameters)?</xqdoc:type></xqdoc:return><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>empty</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>string</xqdoc:name></xqdoc:invoked></xqdoc:function><xqdoc:function arity="8"><xqdoc:comment><xqdoc:description> This function allows the client to obtain a set of temporary credentials from the service provider by making an authenticated HTTP request to the Temporary Credential Request endpoint.
</xqdoc:description><xqdoc:param>$consumer-key Client Identifier, also known as the consumer-key</xqdoc:param><xqdoc:param>$consumer-secret Client Shared-Secret, also known as the consumer-secret</xqdoc:param><xqdoc:param>$signature-method Method with which the signing key is signed (typically HMAC-SHA1)</xqdoc:param><xqdoc:param>$method HTTP request method (e.g., "GET", "POST", etc.) HTTP request method</xqdoc:param><xqdoc:param>$realm Realm that defines the protection space</xqdoc:param><xqdoc:param>$temporary-credential-request Target url for temporary credentials request</xqdoc:param><xqdoc:param>$callback-url Service provider redirects the user to this url after authorization. The parameter value MUST be set to "oob" (case sensitive), to indicate an out-of-band configuration.</xqdoc:param><xqdoc:param>$additional-parameters Parameters specific to a certain step (request-token) of the OAuth authorization</xqdoc:param><xqdoc:return>temporary credentials correctly parsed as parameter elements, or an error if http response status is not 200 OK</xqdoc:return><xqdoc:see>http://tools.ietf.org/html/rfc5849#section-2.1</xqdoc:see></xqdoc:comment><xqdoc:name>oauth:request-token</xqdoc:name><xqdoc:annotations><xqdoc:annotation prefix="" namespace="http://www.w3.org/2005/xpath-functions" localname="private" value=""/><xqdoc:annotation prefix="an" namespace="http://zorba.io/annotations" localname="sequential" value=""/><xqdoc:annotation prefix="an" namespace="http://zorba.io/annotations" localname="nondeterministic" value=""/></xqdoc:annotations><xqdoc:signature>declare %private %an:sequential %an:nondeterministic function oauth:request-token($consumer-key as xs:string, $consumer-secret as xs:string, $signature-method as xs:string, $method as xs:string, $realm as xs:string, $temporary-credential-request as xs:string, $callback-url as xs:string, $additional-parameters as element(p:parameters)?) as element(p:parameters)</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>consumer-key</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>consumer-secret</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>signature-method</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>method</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>realm</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>temporary-credential-request</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>callback-url</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>additional-parameters</xqdoc:name><xqdoc:type occurrence="?">element(p:parameters)</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type>element(p:parameters)</xqdoc:type></xqdoc:return><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>encode-for-uri</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="3"><xqdoc:uri>http://www.zorba-xquery.com/modules/oauth/client</xqdoc:uri><xqdoc:name>add-parameter</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="8"><xqdoc:uri>http://www.zorba-xquery.com/modules/oauth/client</xqdoc:uri><xqdoc:name>format-request</xqdoc:name></xqdoc:invoked></xqdoc:function><xqdoc:function arity="9"><xqdoc:comment><xqdoc:description> This function allows the client to obtain a set of token credentials from the service provider by making an authenticated HTTP request to the Token Request endpoint.
</xqdoc:description><xqdoc:param>$consumer-key Client Identifier, also known as the consumer-key</xqdoc:param><xqdoc:param>$consumer-secret Client Shared-Secret, also known as the consumer-secret</xqdoc:param><xqdoc:param>$signature-method Method with which the signing key is signed (typically HMAC-SHA1)</xqdoc:param><xqdoc:param>$method HTTP request method (e.g., "GET", "POST", etc.)</xqdoc:param><xqdoc:param>$realm Realm that defines the protection space</xqdoc:param><xqdoc:param>$token-request-uri Target uri for token credentials request</xqdoc:param><xqdoc:param>$oauth-token The temporary credentials identifier</xqdoc:param><xqdoc:param>$oauth-token-secret the temporary credentials shared-secret</xqdoc:param><xqdoc:param>$additional-parameters Parameters specific to a certain step (access-token) of the OAuth authorization</xqdoc:param><xqdoc:return>token credentials correctly parsed as parameter elements, or an error if http response status is not 200 OK</xqdoc:return><xqdoc:see>http://tools.ietf.org/html/rfc5849#section-2.3</xqdoc:see></xqdoc:comment><xqdoc:name>oauth:access-token</xqdoc:name><xqdoc:annotations><xqdoc:annotation prefix="" namespace="http://www.w3.org/2005/xpath-functions" localname="private" value=""/><xqdoc:annotation prefix="an" namespace="http://zorba.io/annotations" localname="sequential" value=""/><xqdoc:annotation prefix="an" namespace="http://zorba.io/annotations" localname="nondeterministic" value=""/></xqdoc:annotations><xqdoc:signature>declare %private %an:sequential %an:nondeterministic function oauth:access-token($consumer-key as xs:string, $consumer-secret as xs:string, $signature-method as xs:string, $realm as xs:string, $oauth-token as xs:string, $oauth-token-secret as xs:string, $method as xs:string, $token-request-uri as xs:string, $additional-parameters as element(p:parameters)?) as element(p:parameters)</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>consumer-key</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>consumer-secret</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>signature-method</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>realm</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>oauth-token</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>oauth-token-secret</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>method</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>token-request-uri</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>additional-parameters</xqdoc:name><xqdoc:type occurrence="?">element(p:parameters)</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type>element(p:parameters)</xqdoc:type></xqdoc:return><xqdoc:invoked arity="3"><xqdoc:uri>http://www.zorba-xquery.com/modules/oauth/client</xqdoc:uri><xqdoc:name>add-parameter</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="8"><xqdoc:uri>http://www.zorba-xquery.com/modules/oauth/client</xqdoc:uri><xqdoc:name>format-request</xqdoc:name></xqdoc:invoked></xqdoc:function><xqdoc:function arity="8"><xqdoc:comment><xqdoc:description> This function allows the client access to the protected resources of the user.
</xqdoc:description><xqdoc:param>$consumer-key Client Identifier, also known as the consumer-key</xqdoc:param><xqdoc:param>$consumer-secret Client Shared-Secret, also known as the consumer-secret</xqdoc:param><xqdoc:param>$signature-method Method with which the signing key is signed (typically HMAC-SHA1)</xqdoc:param><xqdoc:param>$method HTTP request method (e.g., "GET", "POST", etc.)</xqdoc:param><xqdoc:param>$realm Realm that defines the protection space</xqdoc:param><xqdoc:param>$url Target URL</xqdoc:param><xqdoc:param>$oauth-token The temporary credentials identifier</xqdoc:param><xqdoc:param>$oauth-token-secret the temporary credentials shared-secret</xqdoc:param><xqdoc:param>$additional-parameters Parameters specific to a certain step (protected-resource) of the OAuth authorization</xqdoc:param><xqdoc:return>protected resources parsed as parameter elements, or an error if http response status is not 200 OK</xqdoc:return><xqdoc:see>http://tools.ietf.org/html/rfc5849#section-3</xqdoc:see></xqdoc:comment><xqdoc:name>oauth:protected-resource</xqdoc:name><xqdoc:annotations><xqdoc:annotation prefix="" namespace="http://www.w3.org/2005/xpath-functions" localname="private" value=""/><xqdoc:annotation prefix="an" namespace="http://zorba.io/annotations" localname="sequential" value=""/><xqdoc:annotation prefix="an" namespace="http://zorba.io/annotations" localname="nondeterministic" value=""/></xqdoc:annotations><xqdoc:signature>declare %private %an:sequential %an:nondeterministic function oauth:protected-resource($consumer-key as xs:string, $consumer-secret as xs:string, $signature-method as xs:string, $oauth-token as xs:string, $oauth-token-secret as xs:string, $realm as xs:string, $protected-resource as schema-element(http:request), $additional-parameters as element(p:parameters)?) as item()*</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>consumer-key</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>consumer-secret</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>signature-method</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>oauth-token</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>oauth-token-secret</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>realm</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>protected-resource</xqdoc:name><xqdoc:type>schema-element(http:request)</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>additional-parameters</xqdoc:name><xqdoc:type occurrence="?">element(p:parameters)</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type occurrence="*">item()*</xqdoc:type></xqdoc:return><xqdoc:invoked arity="0"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>false</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="3"><xqdoc:uri>http://www.zorba-xquery.com/modules/oauth/client</xqdoc:uri><xqdoc:name>add-parameter</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="9"><xqdoc:uri>http://www.zorba-xquery.com/modules/oauth/client</xqdoc:uri><xqdoc:name>format-request</xqdoc:name></xqdoc:invoked></xqdoc:function></xqdoc:functions></xqdoc:xqdoc>