<xqdoc:xqdoc xmlns:xqdoc="http://www.xqdoc.org/1.0"><xqdoc:control><xqdoc:date>2013-12-04T01:28:38.942159+01:00</xqdoc:date><xqdoc:version>1.0</xqdoc:version></xqdoc:control><xqdoc:module type="library"><xqdoc:uri>http://zorba.io/modules/data-cleaning/hybrid-string-similarity</xqdoc:uri><xqdoc:name>hybrid-string-similarity</xqdoc:name><xqdoc:comment><xqdoc:description> <p>This library module provides hybrid string similarity functions, combining the properties of
 character-based string similarity functions and token-based string similarity functions.</p>
 <p/>
 <p>The logic contained in this module is not specific to any particular XQuery implementation,
 although the module requires the trigonometic functions of XQuery 3.0 or a math extension
 function such as sqrt($x as numeric) for computing the square root.</p>
</xqdoc:description><xqdoc:author>Bruno Martins and Diogo Sim√µes</xqdoc:author><xqdoc:custom tag="project">Zorba/Data Cleaning/Hybrid String Similarity</xqdoc:custom><xqdoc:custom tag="language">xquery</xqdoc:custom><xqdoc:custom tag="version">3.0</xqdoc:custom><xqdoc:custom tag="encoding">utf-8</xqdoc:custom></xqdoc:comment><xqdoc:custom tag="namespaces"><xqdoc:namespace prefix="math" uri="http://www.w3.org/2005/xpath-functions/math" isSchema="false"/><xqdoc:namespace prefix="set" uri="http://zorba.io/modules/data-cleaning/set-similarity" isSchema="false"/><xqdoc:namespace prefix="simc" uri="http://zorba.io/modules/data-cleaning/character-based-string-similarity" isSchema="false"/><xqdoc:namespace prefix="simh" uri="http://zorba.io/modules/data-cleaning/hybrid-string-similarity" isSchema="false"/><xqdoc:namespace prefix="simp" uri="http://zorba.io/modules/data-cleaning/phonetic-string-similarity" isSchema="false"/><xqdoc:namespace prefix="simt" uri="http://zorba.io/modules/data-cleaning/token-based-string-similarity" isSchema="false"/><xqdoc:namespace prefix="ver" uri="http://zorba.io/options/versioning" isSchema="false"/></xqdoc:custom></xqdoc:module><xqdoc:imports><xqdoc:import type="library"><xqdoc:uri>http://zorba.io/modules/data-cleaning/set-similarity</xqdoc:uri></xqdoc:import><xqdoc:import type="library"><xqdoc:uri>http://zorba.io/modules/data-cleaning/token-based-string-similarity</xqdoc:uri></xqdoc:import><xqdoc:import type="library"><xqdoc:uri>http://zorba.io/modules/data-cleaning/character-based-string-similarity</xqdoc:uri></xqdoc:import><xqdoc:import type="library"><xqdoc:uri>http://zorba.io/modules/data-cleaning/phonetic-string-similarity</xqdoc:uri></xqdoc:import></xqdoc:imports><xqdoc:variables/><xqdoc:collections/><xqdoc:indexes/><xqdoc:functions><xqdoc:function arity="3"><xqdoc:comment><xqdoc:description> <p>Returns the cosine similarity coefficient between sets of tokens extracted from two strings.</p>
 <p/>
 <p>The tokens from each string are weighted according to their occurence frequency (i.e., weighted according to the
 term-frequency heuristic from Information Retrieval).</p>
 <p>The Soundex phonetic similarity function is used to discover token identity, which is equivalent to saying that
 this function returns the cosine similarity coefficient between sets of Soundex keys.</p>
 <p/>
 <p>Example usage : <pre class="ace-static" ace-mode="xquery"> soft-cosine-tokens-soundex("ALEKSANDER SMITH", "ALEXANDER SMYTH", " +") </pre></p>
 <p/>
 <p>The function invocation in the example above returns : <pre class="ace-static" ace-mode="xquery"> 1.0 </pre></p>
</xqdoc:description><xqdoc:param>$s1 The first string.</xqdoc:param><xqdoc:param>$s2 The second string.</xqdoc:param><xqdoc:param>$r A regular expression forming the delimiter character(s) which mark the boundaries between adjacent tokens.</xqdoc:param><xqdoc:return>The cosine similarity coefficient between the sets of Soundex keys extracted from the two strings.</xqdoc:return><xqdoc:custom tag="example">test/Queries/data-cleaning/hybrid-string-similarity/soft-cosine-tokens-soundex.xq</xqdoc:custom></xqdoc:comment><xqdoc:name>simh:soft-cosine-tokens-soundex</xqdoc:name><xqdoc:signature>declare function simh:soft-cosine-tokens-soundex($s1 as xs:string, $s2 as xs:string, $r as xs:string) as xs:double</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>s1</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>s2</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>r</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type>xs:double</xqdoc:type></xqdoc:return><xqdoc:invoked arity="2"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>tokenize</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://zorba.io/modules/data-cleaning/phonetic-string-similarity</xqdoc:uri><xqdoc:name>soundex-key</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="2"><xqdoc:uri>http://zorba.io/modules/data-cleaning/token-based-string-similarity</xqdoc:uri><xqdoc:name>cosine</xqdoc:name></xqdoc:invoked></xqdoc:function><xqdoc:function arity="3"><xqdoc:comment><xqdoc:description> <p>Returns the cosine similarity coefficient between sets of tokens extracted from two strings.</p>
 <p>The tokens from each string are weighted according to their occurence frequency (i.e., weighted according to the
 term-frequency heuristic from Information Retrieval).</p>
 <p>The Metaphone phonetic similarity function is used to discover token identity, which is equivalent to saying that
 this function returns the cosine similarity coefficient between sets of Metaphone keys.</p>
 <p/>
 <p>Example usage : <pre class="ace-static" ace-mode="xquery"> soft-cosine-tokens-metaphone("ALEKSANDER SMITH", "ALEXANDER SMYTH", " +" ) </pre></p>
 <p/>
 <p>The function invocation in the example above returns : <pre class="ace-static" ace-mode="xquery"> 1.0 </pre></p>
</xqdoc:description><xqdoc:param>$s1 The first string.</xqdoc:param><xqdoc:param>$s2 The second string.</xqdoc:param><xqdoc:param>$r A regular expression forming the delimiter character(s) which mark the boundaries between adjacent tokens.</xqdoc:param><xqdoc:return>The cosine similarity coefficient between the sets Metaphone keys extracted from the two strings.</xqdoc:return><xqdoc:custom tag="example">test/Queries/data-cleaning/hybrid-string-similarity/soft-cosine-tokens-metaphone.xq</xqdoc:custom></xqdoc:comment><xqdoc:name>simh:soft-cosine-tokens-metaphone</xqdoc:name><xqdoc:signature>declare function simh:soft-cosine-tokens-metaphone($s1 as xs:string, $s2 as xs:string, $r as xs:string) as xs:double</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>s1</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>s2</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>r</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type>xs:double</xqdoc:type></xqdoc:return><xqdoc:invoked arity="2"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>tokenize</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://zorba.io/modules/data-cleaning/phonetic-string-similarity</xqdoc:uri><xqdoc:name>metaphone-key</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="2"><xqdoc:uri>http://zorba.io/modules/data-cleaning/token-based-string-similarity</xqdoc:uri><xqdoc:name>cosine</xqdoc:name></xqdoc:invoked></xqdoc:function><xqdoc:function arity="4"><xqdoc:comment><xqdoc:description> <p>Returns the cosine similarity coefficient between sets of tokens extracted from two strings.</p>
 <p>The tokens from each string are weighted according to their occurence frequency (i.e., weighted according to the
 term-frequency heuristic from Information Retrieval).</p>
 <p>The Edit Distance similarity function is used to discover token identity, and tokens having an edit distance
 bellow a given threshold are considered as matching tokens.</p>
 <p/>
 <p>Example usage : <pre class="ace-static" ace-mode="xquery"> soft-cosine-tokens-edit-distance("The FLWOR Foundation", "FLWOR Found.", " +", 0 ) </pre></p>
 <p/>
 <p>The function invocation in the example above returns : <pre class="ace-static" ace-mode="xquery"> 0.408248290463863 </pre></p>
</xqdoc:description><xqdoc:param>$s1 The first string.</xqdoc:param><xqdoc:param>$s2 The second string.</xqdoc:param><xqdoc:param>$r A regular expression forming the delimiter character(s) which mark the boundaries between adjacent tokens.</xqdoc:param><xqdoc:param>$t A threshold for the similarity function used to discover token identity.</xqdoc:param><xqdoc:return>The cosine similarity coefficient between the sets tokens extracted from the two strings.</xqdoc:return></xqdoc:comment><xqdoc:name>simh:soft-cosine-tokens-edit-distance</xqdoc:name><xqdoc:signature>declare function simh:soft-cosine-tokens-edit-distance($s1 as xs:string, $s2 as xs:string, $r as xs:string, $t as xs:integer) as xs:double</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>s1</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>s2</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>r</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>t</xqdoc:name><xqdoc:type>xs:integer</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type>xs:double</xqdoc:type></xqdoc:return><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2001/XMLSchema</xqdoc:uri><xqdoc:name>double</xqdoc:name></xqdoc:invoked></xqdoc:function><xqdoc:function arity="4"><xqdoc:comment><xqdoc:description> <p>Returns the cosine similarity coefficient between sets of tokens extracted from two strings.</p>
 <p>The tokens from each string are weighted according to their occurence frequency (i.e., weighted according to the
 term-frequency heuristic from Information Retrieval).</p>
 <p>The Jaro similarity function is used to discover token identity, and tokens having a Jaro similarity above
 a given threshold are considered as matching tokens.</p>
 <p/>
 <p>Example usage : <pre class="ace-static" ace-mode="xquery"> soft-cosine-tokens-jaro("The FLWOR Foundation", "FLWOR Found.", " +", 1 ) </pre></p>
 <p/>
 <p>The function invocation in the example above returns : <pre class="ace-static" ace-mode="xquery"> 0.5 </pre></p>
</xqdoc:description><xqdoc:param>$s1 The first string.</xqdoc:param><xqdoc:param>$s2 The second string.</xqdoc:param><xqdoc:param>$r A regular expression forming the delimiter character(s) which mark the boundaries between adjacent tokens.</xqdoc:param><xqdoc:param>$t A threshold for the similarity function used to discover token identity.</xqdoc:param><xqdoc:return>The cosine similarity coefficient between the sets tokens extracted from the two strings.</xqdoc:return><xqdoc:custom tag="example">test/Queries/data-cleaning/hybrid-string-similarity/soft-cosine-tokens-jaro.xq</xqdoc:custom></xqdoc:comment><xqdoc:name>simh:soft-cosine-tokens-jaro</xqdoc:name><xqdoc:signature>declare function simh:soft-cosine-tokens-jaro($s1 as xs:string, $s2 as xs:string, $r as xs:string, $t as xs:double) as xs:double</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>s1</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>s2</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>r</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>t</xqdoc:name><xqdoc:type>xs:double</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type>xs:double</xqdoc:type></xqdoc:return><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions/math</xqdoc:uri><xqdoc:name>sqrt</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>count</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>not</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="3"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>subsequence</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>sum</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="2"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>tokenize</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="2"><xqdoc:uri>http://zorba.io/modules/data-cleaning/character-based-string-similarity</xqdoc:uri><xqdoc:name>jaro</xqdoc:name></xqdoc:invoked></xqdoc:function><xqdoc:function arity="6"><xqdoc:comment><xqdoc:description> <p>Returns the cosine similarity coefficient between sets of tokens extracted from two strings.</p>
 <p>The tokens from each string are weighted according to their occurence frequency (i.e., weighted according to the
 term-frequency heuristic from Information Retrieval).</p>
 <p>The Jaro-Winkler similarity function is used to discover token identity, and tokens having a Jaro-Winkler
 similarity above a given threshold are considered as matching tokens.</p>
 <p/>
 <p>Example usage : <pre class="ace-static" ace-mode="xquery"> soft-cosine-tokens-jaro-winkler("The FLWOR Foundation", "FLWOR Found.", " +", 1, 4, 0.1 ) </pre></p>
 <p/>
 <p>The function invocation in the example above returns : <pre class="ace-static" ace-mode="xquery"> 0.45 </pre></p>
</xqdoc:description><xqdoc:param>$s1 The first string.</xqdoc:param><xqdoc:param>$s2 The second string.</xqdoc:param><xqdoc:param>$r A regular expression forming the delimiter character(s) which mark the boundaries between adjacent tokens.</xqdoc:param><xqdoc:param>$t A threshold for the similarity function used to discover token identity.</xqdoc:param><xqdoc:param>$prefix The number of characters to consider when testing for equal prefixes with the Jaro-Winkler metric.</xqdoc:param><xqdoc:param>$fact The weighting factor to consider when the input strings have equal prefixes with the Jaro-Winkler metric.</xqdoc:param><xqdoc:return>The cosine similarity coefficient between the sets tokens extracted from the two strings.</xqdoc:return><xqdoc:custom tag="example">test/Queries/data-cleaning/hybrid-string-similarity/soft-cosine-tokens-jaro-winkler.xq</xqdoc:custom></xqdoc:comment><xqdoc:name>simh:soft-cosine-tokens-jaro-winkler</xqdoc:name><xqdoc:signature>declare function simh:soft-cosine-tokens-jaro-winkler($s1 as xs:string, $s2 as xs:string, $r as xs:string, $t as xs:double, $prefix as xs:integer?, $fact as xs:double?) as xs:double</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>s1</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>s2</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>r</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>t</xqdoc:name><xqdoc:type>xs:double</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>prefix</xqdoc:name><xqdoc:type occurrence="?">xs:integer</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>fact</xqdoc:name><xqdoc:type occurrence="?">xs:double</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type>xs:double</xqdoc:type></xqdoc:return><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions/math</xqdoc:uri><xqdoc:name>sqrt</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>count</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>not</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="3"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>subsequence</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>sum</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="2"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>tokenize</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="4"><xqdoc:uri>http://zorba.io/modules/data-cleaning/character-based-string-similarity</xqdoc:uri><xqdoc:name>jaro-winkler</xqdoc:name></xqdoc:invoked></xqdoc:function><xqdoc:function arity="4"><xqdoc:comment><xqdoc:description> <p>Returns the Monge-Elkan similarity coefficient between two strings, using the Jaro-Winkler</p>
 <p>similarity function to discover token identity.</p>
 <p/>
 <p>Example usage : <pre class="ace-static" ace-mode="xquery"> monge-elkan-jaro-winkler("Comput. Sci. and Eng. Dept., University of California, San Diego", "Department of Computer Scinece, Univ. Calif., San Diego", 4, 0.1) </pre></p>
 <p/>
 <p>The function invocation in the example above returns : <pre class="ace-static" ace-mode="xquery"> 0.992 </pre></p>
</xqdoc:description><xqdoc:param>$s1 The first string.</xqdoc:param><xqdoc:param>$s2 The second string.</xqdoc:param><xqdoc:param>$prefix The number of characters to consider when testing for equal prefixes with the Jaro-Winkler metric.</xqdoc:param><xqdoc:param>$fact The weighting factor to consider when the input strings have equal prefixes with the Jaro-Winkler metric.</xqdoc:param><xqdoc:return>The Monge-Elkan similarity coefficient between the two strings.</xqdoc:return><xqdoc:custom tag="example">test/Queries/data-cleaning/hybrid-string-similarity/monge-elkan-jaro-winkler.xq</xqdoc:custom></xqdoc:comment><xqdoc:name>simh:monge-elkan-jaro-winkler</xqdoc:name><xqdoc:signature>declare function simh:monge-elkan-jaro-winkler($s1 as xs:string, $s2 as xs:string, $prefix as xs:integer, $fact as xs:double) as xs:double</xqdoc:signature><xqdoc:parameters><xqdoc:parameter><xqdoc:name>s1</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>s2</xqdoc:name><xqdoc:type>xs:string</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>prefix</xqdoc:name><xqdoc:type>xs:integer</xqdoc:type></xqdoc:parameter><xqdoc:parameter><xqdoc:name>fact</xqdoc:name><xqdoc:type>xs:double</xqdoc:type></xqdoc:parameter></xqdoc:parameters><xqdoc:return><xqdoc:type>xs:double</xqdoc:type></xqdoc:return><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>count</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>max</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>min</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="1"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>sum</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="2"><xqdoc:uri>http://www.w3.org/2005/xpath-functions</xqdoc:uri><xqdoc:name>tokenize</xqdoc:name></xqdoc:invoked><xqdoc:invoked arity="4"><xqdoc:uri>http://zorba.io/modules/data-cleaning/character-based-string-similarity</xqdoc:uri><xqdoc:name>jaro-winkler</xqdoc:name></xqdoc:invoked></xqdoc:function></xqdoc:functions></xqdoc:xqdoc>