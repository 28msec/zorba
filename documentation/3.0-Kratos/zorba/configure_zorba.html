<div class="doxygen">
  <div><h1 class="title">Configuring a Zorba Build Using CMake</h1>
<div id="configure_overview" class="sect1"><h2>Overview</h2>
We will now configure the Zorba build by running CMake. We assume that the appropriate build preparations (described in <a href="/pages/3.0/zorba/build_prepare">Preparing to Build Zorba</a>) have been performed.<div class="note">The instructions in this section are based on executing commands at the command line. It is also possible configure Zorba using CMake's GUI configuration utility if you prefer. On Linux distributions, this is often a separate package named <b>"cmake-gui"</b>. On Windows, the GUI is installed by default and can be started via the Start menu. On MacOS, it is available as the <b>"gui"</b> variant of the <a href="http://www.cmake.org/" target="_blank">CMake</a> package.<simplesectsep/>The important configuration parameters - source and build directory; CMake generator; configuration flags - are the same whether you use the command-line or the GUI form of CMake. Only the method by which you specify them will change.</div>
The basic steps to configure Zorba are:<ol>
<li>Change the working directory into the <tt>{ZORBABUILD}</tt> directory: <pre class="ace-static" ace-mode="xquery"><span class="normal">cd<span> </span>{ZORBABUILD}</span>
</pre></li><li>Execute cmake: <pre class="ace-static" ace-mode="xquery"><span class="normal"><span> </span>cmake<span> </span>[<span> </span>-G<span> </span>generator<span> </span>]<span> </span>[<span> </span>-D<span> </span>option=value<span> </span>...<span> </span>]<span> </span>{ZORBASRC}</span>
</pre> where <tt>{ZORBASRC}</tt> may be an absolute or a relative path to your Zorba source directory. For example, if you used the convention of creating the build directory as a subdirectory of the source directory, you can just type <pre class="ace-static" ace-mode="xquery"><span class="normal"><span> </span>cmake<span> </span>..<span> </span></span>
</pre> along with any necessary <tt>-G</tt> or <tt>-D</tt> options.</li></ol>
This command should configure Zorba and prepare for the build. CMake will tell you if your environment is missing some of the required libraries or development headers.The meaning of the <tt>-G</tt> and <tt>-D</tt> arguments are described below.<div class="note">If you need to re-configure the project later, CMake will remember your chosen generator and <tt>-D</tt> configuration parameters; it is not necessary to specify <tt>-G</tt> / <tt>-D</tt> every time.</div>
</div>
<div id="configure_generator" class="sect1"><h2>CMake Generators (the -G argument)</h2>
CMake is a meta build system. It is able to generate both native makefiles (e.g. GNU Make or NMake) and IDE workspaces (e.g. Visual Studio or KDevelop Projects), depending on which CMake <em>generator</em> is selected. By default it will generate a UNIX-style Makefile-based project.You specify the generator to use with the <tt>-G</tt> arguments to <tt>cmake</tt>. For example, on Windows, you can create a Visual Studio 10 solution by executing the following command in the <tt>{ZORBASRC}</tt> directory: <pre class="ace-static" ace-mode="xquery"><span class="normal">cmake<span> </span>-G<span> </span></span><span class="stringliteral">"Visual<span> </span>Studio<span> </span>10"</span><span class="normal"><span> </span>{ZORBASRC}<span> </span></span>
</pre>The list of available Generators for your CMake installation can be seen by typing <pre class="ace-static" ace-mode="xquery"><span class="normal"><span> </span>cmake<span> </span>--help<span> </span></span>
</pre>.</div>
<div id="configure_parameters" class="sect1"><h2>Configuration Parameters (the -D arguments)</h2>
In most circumstances it will be necessary to specify a few parameters to CMake, such as the various configuration parameters mentioned above in <a href="/pages/3.0/zorba/build_prerequisites?anchor=third_party_libs">Library Dependencies</a>. You do this with a series of <tt>-D</tt> arguments to CMake. For example, to build Zorba without ICU (Unicode) support:<pre class="ace-static" ace-mode="xquery"><span class="normal">cmake<span> </span>-D<span> </span>ZORBA_NO_ICU=ON<span> </span>{ZORBASRC}</span>
</pre>A complete list of Zorba's configuration parameters can be found here: <a href="/pages/3.0/zorba/configuration_parameters">Zorba Configuration Parameters</a>. CMake itself also has some configuration parameters that may be important for you; here are three of the most common:<ol>
<li>CMake will look for third-party libraries in a variety of standard locations. If you have any installed in unusual locations, you will need to provide it with additional paths to search. You do this by specifying the parameter <tt>CMAKE_PREFIX_PATH</tt>. This parameter is a semicolon-separated list of directories where CMake should look. For instance, if you have Xerces-C installed in <tt>/opt</tt>, try the following: <pre class="ace-static" ace-mode="xquery"><span class="normal">cmake<span> </span>-D<span> </span>CMAKE_PREFIX_PATH=/opt<span> </span>{ZORBASRC}</span>
</pre> <div><h4>Returns</h4><title>On Linux and MacOS:</title>In command lines, the semicolon is interpretted by the shell as a command separator. In order to pass a semicolon-separated list of paths for this parameter, be sure to enlose the list in single- or double-quotes. </div>
<div><h4>Returns</h4><title>On Windows:</title>Zorba uses a custom mechanism for specifying the paths to third-party dependencies on Windows, which handles some additional features such as collecting the runtime DLLs for installation. You should use this mechanism instead of <tt>CMAKE_PREFIX_PATH</tt> on Windows. See <a href="/pages/3.0/zorba/build_windows?anchor=windows_autodll">Zorba's Automatic DLL Detection Mechanism</a> for more information.</div>
</li><li>After you build Zorba, you will likely want to install it into a final location. You specify this location with the <tt>CMAKE_INSTALL_PREFIX</tt> parameter. By default, this directory will be <tt>{ZORBABUILD}/dist</tt>, which is not likely to be a useful location. <div><h4>Returns</h4><title>Note:</title>After installation, the directory specified here will contain subdirectories such as <tt>bin/</tt>, <tt>lib/</tt>, and <tt>share/</tt>. On Unix and MacOS installations, a common value for <tt>CMAKE_INSTALL_PREFIX</tt> is <tt>/usr/local</tt>. On Windows, something like <tt>C:\Program Files\Zorba</tt> is suggested. </div>
<div><h4>Returns</h4><title>Note for Makefile-based projects:</title>The Makefiles produced by CMake do support the common <tt>DESTDIR</tt> variable. However, specifying this variable at compile time <em>will not work</em> with Zorba, because certain installation paths are hard-coded into the Zorba binaries. Be sure to only use <tt>CMAKE_INSTALL_PREFIX</tt>.</div>
</li><li>When generating a Makefile-based project, CMake supports multiple build configurations. By default, Zorba is built in the Release configuration, which enables compiler optimizations and does not build debug information into the resulting product. To change the build mode to Debug, you can specify the <tt>CMAKE_BUILD_TYPE</tt> parameter as follows: <pre class="ace-static" ace-mode="xquery"><span class="normal"><span> </span>cmake<span> </span>-D<span> </span>CMAKE_BUILD_TYPE=Debug<span> </span>{ZORBASRC}<span> </span></span>
</pre> This is not necessary for IDE-based workspaces; in that case, you may select the type of build from within the IDE.</li></ol>
</div>
<div id="configure_next" class="sect1"><h2>What's next?</h2>
Once CMake runs without reporting any configuration errors, move on to <a href="/pages/3.0/zorba/build_and_install">Building and Installing Zorba</a>. </div>
    </div>
</div>