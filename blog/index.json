{ "title" : "28.io - Blog", "tags" : {  }, "entries" : [ { "title" : "Zorba 3.0 - Kratos", "id" : "/68780805079/zorba-30--kratos", "updated" : "Mon, 02 Dec 2013 09:44:00 -0500", "summary" : "We are more than proud to announce the release of Zorba 3.0, codename Kratos. Kratos contains major improvements of the JSONiq language, the language bindings, as well as all of the XQuery and JSONiq modules. Moreover, we made considerable performance improvements and fixed a huge number of bugs. Because we can’t elaborate on all changes, please refer to to the ChangeLog for an exhaustive list of changes.", "content" : "<p>We are more than proud to announce the release of Zorba 3.0, codename Kratos. Kratos contains major improvements of the JSONiq language, the language bindings, as well as all of the XQuery and JSONiq modules. Moreover, we made considerable performance improvements and fixed a huge number of bugs. Because we can&#8217;t elaborate on all changes, please refer to to the ChangeLog for an exhaustive list of changes.</p>\n<h2>JSONiq</h2>\n<p>We have been keeping up with the latest <a href=\"http://jsoniq.org\" target=\"_blank\">JSONiq language improvements.</a></p>\n<h3>Array Selectors and Array Unboxing</h3>\n<p>JSONiq now features a syntactically much pleasant way to unbox an array or select a member of an array. For example,</p>\n<pre>[ \"foo\", \"bar\" ] [[2]]</pre>\n<p>extract the second member of the array (&#8220;bar&#8221;).</p>\n<p>Since JSONiq expressions are composable, you can also use any expression for the left-hand side.</p>\n<pre>{ field : [ \"one\",  { \"foo\" : \"bar\" } ] }.field[[2]].foo</pre>\n<p>returns &#8220;bar&#8221;.</p>\n<p>Unboxing an array was so far possible using the jn:members function. JSONiq now features a convenient syntax for doing this.</p>\n<pre>[ \"foo\", \"bar\" ][]</pre>\n<p>returns &#8220;foo&#8221; and &#8220;bar&#8221;.</p>\n<p>Because all the JSONiq functions and (updating) expressions implement implicit iteration and skip input to which the functionality is not applicable, you can now write something like</p>\n<pre>([ \"foo\", \"bar\" ], { \"foo\" : \"bar\" }, true, [ 1, 2, 3 ] )[</pre>\n<p>which returns</p>\n<pre>\"foo\" \"bar\" 1 2 3</pre>\n<h2>JSound</h2>\n<p>Over the past decade, the need for more flexible and scalable dataformats such as JSON has greatly increased. The NoSQL universe brings many new ideas on how to build scalable data storage. With JSONiq and Zorba you can easily process all such kinds of data stored in a variety of NoSQL stores. The last missing piece is a way to make sure that the data stored is consistent and sound. This is where schemas come into play. With Zorba 3.0, we are proud to announce the first beta implementation of the <a href=\"http://www.jsoniq.org/docs/JSOund/html-single/\">JSound schema definition language</a>.</p>\n<p>The JSound module provides functions to validate JSONiq objects or arrays (called instances) against a JSound schema. The following example validates a JSON instance object against the line type in an images schema.</p>\n<pre>import module namespace jsv = \"http://jsound.io/modules/validate\";\n\nlet $jsd := {\n   \"$namespace\" : \"http://zorba.io/modules/images/\",\n   \"$types\" : [\n    {\n      \"$name\" : \"line\",\n      \"$kind\" : \"object\",\n      \"$content\" :\n      {\n        \"start\" :\n        {\n          \"$type\" : \"integer\"\n        },\n        \"end\" :\n        {\n          \"$type\" : \"integer\"\n        }\n      }\n    }\n   ]\n}\n\nlet $instance := {\n  \"start\": 1,\n  \"end\": 5\n}\nreturn\n  jsv:jsd-valid($jsd, \"line\", \"http://zorba.io/modules/images/\", $instance)</pre>\n<p>The implementation is still beta but we are working on testing and finalizing it with the upcoming release.</p>\n<h2>Modules &amp; Functions</h2>\n<p>Beyond the JSONiq changes, we also JSONified several of the modules making them much easier to use.</p>\n<h2>CSV-to-JSON and Back</h2>\n<p>A huge amount of data out there is fully structured and available in the CSV format. Mostly, this data comes out of the world&#8217;s most famous BI tool (aka Excel) or relational databases. With Zorba&#8217;s new CSV-JSON conversion module, it&#8217;s very easy to parse CSV data making it available for processing using the powerful JSONiq language.</p>\n<p>For example, consider the following query:</p>\n<pre>import module namespace csv = \"http://zorba.io/modules/json-csv\";\n\nlet $csv := \"string,integer,decimal,double,boolean,null\nfoo,42,98.6,1E4,false,null\"\nreturn csv:parse($csv)</pre>\n<p>which returns</p>\n<pre>{ \"string\" : \"foo\", \"integer\" : 42, \"decimal\" : 98.6, \"double\" : 10000, \"boolean\" : false, \"null\" : null }</pre>\n<p>The parse function provides a huge number of options to customize the conversion (e.g. configuring the separator, turning off casting of unquoted values, or providing custom field names). Of course, the module also allows serialization of JSONiq objects to CSV.</p>\n<pre>import module namespace csv = \"http://zorba.io/modules/json-csv\";                                                                                          \n \nlet $values := (\n  {\n    \"first\" : \"one\",                                                                                                                                                                  \n    \"second\" : \"two\",\n    \"third\" : \"three\"\n  },\n  {   \n    \"first\" : \"four\",                                                                                                                                                                 \n    \"second\" : \"embedded \\\" quote\",\n    \"third\" : \"embedded\\r\\nnewline\" \n  }       \n)\nlet $options := { \"field-names\" : [ \"first\", \"second\", \"third\" ] }                                                                                                                    \nreturn csv:serialize( $values, $options )</pre>\n<h2>HTTP-Client</h2>\n<p>The HTTP-Client module is a crucial piece for communicating with any kind of service on the Web. So far, the input and output of functions in this module were based on the XML data model (using nodes) making it very hard to use. We have rewritten the module to leverage the JSONiq data model (using objects and arrays) - allowing the developer to interact with the Web much easier. For example, making a complex HTTP request (i.e. including custom headers) and processing the result as XML is as easy as</p>\n<pre>import module namespace http = \"http://zorba.io/modules/http-client\";\n\nlet $req :=\n{\n  \"method\": \"POST\",\n  \"href\": \"http://zorbatest.lambda.nu:8080/http-test-data/request.php\",\n  \"headers\": {\"foo\":\"bar\"},\n  \"body\": {\n    \"media-type\": \"text/plain\",\n    \"content\": \"\n      Dies ist ein kleiner Test\n    \"\n  }\n};\nreturn parse-xml(http:send-request($req).body.content)</pre>\n<h2>And Much More</h2>\n<ul><li>All modules take their options as JSONiq objects which greatly improves usability.</li>\n<li>More and improved optimization rules like hoisting, flwor-merging, or sort elimination.</li>\n<li>Full encoding support in the file module.</li>\n<li>Performance improvements of castable as and binary en- and decoding.</li>\n<li>Even better conformance with the XQuery 3.0 conformance test suite.</li>\n<li>A new module for fast set-based sequence operations such as value-intersect or value-except.</li>\n</ul><p>We can&#8217;t wait for you to download Zorba 3.0 and give it a try!</p>", "authors" : [  ], "tags" : [  ] }, { "title" : "Zorba 2.9 - Io", "id" : "/68774681365/zorba-29--io", "updated" : "Mon, 02 Dec 2013 07:34:21 -0500", "summary" : "The Zorba Team is proud to announce the release of Zorba 2.9, codename Io! Io includes extensions and improvements to our JSONiq support; enhanced support for Higher-Order Functions (HOF); and extensive improvements in XQuery 3.0 comformance.", "content" : "<p><span>The Zorba Team is proud to announce the release of Zorba 2.9, codename Io! Io includes extensions and improvements to our </span><a href=\"http://www.jsoniq.org/\">JSONiq</a><span> support; enhanced support for Higher-Order Functions (HOF); and extensive improvements in XQuery 3.0 comformance. There are also many optimizations, a number of new features, and more than 65 bug fixes! We can&#8217;t cover everything here, so please see the </span><a href=\"https://launchpadlibrarian.net/142881735/ChangeLog\">ChangeLog</a><span> for complete information.</span></p>\n\n<h1>JSONiq</h1>\n<p><a href=\"http://www.jsoniq.org/\">JSONiq</a><span> - the language for querying JSON data - has been expanding, and Zorba&#8217;s implementation is keeping up. New in this release is the ability to declare a module or query to be JSONiq via a version declaration (the first line of the query)&#160;:</span></p>\n<pre>jsoniq version \"1.0\";\n</pre>\n<p><span>You can also save your query in a file with a &#8220;.jq&#8221; extension to enable this.</span></p>\n<p>Doing so invokes a new JSONiq query parser which offers several syntax improvements for dealing with JSON data. In particular, you can now use the familiar &#8220;.&#8221; notation for accessing JSON object members:</p>\n<pre>let $obj := { \"field1\" : 42 }\nreturn $obj.field1\n</pre>\n<p><span>This parser also understands JSON-style string escape characters, instead of XML-style &amp;XXX; character references. So you should be able to cut-and-paste valid JSON into your query.</span></p>\n<h1>Higher-Order Functions</h1>\n<p><span>Zorba has supported for </span><em>function items</em><span> for some time, but Zorba 2.9 ups the ante with full support for XQuery 3.0 </span><em>Higher-Order Functions</em><span> - functions that take other functions as arguments. This includes sequence-type extensions for declaring variables and parameters as specifically-typed functions; dynamic function evaluation; and even partial function application, which is a powerful functional-programming technique. Zorba 2.9 also includes the XQuery 3.0 functions dealing with higher-order functions, such as</span><code>fn:filter()</code><span> and </span><code>fn:for-each()</code><span>. Be on the lookup for a future blog entry covering these features in more detail.</span></p>\n<h1>XQuery 3.0 Conformance</h1>\n<p><span>The W3C has a conformance test suite for XQuery 1.0 and 3.0 called </span><a href=\"http://dev.w3.org/2011/QT3-test-suite/\">QT3</a><span>, which comprises over 26,000 test cases. While Zorba 2.8 had good compliance, we made strides in this release to clean up many small (and a few not-so-small) conformance issues. Zorba 2.9 boasts over 99.5% conformance with XQuery 1.0, and 99.1% conformance with XQuery 3.0. Check out our </span><a href=\"http://www.zorba.io/documentation/2.9/zorba/conformance.html\">full conformance report</a><span>, including details of our support for XQuery Update Facility and XQuery Full-Text.</span></p>\n<h1>And much more</h1>\n<ul><li>Extensions to the &#8220;uri&#8221; module for parsing URIs into components</li>\n<li>Support for XML canonicalization in the &#8220;xml&#8221; module</li>\n<li>Support for most XML Schema 1.1 features, including <code>xs:dateTimeStamp</code></li>\n<li><code>typeswitch</code> extended to support unions of types</li>\n<li>&#8230;.</li>\n</ul><p><span>Go check it out today! </span></p>", "authors" : [  ], "tags" : [  ] }, { "title" : "Zorba 2.8 - The (No)SQL Edition", "id" : "/60028721581/zorba-28--the-nosql-edition", "updated" : "Wed, 23 Jan 2013 00:00:00 -0500", "summary" : "The Zorba team is pleased to announce the release of Zorba 2.8, codename Hermes. Hermes ships five new modules: four brand new database drivers and a new info-extraction module for querying concepts and entities in natural language text. This release provides several improvements in the Zorba optimizer and twenty-two bug fixes (see Changelog). It is available in our download section.", "content" : "<div class=\"entry-info\">\n<p>The Zorba team is pleased to announce the release of Zorba 2.8, codename Hermes. Hermes ships five new modules: <a href=\"/html/modules/db/couchbase\">four brand new database drivers</a> and a new <a href=\"/html/modules/zorba/data-cleaning/info-extraction\">info-extraction module</a> for querying concepts and entities in natural language text. This release provides several improvements in the Zorba optimizer and twenty-two bug fixes (see <a href=\"https://launchpadlibrarian.net/129093447/ChangeLog\">Changelog</a>). It is available in our <a href=\"/html/download\">download section</a>.</p>\n</div>\n<div class=\"entry-content\">\n<h2>New Database Drivers</h2>\nLast summer, we released <a href=\"http://www.zorba-xquery.com/html/entry/2012/08/20/Eros\">the first JSONiq implementation</a>. <a href=\"http://jsoniq.org/\">JSONiq</a> extends the XQuery data model with JSON objects and arrays. It enables developers to leverage the power and expressiveness of XQuery in both JSON stores and relational databases. Moreover, JSONiq is a unified query language that you can run accross multiple NoSQL stores. It also brings advanced query processing features in this space: joins, aggregation, windows, full-text search, collation support, powerful date/time arithmetic, and more. Hermes contains four new databases drivers in order to help you process your data:\n\n<ul><li><a href=\"/html/modules/db/couchbase\">Couchbase</a></li>\n<li><a href=\"/html/modules/db/oracle-nosql\">Oracle NoSQL</a></li>\n<li><a href=\"/html/modules/db/sqlite\">SQLite</a></li>\n<li><a href=\"/html/modules/db/jdbc\">JDBC</a></li>\n</ul><p></p>\n<h3>Couchbase</h3>\n<p><a href=\"http://www.couchbase.com/\">Couchbase</a> is a key-value database management system optimized for storing unstructured data. In the code snippet below, we connect to a couchbase instance at <em>localhost:8091</em> and create a view on the bucket where the key of the map is the name of the state and the value is the population. For each row in the document, we group them by state and compute the total population for the state. Finally, we return the list of states with their total population.</p>\n<pre class=\"ace-static\"><span class=\"keyword\">import</span><span class=\"text\"> </span><span class=\"keyword\">module</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">couchbase</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://www.zorba-xquery.com/modules/couchbase\"</span><span class=\"text\">;</span><br/><br/><span class=\"keyword\">variable</span><span class=\"text\"> </span><span class=\"variable\">$con</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"support function\">couchbase:connect</span><span class=\"lparen\">(</span><span class=\"lparen\">{</span><br/><span class=\"text\">  </span><span class=\"string\">\"host\"</span><span class=\"text\">: </span><span class=\"string\">\"localhost:8091\"</span><span class=\"text\">,</span><br/><span class=\"text\">  </span><span class=\"string\">\"username\"</span><span class=\"text\"> : </span><span class=\"identifier\">null</span><span class=\"text\">,</span><br/><span class=\"text\">  </span><span class=\"string\">\"password\"</span><span class=\"text\"> : </span><span class=\"identifier\">null</span><span class=\"text\">,</span><br/><span class=\"text\">  </span><span class=\"string\">\"bucket\"</span><span class=\"text\"> : </span><span class=\"string\">\"default\"</span><br/><span class=\"rparen\">}</span><span class=\"rparen\">)</span><span class=\"text\">;</span><br/><br/><span class=\"keyword\">variable</span><span class=\"text\"> </span><span class=\"variable\">$view-name</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"support function\">couchbase:create-view</span><span class=\"lparen\">(</span><span class=\"variable\">$con</span><span class=\"text\">, </span><span class=\"string\">\"zip\"</span><span class=\"text\">, </span><span class=\"string\">\"zip\"</span><span class=\"text\">, </span><span class=\"lparen\">{</span><span class=\"string\">\"key\"</span><span class=\"text\"> : </span><span class=\"string\">\"doc.state\"</span><span class=\"text\">, </span><span class=\"string\">\"values\"</span><span class=\"text\"> : </span><span class=\"string\">\"doc.pop\"</span><span class=\"rparen\">}</span><span class=\"rparen\">)</span><span class=\"text\">;</span><br/><span class=\"keyword\">variable</span><span class=\"text\"> </span><span class=\"variable\">$data</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"support function\">couchbase:view</span><span class=\"lparen\">(</span><span class=\"variable\">$con</span><span class=\"text\">, </span><span class=\"variable\">$view-name</span><span class=\"rparen\">)</span><span class=\"text\">;</span><br/><br/><span class=\"keyword\">for</span><span class=\"text\"> </span><span class=\"variable\">$d</span><span class=\"text\"> </span><span class=\"keyword\">in</span><span class=\"text\"> </span><span class=\"variable\">$data</span><span class=\"lparen\">(</span><span class=\"string\">\"rows\"</span><span class=\"rparen\">)</span><span class=\"text\"> ! </span><span class=\"support function\">jn:members</span><span class=\"lparen\">(</span><span class=\"text\">.</span><span class=\"rparen\">)</span><br/><span class=\"keyword\">group</span><span class=\"text\"> </span><span class=\"keyword\">by</span><span class=\"text\"> </span><span class=\"variable\">$state</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"variable\">$d</span><span class=\"lparen\">(</span><span class=\"string\">\"key\"</span><span class=\"rparen\">)</span><br/><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$population</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"support function\">sum</span><span class=\"lparen\">(</span><span class=\"variable\">$d</span><span class=\"lparen\">(</span><span class=\"string\">\"value\"</span><span class=\"rparen\">)</span><span class=\"rparen\">)</span><br/><span class=\"keyword\">return</span><span class=\"text\"> </span><span class=\"lparen\">{</span><span class=\"text\"> </span><span class=\"string\">\"state\"</span><span class=\"text\"> : </span><span class=\"variable\">$state</span><span class=\"text\">, </span><span class=\"string\">\"population\"</span><span class=\"text\"> : </span><span class=\"variable\">$population</span><span class=\"text\"> </span><span class=\"rparen\">}</span></pre>\n<h3>Oracle NoSQL</h3>\n<p><a href=\"http://www.oracle.com/technetwork/products/nosqldb/overview/index.html\">Oracle NoSQL Database</a> is a distributed key-value database. It is built upon the proven Oracle Berkeley DB Java Edition high-availability storage engine. In the code snippet below, we connect to an Oracle NoSQL instance and run the same aggregation query than above. The Oracle NoSQL module has advanced functions that allow to return multiple objects at once. For example, in order to retrieve all zip documents from the database as JSON, the multi-get-json function can be used as follows:</p>\n<pre class=\"ace-static\"><span class=\"keyword\">import</span><span class=\"text\"> </span><span class=\"keyword\">module</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">nosql</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://www.zorba-xquery.com/modules/oracle-nosqldb\"</span><span class=\"text\">;</span><br/><br/><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$con</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"support function\">nosql:connect</span><span class=\"lparen\">(</span><span class=\"lparen\">{</span><span class=\"text\"> </span><span class=\"string\">\"store-name\"</span><span class=\"text\"> : </span><span class=\"string\">\"kvstore\"</span><span class=\"text\">, </span><span class=\"string\">\"helper-host-ports\"</span><span class=\"text\"> : </span><span class=\"lparen\">[</span><span class=\"string\">\"localhost:5000\"</span><span class=\"rparen\">]</span><span class=\"text\"> </span><span class=\"rparen\">}</span><span class=\"rparen\">)</span><br/><span class=\"keyword\">for</span><span class=\"text\"> </span><span class=\"variable\">$zip</span><span class=\"text\"> </span><span class=\"keyword\">in</span><span class=\"text\"> </span><span class=\"support function\">nosql:multi-get-json</span><span class=\"lparen\">(</span><span class=\"variable\">$db</span><span class=\"text\">, </span><span class=\"lparen\">{</span><span class=\"text\"> </span><span class=\"string\">\"major\"</span><span class=\"text\"> : </span><span class=\"string\">\"zips\"</span><span class=\"text\"> </span><span class=\"rparen\">}</span><span class=\"text\">, </span><span class=\"lparen\">{</span><span class=\"string\">\"prefix\"</span><span class=\"text\">: </span><span class=\"string\">\"\"</span><span class=\"rparen\">}</span><span class=\"text\">,</span><br/><span class=\"text\">                                 </span><span class=\"variable\">$nosql:depth-PARENT_AND_DESCENDANTS</span><span class=\"text\">,</span><br/><span class=\"text\">                                 </span><span class=\"variable\">$nosql:direction-FORWARD</span><span class=\"rparen\">)</span><span class=\"lparen\">(</span><span class=\"string\">\"value\"</span><span class=\"rparen\">)</span><br/><span class=\"keyword\">group</span><span class=\"text\"> </span><span class=\"keyword\">by</span><span class=\"text\"> </span><span class=\"variable\">$state</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"variable\">$zip</span><span class=\"lparen\">(</span><span class=\"string\">\"state\"</span><span class=\"rparen\">)</span><br/><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$pop</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"support function\">sum</span><span class=\"lparen\">(</span><span class=\"variable\">$zip</span><span class=\"lparen\">(</span><span class=\"string\">\"pop\"</span><span class=\"rparen\">)</span><span class=\"rparen\">)</span><br/><span class=\"keyword\">return</span><span class=\"text\"> </span><span class=\"lparen\">{</span><span class=\"text\"> </span><span class=\"string\">\"state\"</span><span class=\"text\">: </span><span class=\"variable\">$state</span><span class=\"text\">, </span><span class=\"string\">\"population\"</span><span class=\"text\"> : </span><span class=\"variable\">$pop</span><span class=\"text\"> </span><span class=\"rparen\">}</span></pre>\n<h3>SQLite</h3>\n<p><a href=\"http://www.sqlite.org/\">SQLite</a> is a self-contained, serverless, zero-configuration, transactional SQL database engine. In the code snippet below, we connect to a database located at <em>small.db</em> and get all fields from all rows in <em>maintable</em>.</p>\n<pre class=\"ace-static\"><span class=\"keyword\">import</span><span class=\"text\"> </span><span class=\"keyword\">module</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">s</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://www.zorba-xquery.com/modules/sqlite\"</span><span class=\"text\">;</span><br/><br/><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$con</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"support function\">s:connect</span><span class=\"lparen\">(</span><span class=\"string\">\"small.db\"</span><span class=\"rparen\">)</span><br/><span class=\"keyword\">return</span><span class=\"text\"> </span><span class=\"support function\">s:execute-query</span><span class=\"lparen\">(</span><span class=\"variable\">$con</span><span class=\"text\">, </span><span class=\"string\">\"select * from maintable\"</span><span class=\"rparen\">)</span><span class=\"text\">;</span></pre>\n<h3>JDBC</h3>\n<p>The <a href=\"http://www.oracle.com/technetwork/java/javase/jdbc/index.html\">JDBC</a> modules enables to query any JDBC enabled database (there are quite a few ;-)). In the code snippet below, we connect to a MySQL database running at <em>localhost:3307</em>, and get all fields from all rows in <em>maintable</em></p>\n<pre class=\"ace-static\"><span class=\"keyword\">import</span><span class=\"text\"> </span><span class=\"keyword\">module</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">jdbc</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://www.zorba-xquery.com/modules/jdbc\"</span><span class=\"text\">;</span><br/><br/><span class=\"keyword\">variable</span><span class=\"text\"> </span><span class=\"variable\">$con</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"support function\">jdbc:connect</span><span class=\"lparen\">(</span><span class=\"lparen\">{</span><br/><span class=\"text\">  </span><span class=\"string\">\"url\"</span><span class=\"text\">: </span><span class=\"string\">\"jdbc:mysql://localhost:3307/\"</span><span class=\"text\">,</span><br/><span class=\"text\">  </span><span class=\"string\">\"user\"</span><span class=\"text\"> : </span><span class=\"string\">\"root\"</span><span class=\"text\">,</span><br/><span class=\"text\">  </span><span class=\"string\">\"password\"</span><span class=\"text\"> : </span><span class=\"string\">\"\"</span><br/><span class=\"rparen\">}</span><span class=\"rparen\">)</span><span class=\"text\">;</span><br/><br/><span class=\"support function\">jdbc:execute-query</span><span class=\"lparen\">(</span><span class=\"variable\">$con</span><span class=\"text\">, </span><span class=\"string\">\"select * from maintable\"</span><span class=\"rparen\">)</span></pre>\n<h2>Info Extraction</h2>\n<p>Hermes introduces a new <a href=\"/html/modules/zorba/data-cleaning/info-extraction\">info extraction module</a>, providing data extraction functions that return the entities, relations, categories and concepts present in a given text, with basis on <a href=\"http://developer.yahoo.com/contentanalysis/\">Yahoo&#8217;s Content Analysis webservice</a>.</p>\n<p>In the example below, we extract the concepts available from a random newpaper headline:</p>\n<pre class=\"ace-static\"><span class=\"keyword\">import</span><span class=\"text\"> </span><span class=\"keyword\">module</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">ex</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://www.zorba-xquery.com/modules/info-extraction\"</span><span class=\"text\">;</span><br/><span class=\"text\">          </span><br/><span class=\"support function\">ex:entities</span><span class=\"lparen\">(</span><span class=\"string\">\"President Obama called Wednesday on Congress to extend a tax break for students.\"</span><span class=\"rparen\">)</span></pre>\n<p>This query will return (you can also <a href=\"http://www.zorba-xquery.com/html/demo#9AkjaMnWwGYpJXJGQ7vswhVsOuc=\">try it live</a>):</p>\n<pre class=\"ace-static\"><span class=\"xml_pe\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span><br/><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">ex:entity</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">xmlns:ex</span><span class=\"keyword operator\">=</span><span class=\"string\">\"http://www.zorba-xquery.com/modules/info-extraction\"</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">start</span><span class=\"keyword operator\">=</span><span class=\"string\">\"0\"</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">end</span><span class=\"keyword operator\">=</span><span class=\"string\">\"14\"</span><span class=\"meta tag\">&gt;</span><br/><span class=\"text\">  President Obama</span><br/><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">ex:entity</span><span class=\"meta tag\">&gt;</span><br/><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">ex:entity</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">xmlns:ex</span><span class=\"keyword operator\">=</span><span class=\"string\">\"http://www.zorba-xquery.com/modules/info-extraction\"</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">start</span><span class=\"keyword operator\">=</span><span class=\"string\">\"36\"</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">end</span><span class=\"keyword operator\">=</span><span class=\"string\">\"43\"</span><span class=\"meta tag\">&gt;</span><br/><span class=\"text\">  </span><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">ex:type</span><span class=\"meta tag\">&gt;</span><span class=\"text\">organization</span><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">ex:type</span><span class=\"meta tag\">&gt;</span><span class=\"text\">Congress</span><br/><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">ex:entity</span><span class=\"meta tag\">&gt;</span></pre>\n<h2 id=\"xmlprague\">See you at XMLPrague?</h2>\n<p>It&#8217;s that time of the year. <a href=\"http://www.xmlprague.cz/\">XMLPrague</a> is one of the best conferences in the XML circuit and <a href=\"http://www.xmlprague.cz/sessions/\">this year&#8217;s edition will be no exception</a>.</p>\n<p>Three talks will be given by the Zorba team. Luis Rodriguez will get the show started with <a href=\"http://www.xmlprague.cz/sessions/#xqsql\">XQuery meets SQL</a> and tell us everything about querying relational databases using JSONiq. Then William Candillon, will talk about <a href=\"http://www.xmlprague.cz/sessions/#xqincloud\">XQuery Development in the Cloud(9)</a> and introduce a new browser-based toolkit that relies on static code analysis. Finally, Juan Zacarias will bring <a href=\"http://www.xmlprague.cz/sessions/#nosql\">NoSQL Datastores into an XQuery Playground</a> and showcase how developers can leverage the power of JSONiq in the NoSQL space.</p>\n<h2>That&#8217;s all for now</h2>\n<p>We hope that you will take Zorba 2.8 for a ride and we are looking forward to <a href=\"https://groups.google.com/forum/?fromgroups#!search/zorba-users\">your feedback</a>.</p>\n</div>", "authors" : [  ], "tags" : [  ] }, { "title" : "A Time Saver on Multiple Query Executions", "id" : "/60028669088/a-time-saver-on-multiple-query-executions", "updated" : "Fri, 07 Dec 2012 00:00:00 -0500", "summary" : "An underused feature of Zorba is its capability to compile query plans for later execution.", "content" : "<div class=\"entry-info\">\n<p><span>An underused feature of Zorba is its capability to compile query plans for later execution.</span></p>\n</div>\n<div class=\"entry-content\">\n<p>When executing a query with Zorba, it goes through the following steps:</p>\n<img src=\"http://media.tumblr.com/5ab756c6ef35352940e34cd2d754fda2/tumblr_inline_mx6jr4G24I1rjv2qx.png\"/>\n<ul><li><strong>Parser</strong> - An abstract syntax tree (AST) is created from the query</li>\n<li><strong>Translator</strong> - The AST is converted into a tree of expressions</li>\n<li><strong>Optimizer</strong> - The expressions are rewritten for faster execution</li>\n<li><strong>Code Generator</strong> - The expressions are converted to a tree of iterators (aka, query plan)</li>\n<li><strong>Runtime</strong> - The query plan is executed</li>\n</ul><br/><p>If you run a query multiple times, you might want to perform the steps from parsing to code generation only once and directly execute your query plan for every new runtime. Zorba provides the ability to save a query plan into a file. You then later simply load the query plan and execute it:</p>\n<img src=\"http://media.tumblr.com/376e3a25e7340f4c209467645247d867/tumblr_inline_mx6jrsJOoG1rjv2qx.png\"/><br/><p>There are two ways to compile and execute query plans: using <a href=\"/html/entry/2012/12/10/compile-plan-zorba\">Zorba command line interface (CLI)</a> or the <a href=\"/html/entry/2012/12/10/compile-plan-cxx\">C++ API</a>.</p>\n<h2 id=\"compile-plan-zorba\">Using the Zorba CLI</h2>\n<p>Zorba 2.7 provides two new options for the CLI: <em>&#8212;compile-plan</em> and <em>&#8212;execute-plan</em>.</p>\n<p><em>&#8212;compile-plan</em> outputs the plan in binary format.</p>\n<p><em>&#8212;execute-plan</em> executes the query plan that was given as input query.</p>\n<p>In the figure below we request the query plan of 1+1 and store it into <em>test.xqc</em>. Then we execute <em>test.xqc</em> directly.</p>\n<pre class=\"ace-static\">$zorba -q 1+1 --compile-plan -o test.xqc\n$zorba -q test.xqc -f --execute-plan\n&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n2</pre>\n<p>Now let&#8217;s look at the performance gain that can be achieved by using this feature. <a href=\"http://www.bottlecaps.de/rex/\">REx</a> is a parser generator written by Gunther Rademacher that supports many output formats including XQuery. In the code snippet below, we parse a small piece of XQuery in XQuery.</p>\n<pre class=\"ace-static\"><span class=\"keyword\">import</span><span class=\"text\"> </span><span class=\"keyword\">module</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">p</span><span class=\"keyword operator\">=</span><span class=\"string\">\"XQueryV30\"</span><span class=\"text\"> </span><span class=\"keyword\">at</span><span class=\"text\"> </span><span class=\"string\">\"parser.xq\"</span><span class=\"text\">;</span><br/><br/><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$tree</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"support function\">p:parse-XQuery</span><span class=\"lparen\">(</span><span class=\"string\">'(\"red\", \"blue\", \"green\")!string-length()'</span><span class=\"rparen\">)</span><br/><span class=\"keyword\">return</span><span class=\"text\"> </span><span class=\"variable\">$tree</span></pre>\n<p>Let&#8217;s run it:</p>\n<pre class=\"ace-static\">$zorba -q test-parser.xq -f -t\n&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;XQuery&gt;&lt;Module&gt;&lt;MainModule&gt;&lt;Prolog/&gt;...&lt;/MainModule&gt;&lt;/Module&gt;&lt;EOF/&gt;&lt;/XQuery&gt;\nNumber of executions = 1\nEngine Startup Time     : 0.000 (user: 0.000) milliseconds\nAverage Compilation Time: 6625.271 (user: 6453.332) milliseconds\nAverage Execution Time  : 602.584 (user: 531.234) milliseconds\nAverage Loading Time    : 0.000 (user: 0.000) milliseconds\nAverage Unloading Time  : 0.852 (user: 0.809) milliseconds\nAverage Total Time      : 7237.826 (user: 6990.856) milliseconds\n\nEngine Shutdown Time     : 0.025 (user: 0.019) milliseconds</pre>\n<p>Could be faster&#8230; As you can see, most of the time is spent in compilation: more than 6 seconds. Now let&#8217;s look at the query plan loading and execution</p>\n<pre class=\"ace-static\">$zorba -q test-parser.xq -f --compile-plan -o test-parser.xqc\n$zorba -q test-parser.xqc -f --execute-plan -t\n&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;XQuery&gt;&lt;Module&gt;&lt;MainModule&gt;&lt;Prolog/&gt;...&lt;/MainModule&gt;&lt;/Module&gt;&lt;EOF/&gt;&lt;/XQuery&gt;\nNumber of executions = 1\nEngine Startup Time     : 0.000 (user: 0.000) milliseconds\nAverage Compilation Time: 510.884 (user: 435.228) milliseconds\nAverage Execution Time  : 290.257 (user: 258.943) milliseconds\nAverage Loading Time    : 0.000 (user: 0.000) milliseconds\nAverage Unloading Time  : 1.034 (user: 0.970) milliseconds\nAverage Total Time      : 813.945 (user: 705.542) milliseconds\n\nEngine Shutdown Time     : 0.008 (user: 0.006) milliseconds</pre>\n<p>In the example above, the loading time of the query plan appears in the <em>Compilation Time</em> category. As you can see, the loading and execution of the query plan is more than 9 times faster. This can be a very useful optimization when runing your queries in production.</p>\n<h2 id=\"compile-plan-cxx\">Using the C++ API</h2>\n<p>In the C++ API, the <a href=\"/html/documentation/latest/cxx/classzorba_1_1XQuery\">XQuery</a> class has a method named <a href=\"/html/documentation/latest/cxx/classzorba_1_1XQuery#aec520b912a97dd8c9a0555bccd16900b\">saveExecutionPlan()</a> that takes an output stream as parameter. This is where the query plan will be saved. The second parameter is the output format. It can be binary or XML.</p>\n<p>The XQuery class has a corresponding method <a href=\"/html/documentation/latest/cxx/classzorba_1_1XQuery#a5e95bbc7e19bc4a2bbbadf183bfc7a29\">XQuery::loadExecutionPlan()</a> that takes an input stream as parameter and loads it as a compiled query.</p>\n<p>The code snippet below demonstrates how to use these two methods. We compile <em>1+1</em> and save the query plan into an output string stream. Then, we create a second query to load and execute the query plan previously saved.</p>\n<pre class=\"ace-static\"><span class=\"keyword\">int</span><span class=\"text\"> </span><span class=\"identifier\">main</span><span class=\"paren lparen\">(</span><span class=\"keyword\">int</span><span class=\"text\"> </span><span class=\"identifier\">argc</span><span class=\"punctuation operator\">,</span><span class=\"text\"> </span><span class=\"keyword\">char</span><span class=\"keyword operator\">*</span><span class=\"text\"> </span><span class=\"identifier\">argv</span><span class=\"paren lparen\">[</span><span class=\"paren rparen\">]</span><span class=\"paren rparen\">)</span><span class=\"text\"> </span><br/><span class=\"paren lparen\">{</span><br/><span class=\"text\">  </span><span class=\"comment\">//Startup Zorba</span><br/><span class=\"text\">  </span><span class=\"keyword\">void</span><span class=\"keyword operator\">*</span><span class=\"text\"> </span><span class=\"identifier\">lStore</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"identifier\">zorba</span><span class=\"punctuation operator\">:</span><span class=\"punctuation operator\">:</span><span class=\"identifier\">StoreManager</span><span class=\"punctuation operator\">:</span><span class=\"punctuation operator\">:</span><span class=\"identifier\">getStore</span><span class=\"paren lparen\">(</span><span class=\"paren rparen\">)</span><span class=\"punctuation operator\">;</span><br/><span class=\"text\">  </span><span class=\"identifier\">Zorba</span><span class=\"keyword operator\">*</span><span class=\"text\"> </span><span class=\"identifier\">lZorba</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"identifier\">Zorba</span><span class=\"punctuation operator\">:</span><span class=\"punctuation operator\">:</span><span class=\"identifier\">getInstance</span><span class=\"paren lparen\">(</span><span class=\"identifier\">lStore</span><span class=\"paren rparen\">)</span><span class=\"punctuation operator\">;</span><br/><span class=\"text\">  </span><span class=\"identifier\">std</span><span class=\"punctuation operator\">:</span><span class=\"punctuation operator\">:</span><span class=\"identifier\">ostringstream</span><span class=\"text\"> </span><span class=\"identifier\">lOut</span><span class=\"punctuation operator\">;</span><br/><span class=\"text\">  </span><br/><span class=\"text\">  </span><span class=\"paren lparen\">{</span><br/><span class=\"text\">    </span><span class=\"comment\">//Compile 1+1</span><br/><span class=\"text\">    </span><span class=\"identifier\">XQuery_t</span><span class=\"text\"> </span><span class=\"identifier\">lQuery</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"identifier\">lZorba</span><span class=\"keyword operator\">-</span><span class=\"keyword operator\">&gt;</span><span class=\"identifier\">compileQuery</span><span class=\"paren lparen\">(</span><span class=\"string\">\"1+1\"</span><span class=\"paren rparen\">)</span><span class=\"punctuation operator\">;</span><br/><span class=\"text\">  </span><br/><span class=\"text\">    </span><span class=\"comment\">//Save the query plan</span><br/><span class=\"text\">    </span><span class=\"identifier\">lQuery</span><span class=\"keyword operator\">-</span><span class=\"keyword operator\">&gt;</span><span class=\"identifier\">saveExecutionPlan</span><span class=\"paren lparen\">(</span><span class=\"identifier\">lOut</span><span class=\"punctuation operator\">,</span><span class=\"text\"> </span><span class=\"identifier\">ZORBA_USE_BINARY_ARCHIVE</span><span class=\"punctuation operator\">,</span><span class=\"text\"> </span><span class=\"identifier\">SAVE_UNUSED_FUNCTIONS</span><span class=\"paren rparen\">)</span><span class=\"punctuation operator\">;</span><br/><span class=\"text\">  </span><span class=\"paren rparen\">}</span><br/><br/><span class=\"text\">  </span><span class=\"paren lparen\">{</span><br/><span class=\"text\">    </span><span class=\"identifier\">std</span><span class=\"punctuation operator\">:</span><span class=\"punctuation operator\">:</span><span class=\"identifier\">istringstream</span><span class=\"text\"> </span><span class=\"identifier\">lIn</span><span class=\"paren lparen\">(</span><span class=\"identifier\">lOut</span><span class=\"punctuation operator\">.</span><span class=\"identifier\">str</span><span class=\"paren lparen\">(</span><span class=\"paren rparen\">)</span><span class=\"paren rparen\">)</span><span class=\"punctuation operator\">;</span><br/><span class=\"text\">    </span><span class=\"identifier\">XQuery_t</span><span class=\"text\"> </span><span class=\"identifier\">lQuery</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"identifier\">lZorba</span><span class=\"keyword operator\">-</span><span class=\"keyword operator\">&gt;</span><span class=\"identifier\">createQuery</span><span class=\"paren lparen\">(</span><span class=\"paren rparen\">)</span><span class=\"punctuation operator\">;</span><br/><span class=\"text\">    </span><span class=\"comment\">//Load the query plan</span><br/><span class=\"text\">    </span><span class=\"identifier\">lQuery</span><span class=\"keyword operator\">-</span><span class=\"keyword operator\">&gt;</span><span class=\"identifier\">loadExecutionPlan</span><span class=\"paren lparen\">(</span><span class=\"identifier\">lIn</span><span class=\"paren rparen\">)</span><span class=\"punctuation operator\">;</span><br/><span class=\"text\">    </span><span class=\"comment\">//Execute the query</span><br/><span class=\"text\">    </span><span class=\"identifier\">std</span><span class=\"punctuation operator\">:</span><span class=\"punctuation operator\">:</span><span class=\"identifier\">cout</span><span class=\"text\"> </span><span class=\"keyword operator\">&lt;</span><span class=\"keyword operator\">&lt;</span><span class=\"text\"> </span><span class=\"identifier\">lQuery</span><span class=\"text\"> </span><span class=\"keyword operator\">&lt;</span><span class=\"keyword operator\">&lt;</span><span class=\"text\"> </span><span class=\"identifier\">std</span><span class=\"punctuation operator\">:</span><span class=\"punctuation operator\">:</span><span class=\"identifier\">endl</span><span class=\"punctuation operator\">;</span><br/><span class=\"text\">  </span><span class=\"paren rparen\">}</span><br/><br/><span class=\"text\">  </span><span class=\"comment\">//Shutdown Zorba</span><br/><span class=\"text\">  </span><span class=\"identifier\">lZorba</span><span class=\"keyword operator\">-</span><span class=\"keyword operator\">&gt;</span><span class=\"identifier\">shutdown</span><span class=\"paren lparen\">(</span><span class=\"paren rparen\">)</span><span class=\"punctuation operator\">;</span><br/><span class=\"text\">  </span><span class=\"keyword\">return</span><span class=\"text\"> </span><span class=\"constant numeric\">0</span><span class=\"punctuation operator\">;</span><br/><span class=\"paren rparen\">}</span></pre>\n<h2>That&#8217;s All Folks!</h2>\n<p>We hope that you find this feature useful for your applications built on top of Zorba. Feel free to send us feedback and question on our <a href=\"https://groups.google.com/forum/?fromgroups#!forum/zorba-users\">mailing-list</a>. <br/>Happy Coding with Zorba!</p>\n</div>", "authors" : [  ], "tags" : [  ] }, { "title" : "The New Archive Module", "id" : "/60028626564/the-new-archive-module", "updated" : "Fri, 30 Nov 2012 00:00:00 -0500", "summary" : "We have heard your Feedback and developed a module to work with compressed archives (e.g. zip or tar.gz). The Archive module provides functions to create, read, and modify archives given as xs:base64Binary items. For example, it provides functions to retrieve the names or extract the values of several entries from a zip archive.", "content" : "<div class=\"entry-info\">\n<p>We have heard your <a href=\"https://zorba.uservoice.com/forums/145664-what-should-we-work-on-next-/suggestions/2634054-module-for-zip-please-please-please-\">Feedback</a> and developed a module to work with compressed archives (e.g. zip or tar.gz).</p>\n</div>\n<div class=\"entry-content\">\n<p><a href=\"http://www.zorba-xquery.com/html/modules/zorba/archive\">The Archive module</a> provides functions to create, read, and modify archives given as xs:base64Binary items. For example, it provides functions to retrieve the names or extract the values of several entries from a zip archive.</p>\n<p>In the following, we would like to show some basic examples to demonstrate how to use this module. Assume you have a digital book given in the ePub format (an ePub file is actually a collection of mostly XML and HTML files that are zipped together). To list information about all files/entries in such an archive, we use entries() as shown in the following example (you can try it live <a href=\"http://www.zorba-xquery.com/html/demo#e9h97MVQsmZc00XrK7ofI9qVgyU=\" target=\"_blank\">here</a>):</p>\n<pre class=\"ace-static\"><span class=\"keyword\">import</span><span class=\"text\"> </span><span class=\"keyword\">module</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">archive</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://www.zorba-xquery.com/modules/archive\"</span><span class=\"text\">;</span><br/><span class=\"keyword\">import</span><span class=\"text\"> </span><span class=\"keyword\">module</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">http</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://expath.org/ns/http-client\"</span><span class=\"text\">;</span><br/><br/><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$moby</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"support function\">http:send-request</span><span class=\"lparen\">(</span><span class=\"text\">&lt;</span><span class=\"meta tag\">http:request</span><span class=\"text\"> </span><span class=\"meta tag\">href</span><span class=\"text\">=</span><span class=\"string\">\"http://zorba.s3.amazonaws.com/MobyDick.epub\"</span><span class=\"text\"> </span><span class=\"meta tag\">method</span><span class=\"text\">=</span><span class=\"string\">\"get\"</span><span class=\"text\"> /&gt;</span><span class=\"rparen\">)</span><span class=\"lparen\">[</span><span class=\"constant\">2</span><span class=\"rparen\">]</span><br/><span class=\"keyword\">return</span><span class=\"text\"> </span><span class=\"support function\">archive:entries</span><span class=\"lparen\">(</span><span class=\"variable\">$moby</span><span class=\"rparen\">)</span></pre>\n<p>Similarly, we use extract-text() to extract the text content of a particular file in this archive. Here, we extract the first chapter of the book as text, parse it, and return all the paragraphs contained in this chapter (<a href=\"http://www.zorba-xquery.com/html/demo#i0gFmQJz/pQvaIUW87su0qHlWno=\" target=\"_blank\">try it live</a>):</p>\n<pre class=\"ace-static\"><span class=\"keyword\">import</span><span class=\"text\"> </span><span class=\"keyword\">module</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">archive</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://www.zorba-xquery.com/modules/archive\"</span><span class=\"text\">;</span><br/><span class=\"keyword\">import</span><span class=\"text\"> </span><span class=\"keyword\">module</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">http</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://expath.org/ns/http-client\"</span><span class=\"text\">;</span><br/><br/><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$moby</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"support function\">http:send-request</span><span class=\"lparen\">(</span><span class=\"text\">&lt;</span><span class=\"meta tag\">http:request</span><span class=\"text\"> </span><span class=\"meta tag\">href</span><span class=\"text\">=</span><span class=\"string\">\"http://zorba.s3.amazonaws.com/MobyDick.epub\"</span><span class=\"text\"> </span><span class=\"meta tag\">method</span><span class=\"text\">=</span><span class=\"string\">\"get\"</span><span class=\"text\"> /&gt;</span><span class=\"rparen\">)</span><span class=\"lparen\">[</span><span class=\"constant\">2</span><span class=\"rparen\">]</span><br/><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$chap1</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"support function\">archive:extract-text</span><span class=\"lparen\">(</span><span class=\"variable\">$moby</span><span class=\"text\">, </span><span class=\"string\">\"OPS/main1.xml\"</span><span class=\"rparen\">)</span><br/><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$doc</span><span class=\"text\">   :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"support function\">parse-xml</span><span class=\"lparen\">(</span><span class=\"variable\">$chap1</span><span class=\"rparen\">)</span><br/><span class=\"keyword\">return</span><span class=\"text\"> </span><span class=\"variable\">$doc</span><span class=\"text\">//</span><span class=\"keyword operator\">*</span><span class=\"text\">:</span><span class=\"identifier\">p</span></pre>\n<p>Finally, <a href=\"/html/modules/zorba/archive#create-2\">create()</a> allows you to create archives. In the following example, we use it to create a tar.gz archive containing a text file and the Zorba logo (<a href=\"http://www.zorba-xquery.com/html/demo#5Xgtf5mnC75VLtBU5Ct1IJXWHFA=\">try it live</a>):</p>\n<pre class=\"ace-static\"><span class=\"keyword\">import</span><span class=\"text\"> </span><span class=\"keyword\">module</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">archive</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://www.zorba-xquery.com/modules/archive\"</span><span class=\"text\">;</span><br/><span class=\"keyword\">import</span><span class=\"text\"> </span><span class=\"keyword\">module</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">http</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://expath.org/ns/http-client\"</span><span class=\"text\">;</span><br/><br/><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$logo</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"support function\">http:send-request</span><span class=\"lparen\">(</span><span class=\"text\">&lt;</span><span class=\"meta tag\">http:request</span><span class=\"text\"> </span><span class=\"meta tag\">href</span><span class=\"text\">=</span><span class=\"string\">\"http://www.zorba-xquery.com/images/zorba-logo-small.png\"</span><span class=\"text\"> </span><span class=\"meta tag\">method</span><span class=\"text\">=</span><span class=\"string\">\"get\"</span><span class=\"text\"> /&gt;</span><span class=\"rparen\">)</span><span class=\"lparen\">[</span><span class=\"constant\">2</span><span class=\"rparen\">]</span><br/><span class=\"keyword\">return</span><br/><span class=\"text\"> </span><span class=\"support function\">api:save-archive</span><span class=\"lparen\">(</span><br/><span class=\"text\">  </span><span class=\"support function\">archive:create</span><span class=\"lparen\">(</span><br/><span class=\"text\">    </span><span class=\"lparen\">(</span><br/><span class=\"text\">      </span><span class=\"string\">\"my-text-file.txt\"</span><span class=\"text\">,</span><br/><span class=\"text\">      </span><span class=\"string\">\"logo.png\"</span><br/><span class=\"text\">    </span><span class=\"rparen\">)</span><span class=\"text\">,</span><br/><span class=\"text\">    </span><span class=\"lparen\">(</span><br/><span class=\"text\">      </span><span class=\"string\">\"This is the content of the text file.\"</span><span class=\"text\">,</span><br/><span class=\"text\">      </span><span class=\"variable\">$logo</span><br/><span class=\"text\">    </span><span class=\"rparen\">)</span><span class=\"text\">,</span><br/><span class=\"text\">    &lt;</span><span class=\"meta tag\">archive:options</span><span class=\"text\">&gt;</span><br/><span class=\"text\">      &lt;</span><span class=\"meta tag\">archive:format</span><span class=\"text\">&gt;</span><span class=\"identifier\">TAR</span><span class=\"text\">&lt;/</span><span class=\"meta tag\">archive:format</span><span class=\"text\">&gt;</span><br/><span class=\"text\">      &lt;</span><span class=\"meta tag\">archive:compression</span><span class=\"text\">&gt;</span><span class=\"identifier\">GZIP</span><span class=\"text\">&lt;/</span><span class=\"meta tag\">archive:compression</span><span class=\"text\">&gt;</span><br/><span class=\"text\">    &lt;/</span><span class=\"meta tag\">archive:options</span><span class=\"text\">&gt;</span><br/><span class=\"text\">  </span><span class=\"rparen\">)</span><br/><span class=\"text\"> </span><span class=\"rparen\">)</span></pre>\n</div>", "authors" : [  ], "tags" : [  ] }, { "title" : "Zorba 2.7: Gaia", "id" : "/60028553817/zorba-27-gaia", "updated" : "Sat, 10 Nov 2012 00:00:00 -0500", "summary" : "The Zorba team is pleased to announce the release of Zorba 2.7, codename Gaia. The release is a substantial step forward in terms of new features, performance improvements, and bug fixes.", "content" : "<div class=\"entry-info\">\n<p>The Zorba team is pleased to announce the release of Zorba 2.7, codename Gaia. The release is a substantial step forward in terms of<a href=\"https://launchpadlibrarian.net/119067678/ChangeLog\">new features, performance improvements, and bug fixes</a>. It is available in our <a href=\"/html/download\">download section</a>.</p>\n</div>\n<div class=\"entry-content\">\n<h2>Features</h2>\n<h3>Simple Map Operator</h3>\n<p>One of the new expressions in XQuery 3.0 is the <a href=\"http://www.w3.org/TR/xquery-30/#id-map-operator\">Simple Map Operator</a>. It provides a very compact way to do simple mappings which may replace simple &#8220;for&#8221; expression and make them much shorter. For example:</p>\n<pre class=\"ace-static\"><span class=\"lparen\">(</span><span class=\"string\">\"Here is\"</span><span class=\"text\">, </span><span class=\"string\">\"Zorba\"</span><span class=\"text\">, </span><span class=\"string\">\"2.7\"</span><span class=\"rparen\">)</span><span class=\"text\"> ! </span><span class=\"support function\">upper-case</span><span class=\"lparen\">(</span><span class=\"text\">.</span><span class=\"rparen\">)</span></pre>\n<p>In this example, the context item <em>&#8221;.&#8221;</em> in the argument on the right-hand side of the <em>!</em> operator is bound to each item in the sequence resulting from evaluating the left-hand side. In contrast to the path operator (<em>/</em>), the simple map operator also allows non-node sequences as a result of the left-hand side argument.</p>\n<h3>Reading PDFs</h3>\n<p>Zorba 2.7 comes with a new module that provides functionality to read the text from PDF documents and allow you to render pages of a PDF documents to images. It&#8217;s based on the <a href=\"http://pdfbox.apache.org/\">Apache PDFBox</a> library. Here is an example of the module in action below:</p>\n<pre class=\"ace-static\"><span class=\"keyword\">import</span><span class=\"text\"> </span><span class=\"keyword\">module</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">read</span><span class=\"keyword operator\">-</span><span class=\"identifier\">pdf</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://www.zorba-xquery.com/modules/read-pdf\"</span><span class=\"text\">;</span><br/><span class=\"keyword\">declare</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">rpo</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://www.zorba-xquery.com/modules/read-pdf/read-pdf-options\"</span><span class=\"text\">;</span><br/><br/><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$pdf</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"support function\">fetch:content-binary</span><span class=\"lparen\">(</span><span class=\"string\">\"some.pdf\"</span><span class=\"rparen\">)</span><br/><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$options</span><span class=\"text\">  :</span><span class=\"keyword operator\">=</span><br/><span class=\"text\">   &lt;</span><span class=\"meta tag\">rpo:extract-text-options</span><span class=\"text\"> </span><span class=\"meta tag\">xmlns:rpo</span><span class=\"text\">=</span><span class=\"string\">\"http://www.zorba-xquery.com/modules/read-pdf/read-pdf-options\"</span><span class=\"text\">&gt;</span><br/><span class=\"text\">     &lt;</span><span class=\"meta tag\">rpo:text-kind</span><span class=\"text\">&gt;</span><span class=\"identifier\">simple</span><span class=\"text\">&lt;/</span><span class=\"meta tag\">rpo:text-kind</span><span class=\"text\">&gt;</span><br/><span class=\"text\">     &lt;</span><span class=\"meta tag\">rpo:start-page</span><span class=\"text\">&gt;</span><span class=\"constant\">2</span><span class=\"text\">&lt;/</span><span class=\"meta tag\">rpo:start-page</span><span class=\"text\">&gt;</span><br/><span class=\"text\">     &lt;</span><span class=\"meta tag\">rpo:end-page</span><span class=\"text\">&gt;</span><span class=\"constant\">3</span><span class=\"text\">&lt;/</span><span class=\"meta tag\">rpo:end-page</span><span class=\"text\">&gt;</span><br/><span class=\"text\">     &lt;</span><span class=\"meta tag\">rpo:start-page-separator</span><span class=\"text\">&gt;</span><span class=\"keyword operator\">-</span><span class=\"keyword operator\">-</span><span class=\"keyword operator\">-</span><span class=\"keyword\">start</span><span class=\"keyword operator\">-</span><span class=\"identifier\">page</span><span class=\"keyword operator\">-</span><span class=\"identifier\">separator</span><span class=\"keyword operator\">-</span><span class=\"keyword operator\">-</span><span class=\"keyword operator\">-</span><span class=\"text\">&lt;/</span><span class=\"meta tag\">rpo:start-page-separator</span><span class=\"text\">&gt;</span><br/><span class=\"text\">     &lt;</span><span class=\"meta tag\">rpo:end-page-separator</span><span class=\"text\">&gt;</span><span class=\"keyword operator\">-</span><span class=\"keyword operator\">-</span><span class=\"keyword operator\">-</span><span class=\"keyword\">end</span><span class=\"keyword operator\">-</span><span class=\"identifier\">page</span><span class=\"keyword operator\">-</span><span class=\"identifier\">separator</span><span class=\"keyword operator\">-</span><span class=\"keyword operator\">-</span><span class=\"keyword operator\">-</span><span class=\"text\">&lt;/</span><span class=\"meta tag\">rpo:end-page-separator</span><span class=\"text\">&gt;</span><br/><span class=\"text\">   &lt;/</span><span class=\"meta tag\">rpo:extract-text-options</span><span class=\"text\">&gt;</span><br/><span class=\"keyword\">return</span><br/><span class=\"support function\">read-pdf:extract-text</span><span class=\"lparen\">(</span><span class=\"variable\">$pdf</span><span class=\"text\">, </span><span class=\"variable\">$options</span><span class=\"rparen\">)</span></pre>\n<p>The code snippet above loads the content of the <em>some.pdf</em> file and extracts the text contained in page two and three.</p>\n<h3>JSONiq Improvements</h3>\n<p>In Zorba 2.6.0, parsing JSON text and serializing results to JSON was kind of a hassle. In this release, we have improved this functionality and made it much easier to use. For example, you can now parse sequences of JSON documents or serialize JSON objects that contain dateTime-typed values. For example:</p>\n<pre class=\"ace-static\"><span class=\"lparen\">{</span><br/><span class=\"text\">  </span><span class=\"string\">\"now\"</span><span class=\"text\"> : </span><span class=\"support function\">fn:current-dateTime</span><span class=\"lparen\">(</span><span class=\"rparen\">)</span><br/><span class=\"rparen\">}</span></pre>\n<p>In this example (<a href=\"http://www.zorba-xquery.com/html/demo#mc31W6cwj9//xY+xCuab4FUx7OA=\">try it live</a>), the current dateTime is cast to a string. In case you want to keep the types of such values but they are not natively supported by JSON, you can use the function jn:encode-for-roundtrip to get a fully round-trippable version of the JSON object that you can serialize. to read the object back, the jn:decode-from-roundtrip function ensures that all of the values still have the same type that they had before encoding. See example below and try it live <a href=\"http://www.zorba-xquery.com/html/demo#8rwUeZSZv0dlINB+BRDwDMLJi+0=\">here</a>.</p>\n<pre class=\"ace-static\"><span class=\"support function\">jn:encode-for-roundtrip</span><span class=\"lparen\">(</span><br/><span class=\"text\">  </span><span class=\"lparen\">{</span><br/><span class=\"text\">    </span><span class=\"string\">\"now\"</span><span class=\"text\"> : </span><span class=\"support function\">fn:current-dateTime</span><span class=\"lparen\">(</span><span class=\"rparen\">)</span><br/><span class=\"text\">  </span><span class=\"rparen\">}</span><br/><span class=\"rparen\">)</span></pre>\n<p>Two other little changes in the JSONiq language are the automatic conversion of empty sequences to null. For instance:</p>\n<pre class=\"ace-static\"><span class=\"lparen\">{</span><span class=\"text\"> </span><span class=\"string\">\"null\"</span><span class=\"text\"> : </span><span class=\"lparen\">(</span><span class=\"rparen\">)</span><span class=\"text\"> </span><span class=\"rparen\">}</span></pre>\n<p>will be serialized to:</p>\n<pre class=\"ace-static\"><span class=\"lparen\">{</span><span class=\"text\"> </span><span class=\"string\">\"null\"</span><span class=\"text\"> : </span><span class=\"identifier\">null</span><span class=\"text\"> </span><span class=\"rparen\">}</span></pre>\n<p>And the automatic casting of key names to string.</p>\n<pre class=\"ace-static\"><span class=\"lparen\">{</span><span class=\"text\"> </span><span class=\"constant\">1</span><span class=\"text\"> : </span><span class=\"string\">\"foo\"</span><span class=\"text\"> </span><span class=\"rparen\">}</span></pre>\n<p>will be serialized to:</p>\n<pre class=\"ace-static\"><span class=\"lparen\">{</span><span class=\"text\"> </span><span class=\"string\">\"1\"</span><span class=\"text\"> : </span><span class=\"string\">\"foo\"</span><span class=\"text\"> </span><span class=\"rparen\">}</span></pre>\n<h2>Performance Improvements</h2>\n<p>The release also contains quite some under-the-hood changes. Specifically, the memory management in the compiler was refactored to accommodate for the fact that compiler expressions are not very big and their life-time is naturally limited. This allows for a much more efficient memory management.</p>\n<p>Beyond that, the optimizer has been improved to deal with positional predicates that involve inequality comparisons. Knowing about this, the runtime can avoid unnecessary work because of its lazy evaluation strategy.</p>\n<h2>Bug Fixes</h2>\n<p>Despite all the work we did for those new features and performance improvements, we also spent quite some time to fix bugs. Zorba 2.7 comes with approx. 30 bug fixes. The most asked for was the correct serialization of XHTML elements with empty content. Particularly, only tags such as br or img should legally use the empty element shorthand whereas all other must be written as &lt;elem&gt;&lt;/elem&gt;.</p>\n<p>We hope you like the release and are looking forward to <a href=\"https://groups.google.com/forum/?fromgroups#!search/zorba-users\">your feedback</a>.</p>\n</div>", "authors" : [  ], "tags" : [  ] }, { "title" : "xqDoc Support in Zorba", "id" : "/60028475838/xqdoc-support-in-zorba", "updated" : "Wed, 26 Sep 2012 00:00:00 -0400", "summary" : "xqDoc is the de facto industry standard for generating API documentation from XQuery modules.", "content" : "<div class=\"entry-content\">\n<p><em>Note: this is an edited version of a previous tutorial we updated to run with Zorba 2.0.</em></p>\n<p><a href=\"http://xqdoc.org/\">xqDoc</a> is the de facto industry standard for generating API documentation from XQuery modules. xqDoc style comments begin with a &#8216;(:~&#8217; and end with a &#8216;:)&#8217; (see code snippet below).</p>\n<pre class=\"ace-static\"><span class=\"comment\">(:</span><span class=\"comment\">~</span><br/><span class=\"comment\"> : This library module provides simple file system I/O operations.</span><br/><span class=\"comment\"> :</span><br/><span class=\"comment\"> : @author Gabriel Petrovay</span><br/><span class=\"comment\"> : @version 1.0 </span><br/><span class=\"comment\"> :)</span><br/><span class=\"keyword\">module</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">file</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://www.zorba-xquery.com/modules/file\"</span><span class=\"text\">;</span></pre>\n<p>More information about the xqDoc specification is available on the <a href=\"http://xqdoc.org/\">xqDoc website</a>.</p>\n<h2>Overview</h2>\n<p>Zorba 1.4 provides built-in xqDoc support which doesn&#8217;t require any installation or configuration. In general, creating documentation from an XQuery module that is documented with xqDoc is a two step process:</p>\n<ul><li>Given a module as input, one creates a valid xqDoc document.</li>\n<li>This xqDoc document can be converted to formats such as XHTML or DocBook.</li>\n</ul><p>In Zorba, the first step is accomplished by using the built-in xqDoc module. This module provides functions whose result given a documented module is a valid xqDoc document.</p>\n<p>In a first step, the filename lib.xq of the documented module is passed as an argument to the <a href=\"http://www.zorba-xquery.com/html/modules/zorba/xqdoc/xqdoc#xqdoc-1\">xqdoc() function of Zorba&#8217;s xqDoc module</a>. This function returns a valid xqDoc document containing information about the module. In a second step, this document is transformed (using XQuery) into a nicely presented HTML document. In the following sections, we describe each of those steps in more detail.</p>\n<h2>Generating an xqDoc Document</h2>\n<p>The module that can be used to generate xqDoc documents is available using the target namespace <a href=\"http://www.zorba-xquery.com/modules/xqdoc.\">http://www.zorba-xquery.com/modules/xqdoc.</a> This module contains two functions both returning xqDoc documents given a (documented) XQuery module as input: <a href=\"http://www.zorba-xquery.com/html/modules/zorba/xqdoc/xqdoc#xqdoc-1\">xqdoc:xqdoc()</a> and <a href=\"http://www.zorba-xquery.com/html/modules/zorba/xqdoc/xqdoc#xqdoc-content-1\">xqdoc:xqdoc-content()</a>. The former function takes the URI of the documented module as a string. The argument of the latter function is the XQuery module itself.</p>\n<p>For instance, the following XQuery program generates the xqDoc document for the xqDoc module itself.</p>\n<pre class=\"ace-static\"><span class=\"keyword\">import</span><span class=\"text\"> </span><span class=\"keyword\">module</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">xqdoc</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://www.zorba-xquery.com/modules/xqdoc\"</span><span class=\"text\">;</span><br/><br/><span class=\"support function\">xqdoc:xqdoc</span><span class=\"lparen\">(</span><span class=\"string\">\"http://www.zorba-xquery.com/modules/xqdoc\"</span><span class=\"rparen\">)</span></pre>\n<p>You can try this example <a href=\"http://www.zorba-xquery.com/html/demo#qQ55Kvv8jemz3Ihv6Qo7H0B0DM8=\">live</a>.</p>\n<p>An excerpt of the result looks as follows:</p>\n<pre class=\"ace-static\"><span class=\"xml_pe\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span><br/><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">xqdoc:xqdoc</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">xmlns:xqdoc</span><span class=\"keyword operator\">=</span><span class=\"string\">\"http://www.xqdoc.org/1.0\"</span><span class=\"meta tag\">&gt;</span><br/><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">xqdoc:control</span><span class=\"meta tag\">&gt;</span><br/><span class=\"text\">  </span><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">xqdoc:date</span><span class=\"meta tag\">&gt;</span><span class=\"text\">2012-09-23T15:52:10.06Z</span><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">xqdoc:date</span><span class=\"meta tag\">&gt;</span><br/><span class=\"text\">  </span><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">xqdoc:version</span><span class=\"meta tag\">&gt;</span><span class=\"text\">1.0</span><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">xqdoc:version</span><span class=\"meta tag\">&gt;</span><br/><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">xqdoc:control</span><span class=\"meta tag\">&gt;</span><br/><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">xqdoc:module</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">type</span><span class=\"keyword operator\">=</span><span class=\"string\">\"library\"</span><span class=\"meta tag\">&gt;</span><br/><span class=\"text\">  </span><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">xqdoc:uri</span><span class=\"meta tag\">&gt;</span><span class=\"text\"><a href=\"http://www.zorba-xquery.com/modules/xqdoc\">http://www.zorba-xquery.com/modules/xqdoc</a></span><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">xqdoc:uri</span><span class=\"meta tag\">&gt;</span><br/><span class=\"text\">  </span><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">xqdoc:name</span><span class=\"meta tag\">&gt;</span><span class=\"text\">xqdoc</span><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">xqdoc:name</span><span class=\"meta tag\">&gt;</span><br/><span class=\"text\">  </span><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">xqdoc:comment</span><span class=\"meta tag\">&gt;</span><br/><span class=\"text\">    </span><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">xqdoc:description</span><span class=\"meta tag\">&gt;</span><span class=\"text\"> </span><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">p</span><span class=\"meta tag\">&gt;</span><br/><span class=\"text\"> The goal of xqDoc is to provide a simple vendor neutral solution for...</span></pre>\n<p>Alternatively, if you want to generate xqDoc document out of the string representation of a module (maybe because it&#8217;s not available as a file or built-in module), you can pass the contents of the module as a parameter to the xqdoc:xqdoc-content() function. For example, the following XQuery program retrieves the functx module using http and returns the documentation.</p>\n<pre class=\"ace-static\"><span class=\"keyword\">import</span><span class=\"text\"> </span><span class=\"keyword\">module</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">http</span><span class=\"text\">  </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://expath.org/ns/http-client\"</span><span class=\"text\">;</span><br/><span class=\"keyword\">import</span><span class=\"text\"> </span><span class=\"keyword\">module</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">xqdoc</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://www.zorba-xquery.com/modules/xqdoc\"</span><span class=\"text\">;</span><br/><br/><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$module-uri</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://www.xqueryfunctions.com/xq/functx-1.0-doc-2007-01.xq\"</span><br/><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$module</span><span class=\"text\">     :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"support function\">http:send-request</span><span class=\"lparen\">(</span><span class=\"text\">&lt;</span><span class=\"meta tag\">http:request</span><span class=\"text\"> </span><span class=\"meta tag\">href</span><span class=\"text\">=</span><span class=\"string\">\"{$module-uri}\"</span><span class=\"text\"> </span><span class=\"meta tag\">method</span><span class=\"text\">=</span><span class=\"string\">\"get\"</span><span class=\"text\"> /&gt;</span><span class=\"rparen\">)</span><span class=\"lparen\">[</span><span class=\"constant\">2</span><span class=\"rparen\">]</span><br/><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$xqdoc</span><span class=\"text\">      :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"support function\">xqdoc:xqdoc-content</span><span class=\"lparen\">(</span><span class=\"variable\">$module</span><span class=\"rparen\">)</span><br/><span class=\"keyword\">return</span><span class=\"text\"> </span><span class=\"variable\">$xqdoc</span></pre>\n<p>You can try this example <a href=\"http://www.zorba-xquery.com/html/demo#kthxQuj9GJjOiyk70hltWSCVeXE=\">live</a>.</p>\n<h2>Transforming xqDoc Documents</h2>\n<p>Given a valid xqDoc document, it can be easily translated into a variety of formats such as XHTML or DocBook. Zorba provides an XQuery module that can be used to transform xqDoc documents into XHTML. The following XQuery program demonstrates how easy it is to generate nice XHTML documentation using the xqDoc module and a simple stylesheet (written in XQuery) that converts xqDoc XML to XHTML:</p>\n<pre class=\"ace-static\"><span class=\"keyword\">import</span><span class=\"text\"> </span><span class=\"keyword\">module</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">xqdoc</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://www.zorba-xquery.com/modules/xqdoc\"</span><span class=\"text\">;</span><br/><span class=\"keyword\">import</span><span class=\"text\"> </span><span class=\"keyword\">module</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">html</span><span class=\"keyword operator\">-</span><span class=\"identifier\">stylesheet</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://www.zorba-xquery.com/modules/xqdoc/html\"</span><br/><span class=\"text\">                                                   </span><span class=\"keyword\">at</span><span class=\"text\"> </span><span class=\"string\">\"http://zorba.s3.amazonaws.com/html.xq\"</span><span class=\"text\">;</span><br/><br/><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$xqdoc</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"support function\">xqdoc:xqdoc</span><span class=\"lparen\">(</span><span class=\"string\">\"http://www.zorba-xquery.com/modules/xqdoc\"</span><span class=\"rparen\">)</span><br/><span class=\"keyword\">return</span><span class=\"text\"> </span><span class=\"support function\">html-stylesheet:convert</span><span class=\"lparen\">(</span><span class=\"variable\">$xqdoc</span><span class=\"rparen\">)</span></pre>\n<p>You can try this example <a href=\"http://www.zorba-xquery.com/html/demo#RWrsjfYzm3oHc0vP6hxdH/DFKwE=\">live</a>.</p>\n<h2>Examples, Extensions, &amp; Contact</h2>\n<p>More examples showing documentation generated by the Zorba xqDoc modules are available at</p>\n<ul><li><a href=\"/html/modules\">Zorba&#8217;s module documentation page</a></li>\n<li><a href=\"http://www.28msec.com/html/doc\">28msec&#8217;s module documentation page</a></li>\n</ul>\n<p>Zorba is extending the original xqDoc specification to make the information available in xqDoc documents even more useful. Specifically, the xqDoc documents generated by Zorba add an additional attribute named arity to the xqdoc:name element of a function. This allows to disambiguate references to functions having the same name but a different arity.</p>\n<p>If you have questions or comments regarding Zorba or its xqDoc support, feel free to write an email to the <a href=\"https://groups.google.com/forum/?fromgroups#!forum/zorba-users\">zorba-users mailing list</a>.</p>\n</div>", "authors" : [  ], "tags" : [  ] }, { "title" : "Atom Processing", "id" : "/60028351254/atom-processing", "updated" : "Mon, 24 Sep 2012 00:00:00 -0400", "summary" : "The Atom Syndication Format (RFC 4287) is one of the most popular XML formats to aggregate XML data. Such an aggregate is called an Atom feed.", "content" : "<div class=\"entry-content\">\n<div>\n<p><em>Note: this is an edited version of a previous tutorial we updated to run with Zorba 2.0.</em></p>\n<p>The <a href=\"http://www.ietf.org/rfc/rfc4287.txt\">Atom Syndication Format (RFC 4287)</a> is one of the most popular XML formats to aggregate XML data. Such an aggregate is called an Atom feed. Atom is heavily used by the industry for web services (e.g. Google) and countless people use it to subscribe to their favourite blogs in their Feed Readers. The aim of this tutorial is to present how easy an Atom feed can be processed with XQuery.</p>\n<p>We will download the <a href=\"http://www.zorba-xquery.com/html/blog\">Zorba blog</a> in Atom format, create a Tiny URL to the blog post, extract some keywords and output the result as HTML.</p>\n<p>Let&#8217;s start with two helper functions that we&#8217;ll use afterwards. One to create a Tiny URL, the other to get frequent keywords out of a longer string (such as a Atom blog entry).</p>\n<h2>Create the Tiny URL</h2>\n<p>Creating a Tiny URL is simple. It can be done by sending an HTTP GET request to <a href=\"http://tinyurl.com/api-create.php\"><a href=\"http://tinyurl.com/api-create.php\">http://tinyurl.com/api-create.php</a></a> with the URL to shorten as a parameter named &#8220;url&#8221;.</p>\n<p>We write a simple function that uses the <a href=\"http://www.zorba-xquery.com/html/modules/expath/http-client\">EXPath http-client module</a>. The result of a HTTP GET using that module is a sequence of two items: the first is the response header, the second the body. We&#8217;re only interested in the response body which will contain the shortened URL.</p>\n<pre class=\"ace-static\"><span class=\"keyword\">import</span><span class=\"text\"> </span><span class=\"keyword\">module</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">http</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://expath.org/ns/http-client\"</span><span class=\"text\">;</span><br/><span class=\"keyword\">declare</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">an</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://www.zorba-xquery.com/annotations\"</span><span class=\"text\">;</span><br/><br/><span class=\"keyword\">declare</span><span class=\"text\"> %</span><span class=\"identifier\">an</span><span class=\"text\">:</span><span class=\"identifier\">sequential</span><span class=\"text\"> </span><span class=\"keyword\">function</span><span class=\"text\"> </span><span class=\"support function\">local:create-tinyurl</span><span class=\"lparen\">(</span><span class=\"variable\">$url</span><span class=\"text\"> </span><span class=\"keyword\">as</span><span class=\"text\"> </span><span class=\"identifier\">xs</span><span class=\"text\">:</span><span class=\"identifier\">string</span><span class=\"rparen\">)</span><span class=\"text\"> </span><span class=\"keyword\">as</span><span class=\"text\"> </span><span class=\"identifier\">xs</span><span class=\"text\">:</span><span class=\"identifier\">string</span><br/><span class=\"lparen\">{</span><br/><span class=\"text\">  </span><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$url-encoded</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"support function\">encode-for-uri</span><span class=\"lparen\">(</span><span class=\"variable\">$url</span><span class=\"rparen\">)</span><br/><span class=\"text\">  </span><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$result</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"support function\">http:send-request</span><span class=\"lparen\">(</span><br/><span class=\"text\">      &lt;</span><span class=\"meta tag\">http:request</span><span class=\"text\"> </span><span class=\"meta tag\">href</span><span class=\"text\">=</span><span class=\"string\">\"http://tinyurl.com/api-create.php?url={$url-encoded}\"</span><br/><span class=\"text\">                    </span><span class=\"meta tag\">method</span><span class=\"text\">=</span><span class=\"string\">\"get\"</span><span class=\"text\"> /&gt;</span><br/><span class=\"text\">  </span><span class=\"rparen\">)</span><br/><span class=\"text\">  </span><span class=\"keyword\">return</span><span class=\"text\"> </span><span class=\"variable\">$result</span><span class=\"lparen\">[</span><span class=\"constant\">2</span><span class=\"rparen\">]</span><br/><span class=\"rparen\">}</span><span class=\"text\">;</span><br/><br/><span class=\"support function\">local:create-tinyurl</span><span class=\"lparen\">(</span><span class=\"string\">\"http://www.zorba-xquery.com/\"</span><span class=\"rparen\">)</span></pre>\n<p>You can run this code snippet in <a href=\"http://www.zorba-xquery.com/html/demo#z/I=\">the Zorba live sandbox</a> our with your local zorba installation. You should get the following result:</p>\n<pre class=\"ace-static\"><span class=\"xml_pe\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span><br/><span class=\"text\"><a href=\"http://tinyurl.com/yc76gyh\">http://tinyurl.com/yc76gyh</a></span></pre>\n<h2>Generating Keywords</h2>\n<p>Now let&#8217;s write a function which finds the most frequent words in a string while discarding common stop words such as &#8220;or&#8221;, &#8220;and&#8221;, or &#8220;not&#8221;. For this, we use Zorba&#8217;s <a href=\"http://www.zorba-xquery.com/html/modules/zorba/fulltext\">full-text module</a>.</p>\n<p>First, we tokenize the string into a sequence of words. Then, for each word we convert it to lower-case and discard the stop words. Finally we group all occurrences of the same word together and count how many times the word appeared in the string and order by that count.</p>\n<pre class=\"ace-static\"><span class=\"keyword\">import</span><span class=\"text\"> </span><span class=\"keyword\">module</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">ft</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://www.zorba-xquery.com/modules/full-text\"</span><span class=\"text\">;</span><br/><br/><span class=\"keyword\">declare</span><span class=\"text\"> </span><span class=\"keyword\">function</span><span class=\"text\"> </span><span class=\"support function\">local:words-by-frequency</span><span class=\"lparen\">(</span><span class=\"variable\">$content</span><span class=\"rparen\">)</span><br/><span class=\"lparen\">{</span><span class=\"text\">   </span><br/><span class=\"text\">    </span><span class=\"keyword\">for</span><span class=\"text\"> </span><span class=\"variable\">$token</span><span class=\"text\"> </span><span class=\"keyword\">in</span><span class=\"text\"> </span><span class=\"support function\">ft:tokenize-string</span><span class=\"lparen\">(</span><span class=\"variable\">$content</span><span class=\"text\">, </span><span class=\"support function\">xs:language</span><span class=\"lparen\">(</span><span class=\"string\">\"en\"</span><span class=\"rparen\">)</span><span class=\"rparen\">)</span><br/><span class=\"text\">    </span><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$word</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"support function\">lower-case</span><span class=\"lparen\">(</span><span class=\"variable\">$token</span><span class=\"rparen\">)</span><br/><span class=\"text\">    </span><span class=\"keyword\">where</span><span class=\"text\"> </span><span class=\"support function\">not</span><span class=\"lparen\">(</span><span class=\"support function\">ft:is-stop-word</span><span class=\"lparen\">(</span><span class=\"variable\">$word</span><span class=\"rparen\">)</span><span class=\"rparen\">)</span><br/><span class=\"text\">    </span><span class=\"keyword\">group</span><span class=\"text\"> </span><span class=\"keyword\">by</span><span class=\"text\"> </span><span class=\"variable\">$word</span><br/><span class=\"text\">    </span><span class=\"keyword\">order</span><span class=\"text\"> </span><span class=\"keyword\">by</span><span class=\"text\"> </span><span class=\"support function\">count</span><span class=\"lparen\">(</span><span class=\"variable\">$token</span><span class=\"rparen\">)</span><span class=\"text\"> </span><span class=\"keyword\">descending</span><br/><span class=\"text\">    </span><span class=\"keyword\">return</span><span class=\"text\"> &lt;</span><span class=\"meta tag\">li</span><span class=\"text\">&gt;</span><span class=\"lparen\">{</span><span class=\"text\"> </span><span class=\"variable\">$word</span><span class=\"text\"> </span><span class=\"rparen\">}</span><span class=\"text\">&lt;/</span><span class=\"meta tag\">li</span><span class=\"text\">&gt;</span><br/><span class=\"rparen\">}</span><span class=\"text\">;</span><br/><br/><span class=\"support function\">local:words-by-frequency</span><span class=\"lparen\">(</span><span class=\"string\">\"Processing text with Zorba is easy when using the full-text module.\"</span><span class=\"rparen\">)</span></pre>\n<p>The result is a sequence of words (each wrapped in an HTML li tag), with the most frequent words at the beginning. Have a look at the result on <a href=\"http://www.zorba-xquery.com/html/demo#qeY60mbZf/k3Ub9R4EOaWNTyfYg=\">live sandbox</a></p>\n<pre class=\"ace-static\"><span class=\"xml_pe\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span><br/><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">li</span><span class=\"meta tag\">&gt;</span><span class=\"text\">text</span><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">li</span><span class=\"meta tag\">&gt;</span><br/><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">li</span><span class=\"meta tag\">&gt;</span><span class=\"text\">zorba</span><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">li</span><span class=\"meta tag\">&gt;</span><br/><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">li</span><span class=\"meta tag\">&gt;</span><span class=\"text\">easy</span><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">li</span><span class=\"meta tag\">&gt;</span><br/><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">li</span><span class=\"meta tag\">&gt;</span><span class=\"text\">processing</span><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">li</span><span class=\"meta tag\">&gt;</span><br/><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">li</span><span class=\"meta tag\">&gt;</span><span class=\"text\">module</span><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">li</span><span class=\"meta tag\">&gt;</span><br/><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">li</span><span class=\"meta tag\">&gt;</span><span class=\"text\">using</span><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">li</span><span class=\"meta tag\">&gt;</span><br/><br/></pre>\n<h2>Processing the Atom feed</h2>\n<p>Now that we have our two helper functions, let&#8217;s finish the job.</p>\n<p>In the same way we made an HTTP GET request to <a href=\"http://tinyurl.com/\">tinyurl.com</a>, we can make one to get the Zorba blog in Atom format.</p>\n<pre class=\"ace-static\"><span class=\"keyword\">import</span><span class=\"text\"> </span><span class=\"keyword\">module</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">http</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://expath.org/ns/http-client\"</span><span class=\"text\">;</span><br/><br/><span class=\"support function\">http:send-request</span><span class=\"lparen\">(</span><br/><span class=\"text\">  &lt;</span><span class=\"meta tag\">http:request</span><span class=\"text\"> </span><span class=\"meta tag\">href</span><span class=\"text\">=</span><span class=\"string\">\"http://www.zorba-xquery.com/blog/feed\"</span><span class=\"text\">  </span><span class=\"meta tag\">method</span><span class=\"text\">=</span><span class=\"string\">\"get\"</span><span class=\"text\"> /&gt;</span><br/><span class=\"rparen\">)</span><span class=\"lparen\">[</span><span class=\"constant\">2</span><span class=\"rparen\">]</span></pre>\n<p>One entry in the Atom feed might look like this.</p>\n<pre class=\"ace-static\"><span class=\"xml_pe\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span><br/><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">feed</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">xmlns</span><span class=\"keyword operator\">=</span><span class=\"string\">\"http://www.w3.org/2005/Atom\"</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">xml:base</span><span class=\"keyword operator\">=</span><span class=\"string\">\"http://www.28msec.com\"</span><span class=\"meta tag\">&gt;</span><br/><span class=\"text\">[...]</span><br/><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">entry</span><span class=\"meta tag\">&gt;</span><br/><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">title</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">type</span><span class=\"keyword operator\">=</span><span class=\"string\">\"text\"</span><span class=\"meta tag\">&gt;</span><span class=\"text\">Zorba \"Eros\" 2.6: The JSONiq Release</span><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">title</span><span class=\"meta tag\">&gt;</span><br/><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">link</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">rel</span><span class=\"keyword operator\">=</span><span class=\"string\">\"alternate\"</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">type</span><span class=\"keyword operator\">=</span><span class=\"string\">\"text/html\"</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">href</span><span class=\"keyword operator\">=</span><span class=\"string\">\"http://www.zorba-xquery.com/html/entry/2012/08/20/Eros\"</span><span class=\"meta tag\">/&gt;</span><br/><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">author</span><span class=\"meta tag\">&gt;</span><br/><span class=\"text\"> </span><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">name</span><span class=\"meta tag\">&gt;</span><span class=\"text\">Zorba Team</span><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">name</span><span class=\"meta tag\">&gt;</span><br/><span class=\"text\"> </span><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">email</span><span class=\"meta tag\">&gt;</span><span class=\"text\">zorba-dev@googlegroups.com</span><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">email</span><span class=\"meta tag\">&gt;</span><br/><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">author</span><span class=\"meta tag\">&gt;</span><br/><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">updated</span><span class=\"meta tag\">&gt;</span><span class=\"text\">2012-08-20T07:47:04.74+02:00</span><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">updated</span><span class=\"meta tag\">&gt;</span><br/><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">content</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">type</span><span class=\"keyword operator\">=</span><span class=\"string\">\"xhtml\"</span><span class=\"meta tag\">&gt;</span><br/><span class=\"text\"> </span><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">div</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">xmlns</span><span class=\"keyword operator\">=</span><span class=\"string\">\"http://www.w3.org/1999/xhtml\"</span><span class=\"meta tag\">&gt;</span><br/><span class=\"text\"> </span><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">p</span><span class=\"meta tag\">&gt;</span><br/><span class=\"text\"> The Zorba development team is pleased to announce the release of Zorba 2.6, codename Eros.</span><br/><span class=\"text\"> The release is available in our </span><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">a</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">href</span><span class=\"keyword operator\">=</span><span class=\"string\">\"/html/download\"</span><span class=\"meta tag\">&gt;</span><span class=\"text\">download section</span><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">a</span><span class=\"meta tag\">&gt;</span><span class=\"text\">.</span><br/><span class=\"text\">[...]</span><br/><span class=\"text\"> </span><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">p</span><span class=\"meta tag\">&gt;</span><br/><span class=\"text\"> </span><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">div</span><span class=\"meta tag\">&gt;</span><br/><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">content</span><span class=\"meta tag\">&gt;</span><br/><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">entry</span><span class=\"meta tag\">&gt;</span><br/><span class=\"text\">[...]</span><br/><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">feed</span><span class=\"meta tag\">&gt;</span><br/><br/></pre>\n<p>Have you noticed the <em>xmlns=&#8221;http://www.w3.org/2005/Atom&#8221;</em> above? That means that the &#8220;feed&#8221; node, and all its children, are in the &#8220;atom&#8221; XML namespace. That&#8217;s why we have to write <em>$feed//atom:entry</em> to get all the entries. We could also have used<em>$feed//*:entry</em>, but <em>$feed//entry</em> would not have worked. Limiting to &#8220;less or equal 3&#8221; with <em>$feed//atom:entry[position() le 3]</em>, will give us a sequence containing the first three entries in the blog.</p>\n<p>For each blog entry, we get its title and its URL&#8230;</p>\n<pre class=\"ace-static\"><span class=\"keyword\">declare</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">atom</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://www.w3.org/2005/Atom\"</span><span class=\"text\">;</span><br/><br/><span class=\"keyword\">for</span><span class=\"text\"> </span><span class=\"variable\">$entry</span><span class=\"text\"> </span><span class=\"keyword\">in</span><span class=\"text\"> </span><span class=\"variable\">$feed</span><span class=\"text\">//</span><span class=\"identifier\">atom</span><span class=\"text\">:</span><span class=\"identifier\">entry</span><span class=\"lparen\">[</span><span class=\"support function\">position</span><span class=\"lparen\">(</span><span class=\"rparen\">)</span><span class=\"text\"> </span><span class=\"keyword\">le</span><span class=\"text\"> </span><span class=\"constant\">3</span><span class=\"rparen\">]</span><br/><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$title</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"variable\">$entry</span><span class=\"text\">/</span><span class=\"identifier\">atom</span><span class=\"text\">:</span><span class=\"identifier\">title</span><span class=\"text\">/</span><span class=\"support function\">text</span><span class=\"lparen\">(</span><span class=\"rparen\">)</span><br/><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$url</span><span class=\"text\">   :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"support function\">encode-for-uri</span><span class=\"lparen\">(</span><span class=\"text\"> </span><span class=\"variable\">$entry</span><span class=\"text\">/</span><span class=\"identifier\">atom</span><span class=\"text\">:</span><span class=\"identifier\">link</span><span class=\"lparen\">[</span><span class=\"text\">@</span><span class=\"identifier\">rel</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"alternate\"</span><span class=\"rparen\">]</span><span class=\"text\">/@</span><span class=\"identifier\">href</span><span class=\"text\">/</span><span class=\"support function\">data</span><span class=\"lparen\">(</span><span class=\"rparen\">)</span><span class=\"text\"> </span><span class=\"rparen\">)</span></pre>\n<p>&#8230;and when we invoke our previously written helper functions (local:create-tinyurl and local:words-by-frequency), and construct the XHTML to return, we get the finished script:</p>\n<pre class=\"ace-static\"><span class=\"keyword\">import</span><span class=\"text\"> </span><span class=\"keyword\">module</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">http</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://expath.org/ns/http-client\"</span><span class=\"text\">;</span><br/><span class=\"keyword\">import</span><span class=\"text\"> </span><span class=\"keyword\">module</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">ft</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://www.zorba-xquery.com/modules/full-text\"</span><span class=\"text\">;</span><br/><br/><span class=\"keyword\">declare</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">atom</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://www.w3.org/2005/Atom\"</span><span class=\"text\">;</span><br/><span class=\"keyword\">declare</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">an</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://www.zorba-xquery.com/annotations\"</span><span class=\"text\">;</span><br/><br/><span class=\"keyword\">declare</span><span class=\"text\"> %</span><span class=\"identifier\">an</span><span class=\"text\">:</span><span class=\"identifier\">sequential</span><span class=\"text\"> </span><span class=\"keyword\">function</span><span class=\"text\"> </span><span class=\"support function\">local:create-tinyurl</span><span class=\"lparen\">(</span><span class=\"variable\">$url</span><span class=\"text\"> </span><span class=\"keyword\">as</span><span class=\"text\"> </span><span class=\"identifier\">xs</span><span class=\"text\">:</span><span class=\"identifier\">string</span><span class=\"rparen\">)</span><span class=\"text\"> </span><span class=\"keyword\">as</span><span class=\"text\"> </span><span class=\"identifier\">xs</span><span class=\"text\">:</span><span class=\"identifier\">string</span><br/><span class=\"lparen\">{</span><br/><span class=\"text\">  </span><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$url-encoded</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"support function\">encode-for-uri</span><span class=\"lparen\">(</span><span class=\"variable\">$url</span><span class=\"rparen\">)</span><br/><span class=\"text\">  </span><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$result</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"support function\">http:send-request</span><span class=\"lparen\">(</span><br/><span class=\"text\">    &lt;</span><span class=\"meta tag\">http:request</span><span class=\"text\"> </span><span class=\"meta tag\">href</span><span class=\"text\">=</span><span class=\"string\">\"http://tinyurl.com/api-create.php?url={$url-encoded}\"</span><span class=\"text\"> </span><br/><span class=\"text\">                  </span><span class=\"meta tag\">method</span><span class=\"text\">=</span><span class=\"string\">\"get\"</span><span class=\"text\"> /&gt;</span><br/><span class=\"text\">  </span><span class=\"rparen\">)</span><br/><span class=\"text\">  </span><span class=\"keyword\">return</span><span class=\"text\"> </span><span class=\"variable\">$result</span><span class=\"lparen\">[</span><span class=\"constant\">2</span><span class=\"rparen\">]</span><br/><span class=\"rparen\">}</span><span class=\"text\">;</span><br/><br/><span class=\"keyword\">declare</span><span class=\"text\"> </span><span class=\"keyword\">function</span><span class=\"text\"> </span><span class=\"support function\">local:words-by-frequency</span><span class=\"lparen\">(</span><span class=\"variable\">$content</span><span class=\"rparen\">)</span><br/><span class=\"lparen\">{</span><span class=\"text\">   </span><br/><span class=\"text\">    </span><span class=\"keyword\">for</span><span class=\"text\"> </span><span class=\"variable\">$token</span><span class=\"text\"> </span><span class=\"keyword\">in</span><span class=\"text\"> </span><span class=\"support function\">ft:tokenize-string</span><span class=\"lparen\">(</span><span class=\"variable\">$content</span><span class=\"text\">, </span><span class=\"support function\">xs:language</span><span class=\"lparen\">(</span><span class=\"string\">\"en\"</span><span class=\"rparen\">)</span><span class=\"rparen\">)</span><br/><span class=\"text\">    </span><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$word</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"support function\">lower-case</span><span class=\"lparen\">(</span><span class=\"variable\">$token</span><span class=\"rparen\">)</span><br/><span class=\"text\">    </span><span class=\"keyword\">where</span><span class=\"text\"> </span><span class=\"support function\">not</span><span class=\"lparen\">(</span><span class=\"support function\">ft:is-stop-word</span><span class=\"lparen\">(</span><span class=\"variable\">$word</span><span class=\"rparen\">)</span><span class=\"rparen\">)</span><br/><span class=\"text\">    </span><span class=\"keyword\">group</span><span class=\"text\"> </span><span class=\"keyword\">by</span><span class=\"text\"> </span><span class=\"variable\">$word</span><br/><span class=\"text\">    </span><span class=\"keyword\">order</span><span class=\"text\"> </span><span class=\"keyword\">by</span><span class=\"text\"> </span><span class=\"support function\">count</span><span class=\"lparen\">(</span><span class=\"variable\">$token</span><span class=\"rparen\">)</span><span class=\"text\"> </span><span class=\"keyword\">descending</span><br/><span class=\"text\">    </span><span class=\"keyword\">return</span><span class=\"text\"> &lt;</span><span class=\"meta tag\">li</span><span class=\"text\">&gt;</span><span class=\"lparen\">{</span><span class=\"text\"> </span><span class=\"variable\">$word</span><span class=\"text\"> </span><span class=\"rparen\">}</span><span class=\"text\">&lt;/</span><span class=\"meta tag\">li</span><span class=\"text\">&gt;</span><br/><span class=\"rparen\">}</span><span class=\"text\">;</span><br/><br/><span class=\"text\">&lt;</span><span class=\"meta tag\">html</span><span class=\"text\">&gt;</span><br/><span class=\"text\">&lt;</span><span class=\"meta tag\">body</span><span class=\"text\">&gt;</span><br/><span class=\"lparen\">{</span><span class=\"text\"> </span><br/><span class=\"text\">    </span><span class=\"comment\">(:</span><span class=\"comment\"> (1) Download Atom feed :)</span><br/><span class=\"text\">    </span><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$feed</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"support function\">http:send-request</span><span class=\"lparen\">(</span><br/><span class=\"text\">      &lt;</span><span class=\"meta tag\">http:request</span><span class=\"text\"> </span><span class=\"meta tag\">href</span><span class=\"text\">=</span><span class=\"string\">\"http://www.zorba-xquery.com/blog/feed\"</span><br/><span class=\"text\">                    </span><span class=\"meta tag\">method</span><span class=\"text\">=</span><span class=\"string\">\"get\"</span><span class=\"text\"> /&gt;</span><br/><span class=\"text\">    </span><span class=\"rparen\">)</span><span class=\"lparen\">[</span><span class=\"constant\">2</span><span class=\"rparen\">]</span><br/><br/><span class=\"text\">    </span><span class=\"comment\">(:</span><span class=\"comment\"> For the first three entries in the feed... :)</span><br/><span class=\"text\">    </span><span class=\"keyword\">for</span><span class=\"text\"> </span><span class=\"variable\">$entry</span><span class=\"text\"> </span><span class=\"keyword\">in</span><span class=\"text\"> </span><span class=\"variable\">$feed</span><span class=\"text\">//</span><span class=\"identifier\">atom</span><span class=\"text\">:</span><span class=\"identifier\">entry</span><span class=\"lparen\">[</span><span class=\"support function\">position</span><span class=\"lparen\">(</span><span class=\"rparen\">)</span><span class=\"text\"> </span><span class=\"keyword\">le</span><span class=\"text\"> </span><span class=\"constant\">3</span><span class=\"rparen\">]</span><br/><span class=\"text\">    </span><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$title</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"variable\">$entry</span><span class=\"text\">/</span><span class=\"identifier\">atom</span><span class=\"text\">:</span><span class=\"identifier\">title</span><span class=\"text\">/</span><span class=\"support function\">text</span><span class=\"lparen\">(</span><span class=\"rparen\">)</span><br/><span class=\"text\">    </span><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$url</span><span class=\"text\">   :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"variable\">$entry</span><span class=\"text\">/</span><span class=\"identifier\">atom</span><span class=\"text\">:</span><span class=\"identifier\">link</span><span class=\"lparen\">[</span><span class=\"text\">@</span><span class=\"identifier\">rel</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"alternate\"</span><span class=\"rparen\">]</span><span class=\"text\">/@</span><span class=\"identifier\">href</span><span class=\"text\">/</span><span class=\"support function\">data</span><span class=\"lparen\">(</span><span class=\"rparen\">)</span><br/><br/><span class=\"text\">    </span><span class=\"comment\">(:</span><span class=\"comment\"> (2) Create the tiny URL :)</span><br/><span class=\"text\">    </span><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$tinyurl</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"support function\">local:create-tinyurl</span><span class=\"lparen\">(</span><span class=\"variable\">$url</span><span class=\"rparen\">)</span><br/><br/><span class=\"text\">    </span><span class=\"comment\">(:</span><span class=\"comment\"> (3) Get 10 most frequent words in feed entry:)</span><br/><span class=\"text\">    </span><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$flattened-content</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"support function\">string-join</span><span class=\"lparen\">(</span><span class=\"variable\">$entry</span><span class=\"text\">/</span><span class=\"identifier\">atom</span><span class=\"text\">:</span><span class=\"identifier\">content</span><span class=\"text\">//</span><span class=\"support function\">text</span><span class=\"lparen\">(</span><span class=\"rparen\">)</span><span class=\"text\">, </span><span class=\"string\">\" \"</span><span class=\"rparen\">)</span><br/><span class=\"text\">    </span><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$top-ten-words</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"support function\">local:words-by-frequency</span><span class=\"lparen\">(</span><span class=\"variable\">$flattened-content</span><span class=\"rparen\">)</span><span class=\"lparen\">[</span><span class=\"support function\">position</span><span class=\"lparen\">(</span><span class=\"rparen\">)</span><span class=\"text\"> </span><span class=\"keyword\">le</span><span class=\"text\"> </span><span class=\"constant\">10</span><span class=\"rparen\">]</span><br/><br/><span class=\"text\">    </span><span class=\"comment\">(:</span><span class=\"comment\"> (4) Return it as HTML :)</span><br/><span class=\"text\">    </span><span class=\"keyword\">return</span><br/><span class=\"text\">      &lt;</span><span class=\"meta tag\">div</span><span class=\"text\">&gt;</span><br/><span class=\"text\">        &lt;</span><span class=\"meta tag\">h2</span><span class=\"text\">&gt;&lt;</span><span class=\"meta tag\">a</span><span class=\"text\"> </span><span class=\"meta tag\">href</span><span class=\"text\">=</span><span class=\"string\">\"{ $tinyurl }\"</span><span class=\"text\">&gt;</span><span class=\"lparen\">{</span><span class=\"text\"> </span><span class=\"variable\">$title</span><span class=\"text\"> </span><span class=\"rparen\">}</span><span class=\"text\">&lt;/</span><span class=\"meta tag\">a</span><span class=\"text\">&gt;&lt;/</span><span class=\"meta tag\">h2</span><span class=\"text\">&gt;</span><br/><span class=\"text\">        &lt;</span><span class=\"meta tag\">ul</span><span class=\"text\">&gt;</span><span class=\"lparen\">{</span><span class=\"text\"> </span><span class=\"variable\">$top-ten-words</span><span class=\"text\"> </span><span class=\"rparen\">}</span><span class=\"text\">&lt;/</span><span class=\"meta tag\">ul</span><span class=\"text\">&gt;</span><br/><span class=\"text\">      &lt;/</span><span class=\"meta tag\">div</span><span class=\"text\">&gt;</span><br/><span class=\"rparen\">}</span><br/><span class=\"text\">&lt;/</span><span class=\"meta tag\">body</span><span class=\"text\">&gt;</span><br/><span class=\"text\">&lt;/</span><span class=\"meta tag\">html</span><span class=\"text\">&gt;</span></pre>\n<p>You can run the complete query online on our live sandbox <a href=\"http://www.zorba-xquery.com/html/demo#PYGvdckGc3S6YE9gbc2qtl/ufps=\">here</a> or download the source and run it locally.</p>\n<p>Et Voilà! With just a few lines of code, we were able to to process an Atom feed, interact with the Tiny URL web service and do some text analysis. In such use-cases, Zorba makes your life very easy. Check out the rest of <a href=\"/html/modules\">Zorba&#8217;s modules</a> fully packed with functionality.</p>\n</div>\n</div>", "authors" : [  ], "tags" : [  ] }, { "title" : "Zorba \"Eros\" 2.6: The JSONiq Release", "id" : "/60028280241/zorba-eros-26-the-jsoniq-release", "updated" : "Mon, 20 Aug 2012 00:00:00 -0400", "summary" : "The Zorba development team is pleased to announce the release of Zorba 2.6, codename Eros. The release is available in ourdownload section.", "content" : "<div class=\"entry-content\">\n<div>\n<p>The Zorba development team is pleased to announce the release of Zorba 2.6, codename Eros. The release is available in our<a href=\"/html/download\">download section</a>.</p>\n<p>Eros contains several new features, performance improvements, and bug fixes that are available on our <a href=\"https://launchpadlibrarian.net/112669217/ChangeLog\">ChangeLog</a>. But there is one feature on that list that we are particularly excited about&#8230;</p>\n<p>For a couple of months, we have been working on a project named <a href=\"http://jsoniq.org/\">JSONiq</a>, which extends the XQuery data model with JSON objects and arrays. The JSONiq specification has now reached a mature state and Zorba 2.6 is shipped with a JSONiq implementation. In other words, Zorba now supports JSON natively.</p>\n<pre class=\"ace-static\"><span class=\"lparen\">{</span><br/><span class=\"text\">  </span><span class=\"string\">\"Greeting\"</span><span class=\"text\"> : </span><span class=\"lparen\">(</span><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$d</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"JSON\"</span><br/><span class=\"text\">                </span><span class=\"keyword\">return</span><span class=\"text\"> </span><span class=\"string\">\"Hello, \"</span><span class=\"text\"> || </span><span class=\"variable\">$d</span><span class=\"rparen\">)</span><span class=\"text\">,</span><br/><span class=\"text\">  </span><span class=\"string\">\"Farewell\"</span><span class=\"text\"> : </span><span class=\"support function\">string-join</span><span class=\"lparen\">(</span><span class=\"lparen\">(</span><span class=\"string\">\"Live\"</span><span class=\"text\">, </span><span class=\"string\">\"long\"</span><span class=\"text\">, </span><span class=\"string\">\"and\"</span><span class=\"text\">, </span><span class=\"string\">\"prosper\"</span><span class=\"rparen\">)</span><span class=\"text\">, </span><span class=\"string\">\" \"</span><span class=\"rparen\">)</span><br/><span class=\"rparen\">}</span></pre>\n<p>The specification as well as railroad diagrams that showcase the grammar are available on <a href=\"http://www.jsoniq.org/\"><a href=\"http://www.jsoniq.org\">http://www.jsoniq.org</a></a>.</p>\n<p>If you already know XQuery, you can learn JSONiq quickly with the tutorial <a href=\"http://www.zorba-xquery.com/html/JSONforXQuery.html\">JSON for XQuery</a>. If you come from the JSON world, you will find an adapted tutorial named <a href=\"http://www.zorba-xquery.com/html/XQueryforJSON.html\">XQuery for JSON</a>.</p>\n<p>Finally, you can play with JSONiq on the <a href=\"http://www.zorba-xquery.com/html/demo\">Zorba sandbox</a></p>\n<p>Please find us at the Zorba booth next week at <a href=\"http://nosql2012.dataversity.net/\">@ NoSQL Now!</a> to learn more about JSONiq. Four talks featuring Zorba and JSONiq will be given:</p>\n<ul><li><a href=\"http://nosql2012.dataversity.net/sessionPop.cfm?confid=70&amp;proposalid=4888\">Advances in XML and XQuery</a> by Daniela Florescu</li>\n<li><a href=\"http://nosql2012.dataversity.net/sessionPop.cfm?confid=70&amp;proposalid=4832\">JSONiq: XQuery for JSON, JSON for XQuery</a> by Jonathan Robie</li>\n<li><a href=\"http://nosql2012.dataversity.net/sessionPop.cfm?confid=70&amp;proposalid=4850\">Implementing JSONiq: Add JSON to your XQuery processor in no time</a> by Chris Hillery</li>\n<li><a href=\"http://nosql2012.dataversity.net/sessionPop.cfm?confid=70&amp;proposalid=4841\">Harnessing Flexible Data in the Cloud</a> by Matthias Brantner</li>\n</ul>\n<p>We are looking forward to meeting you at NoSQL Now!</p>\n</div>\n</div>", "authors" : [  ], "tags" : [  ] }, { "title" : "API enhancements", "id" : "/60028229416/api-enhancements", "updated" : "Wed, 01 Aug 2012 00:00:00 -0400", "summary" : "Users are often using Zorba from different host languages. We usually see the C++ and Java APIs being used to integrate XQuery with core components. That’s the case of the 28msec platform for instance. The PHP, Python, and Ruby APIs are fairly popular for integrating Zorba into web applications. In the Zorba team, our favorite programming language is XQuery and we use XQuery as an host language for XQuery as much as possible ;-):", "content" : "<div class=\"entry-content\">\n<div>\n<p>Greetings from Zorba Labs!</p>\n<p>Users are often using Zorba from different host languages. We usually see the <a href=\"/html/documentation/2.5.0/cxx/indexpage\">C++</a> and <a href=\"/html/documentation/2.5.0/java/indexpage\">Java</a> APIs being used to integrate XQuery with core components. That&#8217;s the case of the <a href=\"http://28.io/\">28msec platform</a> for instance. The <a href=\"/html/entry/2011/12/27/PHP_Meets_XQuery\">PHP</a>, <a href=\"/html/documentation/2.5.0/python/indexpage\">Python</a>, and <a href=\"/html/documentation/2.5.0/ruby/indexpage\">Ruby</a> APIs are fairly popular for integrating Zorba into web applications. In the Zorba team, our favorite programming language is XQuery and we use <a href=\"/documentation/latest/modules/zorba/languages/xqxq\">XQuery as an host language for XQuery</a> as much as possible ;-)</p>\n<p>In the 2.5 release, we worked on several improvements to these APIs. The most important one is probably the addition of the <a href=\"/html/entry/2012/07/27/XQJ_From_Zorba\">XQJ API</a>. XQJ is the de facto standard API for using XQuery from Java and it enables Zorba to be integrated into many components that are already using XQJ. The Ruby, Python, and Java API are also containing several enhancements in 2.5. If you want to know how to install these bindings, you can look directly in our <a href=\"/html/documentation\">documentation for the different languages availables</a>.</p>\n<p>If you take a look to the <a href=\"/html/documentation\">documentation</a>, you will have a clear perspective of which are your possibilities with Zorba, but we have to say that the most remarkable changes that we included in this release come with the ItemFactory class and XmlDataManager class. The<em>ItemFactory</em> now is able to produce most of the data types supported by XQuery. And with the inclusion of the <em>XmlDataManager</em>, we added the ability to manage collections and documents. Here is an small example in Python using the collection manager:</p>\n<pre class=\"ace-static\"><span class=\"keyword\">import</span><span class=\"text\"> </span><span class=\"identifier\">sys</span><br/><span class=\"identifier\">sys</span><span class=\"text\">.</span><span class=\"identifier\">path</span><span class=\"text\">.</span><span class=\"identifier\">insert</span><span class=\"paren lparen\">(</span><span class=\"constant numeric\">0</span><span class=\"text\">, </span><span class=\"string\">'C:\\..path_to_zorba_python_lib'</span><span class=\"paren rparen\">)</span><br/><span class=\"keyword\">import</span><span class=\"text\"> </span><span class=\"identifier\">zorba_api</span><br/><br/><span class=\"identifier\">store</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"identifier\">zorba_api</span><span class=\"text\">.</span><span class=\"identifier\">InMemoryStore_getInstance</span><span class=\"paren lparen\">(</span><span class=\"paren rparen\">)</span><br/><span class=\"identifier\">zorba</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"identifier\">zorba_api</span><span class=\"text\">.</span><span class=\"identifier\">Zorba_getInstance</span><span class=\"paren lparen\">(</span><span class=\"identifier\">store</span><span class=\"paren rparen\">)</span><br/><br/><span class=\"identifier\">xmlManager</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"identifier\">zorba</span><span class=\"text\">.</span><span class=\"identifier\">getXmlDataManager</span><span class=\"paren lparen\">(</span><span class=\"paren rparen\">)</span><br/><span class=\"identifier\">collectionManager</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"identifier\">xmlManager</span><span class=\"text\">.</span><span class=\"identifier\">getCollectionManager</span><span class=\"paren lparen\">(</span><span class=\"paren rparen\">)</span><br/><span class=\"identifier\">itemFactory</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"identifier\">zorba</span><span class=\"text\">.</span><span class=\"identifier\">getItemFactory</span><span class=\"paren lparen\">(</span><span class=\"paren rparen\">)</span><br/><span class=\"identifier\">name</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"identifier\">itemFactory</span><span class=\"text\">.</span><span class=\"identifier\">createQName</span><span class=\"paren lparen\">(</span><span class=\"string\">\"http://www.zorba-xquery.com/\"</span><span class=\"text\">, </span><span class=\"string\">\"aaa\"</span><span class=\"paren rparen\">)</span><br/><span class=\"identifier\">collectionManager</span><span class=\"text\">.</span><span class=\"identifier\">createCollection</span><span class=\"paren lparen\">(</span><span class=\"identifier\">name</span><span class=\"paren rparen\">)</span><br/><span class=\"identifier\">isAdded</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"identifier\">collectionManager</span><span class=\"text\">.</span><span class=\"identifier\">isAvailableCollection</span><span class=\"paren lparen\">(</span><span class=\"identifier\">name</span><span class=\"paren rparen\">)</span><br/><br/><span class=\"keyword\">if</span><span class=\"text\"> </span><span class=\"identifier\">isAdded</span><span class=\"text\"> :</span><br/><span class=\"text\">  </span><span class=\"identifier\">collection</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"identifier\">collectionManager</span><span class=\"text\">.</span><span class=\"identifier\">getCollection</span><span class=\"paren lparen\">(</span><span class=\"identifier\">name</span><span class=\"paren rparen\">)</span><span class=\"text\">;</span><br/><span class=\"text\">  </span><span class=\"identifier\">data</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"identifier\">xmlManager</span><span class=\"text\">.</span><span class=\"identifier\">parseXMLtoItem</span><span class=\"paren lparen\">(</span><span class=\"string\">\"&lt;books&gt;Book 1Book 2\"</span><span class=\"paren rparen\">)</span><span class=\"text\">;</span><br/><span class=\"text\">  </span><span class=\"identifier\">itemSequence</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"identifier\">zorba_api</span><span class=\"text\">.</span><span class=\"identifier\">ItemSequence</span><span class=\"paren lparen\">(</span><span class=\"identifier\">data</span><span class=\"paren rparen\">)</span><br/><span class=\"text\">  </span><span class=\"identifier\">collection</span><span class=\"text\">.</span><span class=\"identifier\">insertNodesLast</span><span class=\"paren lparen\">(</span><span class=\"identifier\">itemSequence</span><span class=\"paren rparen\">)</span><br/><br/><span class=\"identifier\">zorba</span><span class=\"text\">.</span><span class=\"identifier\">shutdown</span><span class=\"paren lparen\">(</span><span class=\"paren rparen\">)</span><br/><span class=\"identifier\">zorba_api</span><span class=\"text\">.</span><span class=\"identifier\">InMemoryStore_shutdown</span><span class=\"paren lparen\">(</span><span class=\"identifier\">store</span><span class=\"paren rparen\">)</span></pre>\n<p>Same example in Ruby:</p>\n<pre class=\"ace-static\"><span class=\"support function\">require</span><span class=\"text\"> </span><span class=\"string\">'C:\\..path_to_zorba_ruby.so'</span><br/><br/><span class=\"identifier\">store</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"variable class\">Zorba_api</span><span class=\"text\">::</span><span class=\"variable class\">InMemoryStore</span><span class=\"text\">.</span><span class=\"identifier\">getInstance</span><span class=\"paren lparen\">(</span><span class=\"paren rparen\">)</span><br/><span class=\"identifier\">zorba</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"variable class\">Zorba_api</span><span class=\"text\">::</span><span class=\"variable class\">Zorba</span><span class=\"text\">.</span><span class=\"identifier\">getInstance</span><span class=\"paren lparen\">(</span><span class=\"identifier\">store</span><span class=\"paren rparen\">)</span><br/><br/><span class=\"identifier\">xmlManager</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"identifier\">zorba</span><span class=\"text\">.</span><span class=\"identifier\">getXmlDataManager</span><span class=\"paren lparen\">(</span><span class=\"paren rparen\">)</span><br/><span class=\"identifier\">collectionManager</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"identifier\">xmlManager</span><span class=\"text\">.</span><span class=\"identifier\">getCollectionManager</span><span class=\"paren lparen\">(</span><span class=\"paren rparen\">)</span><br/><span class=\"identifier\">itemFactory</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"identifier\">zorba</span><span class=\"text\">.</span><span class=\"identifier\">getItemFactory</span><span class=\"paren lparen\">(</span><span class=\"paren rparen\">)</span><br/><span class=\"identifier\">name</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"identifier\">itemFactory</span><span class=\"text\">.</span><span class=\"identifier\">createQName</span><span class=\"paren lparen\">(</span><span class=\"string\">\"http://www.zorba-xquery.com/\"</span><span class=\"text\">, </span><span class=\"string\">\"aaa\"</span><span class=\"paren rparen\">)</span><br/><span class=\"identifier\">collectionManager</span><span class=\"text\">.</span><span class=\"identifier\">createCollection</span><span class=\"paren lparen\">(</span><span class=\"identifier\">name</span><span class=\"paren rparen\">)</span><br/><span class=\"identifier\">isAdded</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"identifier\">collectionManager</span><span class=\"text\">.</span><span class=\"identifier\">isAvailableCollection</span><span class=\"paren lparen\">(</span><span class=\"identifier\">name</span><span class=\"paren rparen\">)</span><br/><br/><span class=\"keyword\">if</span><span class=\"text\"> </span><span class=\"identifier\">isAdded</span><span class=\"text\"> :</span><br/><span class=\"text\">  </span><span class=\"identifier\">collection</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"identifier\">collectionManager</span><span class=\"text\">.</span><span class=\"identifier\">getCollection</span><span class=\"paren lparen\">(</span><span class=\"identifier\">name</span><span class=\"paren rparen\">)</span><br/><span class=\"text\">  </span><span class=\"identifier\">data</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"identifier\">xmlManager</span><span class=\"text\">.</span><span class=\"identifier\">parseXMLtoItem</span><span class=\"paren lparen\">(</span><span class=\"string\">\"&lt;books&gt;Book 1Book 2\"</span><span class=\"paren rparen\">)</span><br/><span class=\"text\">  </span><span class=\"identifier\">itemSequence</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"variable class\">Zorba_api</span><span class=\"text\">::</span><span class=\"variable class\">ItemSequence</span><span class=\"text\">.</span><span class=\"identifier\">new</span><span class=\"paren lparen\">(</span><span class=\"identifier\">data</span><span class=\"paren rparen\">)</span><br/><span class=\"text\">  </span><span class=\"identifier\">collection</span><span class=\"text\">.</span><span class=\"identifier\">insertNodesLast</span><span class=\"paren lparen\">(</span><span class=\"identifier\">itemSequence</span><span class=\"paren rparen\">)</span><br/><span class=\"keyword\">end</span><br/><br/><span class=\"identifier\">zorba</span><span class=\"text\">.</span><span class=\"identifier\">shutdown</span><span class=\"paren lparen\">(</span><span class=\"paren rparen\">)</span><br/><span class=\"variable class\">Zorba_api</span><span class=\"text\">::</span><span class=\"variable class\">InMemoryStore</span><span class=\"text\">.</span><span class=\"identifier\">shutdown</span><span class=\"paren lparen\">(</span><span class=\"identifier\">store</span><span class=\"paren rparen\">)</span></pre>\n<p>The documentation covers this in more detail, so take a look and please tell us about your experience with these new features. All comments and suggestions are very welcome! Let us know if you have a suggestion for any other language.</p>\n<p>Cheers!</p>\n</div>\n</div>", "authors" : [  ], "tags" : [  ] }, { "title" : "XQJ from Zorba", "id" : "/60028183183/xqj-from-zorba", "updated" : "Fri, 27 Jul 2012 00:00:00 -0400", "summary" : "If you’ve ever wondered whether Zorba will support XQJ, now is the time. Starting with version 2.5 Zorba includes a XQJ layer where you can have full access to all the features specified by XQJ. The XQJ API enables Java programmers to execute XQuery against any XML data source.", "content" : "<div class=\"entry-content\">\n<div>\n<p>If you&#8217;ve ever wondered whether Zorba will support XQJ, now is the time. Starting with version 2.5 Zorba includes a XQJ layer where you can have full access to all the features specified by XQJ. The XQJ API enables Java programmers to execute XQuery against any XML data source. The advantages for Java users include:</p>\n<ul><li>Executing XQuery against an XML data source and processing the results in Java.</li>\n<li>Binding XQuery variables from Java.</li>\n<li>Creating prepared and ad-hoc XQuery expressions.</li>\n<li>Altering XQuery static and dynamic context behaviour.</li>\n</ul>\n<p>Now with this layer enabled for Zorba, you will have access to a fast multi-platform and open-source XQuery engine.</p>\n<p>Along with Zorba distribution we are including:</p>\n<ul><li><em>(lib)zorba_api[.so/.dll]</em> - Zorba-Java layer library</li>\n<li><em>zorba_api.jar</em> - Zorba-Java layer classes</li>\n<li><em>zorba-xqj.jar</em> - Zorba-XQJ layer classes</li>\n<li><em>xqjapi.jar</em> - XQJ Interfaces Standard</li>\n</ul>\n<p>Where can you find these files on your system? On Windows, they are usually installed in:</p>\n<pre class=\"ace-static\">C:\\Program Files (x86)\\Zorba XQuery Processor 2.X.0\\share\\java\nC:\\Program Files (x86)\\Zorba XQuery Processor 2.X.0\\share\\xqj\n</pre>\n<p>On Linux or Mac, you should be able to find them in:</p>\n<pre class=\"ace-static\">/usr/share/java \n/usr/share/xqj\n</pre>\n<p>Your project will need to you set-up one of the following environment variables use the variable according to your system:</p>\n<ul><li><strong>Windows:</strong> SET PATH=%PATH%;[path_to_zorba_api_dll]</li>\n<li><strong>Mac:</strong> export DYLD_LIBRARY_PATH=[path_to_zorba_api_so]</li>\n<li><strong>Linux:</strong> export LD_LIBRARY_PATH=[path_to_zorba_api_so]</li>\n</ul>\n<p>Now show your friends how easy is to manage XML. Here is an example of how the Zorba XQJ layer is being used in a single open-close connection:</p>\n<pre class=\"ace-static\"><span class=\"keyword\">import</span><span class=\"text\"> </span><span class=\"identifier\">javax</span><span class=\"text\">.</span><span class=\"identifier\">xml</span><span class=\"text\">.</span><span class=\"identifier\">xquery</span><span class=\"text\">.</span><span class=\"keyword operator\">*</span><span class=\"text\">;</span><br/><span class=\"keyword\">import</span><span class=\"text\"> </span><span class=\"identifier\">org</span><span class=\"text\">.</span><span class=\"identifier\">zorbaxquery</span><span class=\"text\">.</span><span class=\"identifier\">api</span><span class=\"text\">.</span><span class=\"identifier\">xqj</span><span class=\"text\">.</span><span class=\"keyword operator\">*</span><span class=\"text\">;</span><br/><br/><span class=\"comment\">// Getting Zorba Data Source</span><br/><span class=\"identifier\">ZorbaXQDataSource</span><span class=\"text\"> </span><span class=\"identifier\">xqds</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"keyword\">new</span><span class=\"text\"> </span><span class=\"identifier\">ZorbaXQDataSource</span><span class=\"lparen\">(</span><span class=\"rparen\">)</span><span class=\"text\">;</span><br/><span class=\"identifier\">XQConnection</span><span class=\"text\"> </span><span class=\"identifier\">xqc</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"identifier\">xqds</span><span class=\"text\">.</span><span class=\"identifier\">getConnection</span><span class=\"lparen\">(</span><span class=\"rparen\">)</span><span class=\"text\">;</span><br/><br/><span class=\"identifier\">Properties</span><span class=\"text\"> </span><span class=\"identifier\">props</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"keyword\">new</span><span class=\"text\"> </span><span class=\"identifier\">Properties</span><span class=\"lparen\">(</span><span class=\"rparen\">)</span><span class=\"text\">;</span><br/><br/><span class=\"identifier\">XQPreparedExpression</span><span class=\"text\"> </span><span class=\"identifier\">exp</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"identifier\">xqc</span><span class=\"text\">.</span><span class=\"identifier\">prepareExpression</span><span class=\"lparen\">(</span><span class=\"string\">\"’Hello from Zorba’\"</span><span class=\"rparen\">)</span><span class=\"text\">;</span><br/><span class=\"identifier\">XQResultSequence</span><span class=\"text\"> </span><span class=\"identifier\">res</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"identifier\">exp</span><span class=\"text\">.</span><span class=\"identifier\">executeQuery</span><span class=\"lparen\">(</span><span class=\"rparen\">)</span><span class=\"text\">;</span><br/><span class=\"keyword\">while</span><span class=\"text\"> </span><span class=\"lparen\">(</span><span class=\"identifier\">res</span><span class=\"text\">.</span><span class=\"identifier\">next</span><span class=\"lparen\">(</span><span class=\"rparen\">)</span><span class=\"rparen\">)</span><span class=\"text\"> </span><span class=\"lparen\">{</span><br/><span class=\"text\">  </span><span class=\"support function\">System</span><span class=\"text\">.</span><span class=\"identifier\">out</span><span class=\"text\">.</span><span class=\"identifier\">println</span><span class=\"lparen\">(</span><span class=\"identifier\">res</span><span class=\"text\">.</span><span class=\"identifier\">getItemAsString</span><span class=\"lparen\">(</span><span class=\"identifier\">props</span><span class=\"rparen\">)</span><span class=\"rparen\">)</span><span class=\"text\">;</span><br/><span class=\"rparen\">}</span><br/><br/><span class=\"identifier\">XQExpression</span><span class=\"text\"> </span><span class=\"identifier\">xqe</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"identifier\">xqc</span><span class=\"text\">.</span><span class=\"identifier\">createExpression</span><span class=\"lparen\">(</span><span class=\"rparen\">)</span><span class=\"text\">;</span><br/><span class=\"identifier\">XQResultSequence</span><span class=\"text\"> </span><span class=\"identifier\">xqs</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"identifier\">xqe</span><span class=\"text\">.</span><span class=\"identifier\">executeQuery</span><span class=\"lparen\">(</span><span class=\"string\">\"1,2,3\"</span><span class=\"rparen\">)</span><span class=\"text\">;</span><br/><span class=\"keyword\">while</span><span class=\"text\"> </span><span class=\"lparen\">(</span><span class=\"identifier\">xqs</span><span class=\"text\">.</span><span class=\"identifier\">next</span><span class=\"lparen\">(</span><span class=\"rparen\">)</span><span class=\"rparen\">)</span><span class=\"text\"> </span><span class=\"lparen\">{</span><br/><span class=\"text\">  </span><span class=\"support function\">System</span><span class=\"text\">.</span><span class=\"identifier\">out</span><span class=\"text\">.</span><span class=\"identifier\">println</span><span class=\"lparen\">(</span><span class=\"identifier\">xqs</span><span class=\"text\">.</span><span class=\"identifier\">getItemAsString</span><span class=\"lparen\">(</span><span class=\"identifier\">props</span><span class=\"rparen\">)</span><span class=\"rparen\">)</span><span class=\"text\">;</span><br/><span class=\"rparen\">}</span><br/><br/><span class=\"comment\">// IMPORTANT - Close to release resources</span><br/><span class=\"identifier\">xqc</span><span class=\"text\">.</span><span class=\"identifier\">close</span><span class=\"lparen\">(</span><span class=\"rparen\">)</span><span class=\"text\">;</span><br/><br/></pre>\n<p>This means that you can use Zorba with any other project that uses XQJ. And there is one more thing: we added a<a href=\"/html/documentation/2.5.0/xqj/classorg_1_1zorbaxquery_1_1api_1_1xqj_1_1ZorbaXQDocumentManager\">XQDocumentManager</a> and a <a href=\"/html/documentation/2.5.0/xqj/classorg_1_1zorbaxquery_1_1api_1_1xqj_1_1ZorbaXQCollectionManager\">XQCollectionManager</a> class directly from our Zorba framework. We have designed these classes based on the XQJ standard so you can use them directly with XQJ. To see how can you use these classes in Zorba, please refer directly to our<a href=\"/html/documentation/2.5.0/xqj/classes\">documentation</a>. Here is an example that shows Zorba collections in action:</p>\n<pre class=\"ace-static\"><span class=\"keyword\">import</span><span class=\"text\"> </span><span class=\"identifier\">javax</span><span class=\"text\">.</span><span class=\"identifier\">xml</span><span class=\"text\">.</span><span class=\"identifier\">xquery</span><span class=\"text\">.</span><span class=\"keyword operator\">*</span><span class=\"text\">;</span><br/><span class=\"keyword\">import</span><span class=\"text\"> </span><span class=\"identifier\">org</span><span class=\"text\">.</span><span class=\"identifier\">zorbaxquery</span><span class=\"text\">.</span><span class=\"identifier\">api</span><span class=\"text\">.</span><span class=\"identifier\">xqj</span><span class=\"text\">.</span><span class=\"keyword operator\">*</span><span class=\"text\">;</span><br/><br/><br/><span class=\"comment\">// Getting Zorba Data Source</span><br/><span class=\"identifier\">ZorbaXQDataSource</span><span class=\"text\"> </span><span class=\"identifier\">xqds</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"keyword\">new</span><span class=\"text\"> </span><span class=\"identifier\">ZorbaXQDataSource</span><span class=\"lparen\">(</span><span class=\"rparen\">)</span><span class=\"text\">;</span><br/><span class=\"identifier\">org</span><span class=\"text\">.</span><span class=\"identifier\">zorbaxquery</span><span class=\"text\">.</span><span class=\"identifier\">api</span><span class=\"text\">.</span><span class=\"identifier\">xqj</span><span class=\"text\">.</span><span class=\"identifier\">XQConnection</span><span class=\"text\"> </span><span class=\"identifier\">xqc</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"lparen\">(</span><span class=\"identifier\">org</span><span class=\"text\">.</span><span class=\"identifier\">zorbaxquery</span><span class=\"text\">.</span><span class=\"identifier\">api</span><span class=\"text\">.</span><span class=\"identifier\">xqj</span><span class=\"text\">.</span><span class=\"identifier\">XQConnection</span><span class=\"rparen\">)</span><span class=\"text\"> </span><span class=\"identifier\">xqds</span><span class=\"text\">.</span><span class=\"identifier\">getConnection</span><span class=\"lparen\">(</span><span class=\"rparen\">)</span><span class=\"text\">;</span><br/><span class=\"identifier\">XQXmlDataManager</span><span class=\"text\"> </span><span class=\"identifier\">xmlManager</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"identifier\">xqc</span><span class=\"text\">.</span><span class=\"identifier\">getXmlDataManager</span><span class=\"lparen\">(</span><span class=\"rparen\">)</span><span class=\"text\">;</span><br/><span class=\"identifier\">XQCollectionManager</span><span class=\"text\"> </span><span class=\"identifier\">colManager</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\">  </span><span class=\"identifier\">xmlManager</span><span class=\"text\">.</span><span class=\"identifier\">getCollectionManager</span><span class=\"lparen\">(</span><span class=\"rparen\">)</span><span class=\"text\">;</span><br/><span class=\"identifier\">URI</span><span class=\"text\"> </span><span class=\"identifier\">uri</span><span class=\"text\">;</span><br/><span class=\"identifier\">QName</span><span class=\"text\"> </span><span class=\"identifier\">qname</span><span class=\"text\">;</span><br/><span class=\"identifier\">XQItemType</span><span class=\"text\"> </span><span class=\"identifier\">type</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"constant language\">null</span><span class=\"text\">;</span><br/><span class=\"text\">  </span><span class=\"keyword\">try</span><span class=\"text\"> </span><span class=\"lparen\">{</span><br/><span class=\"text\">    </span><span class=\"identifier\">uri</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"keyword\">new</span><span class=\"text\"> </span><span class=\"identifier\">URI</span><span class=\"lparen\">(</span><span class=\"string\">\"http://www.mod2.com/\"</span><span class=\"rparen\">)</span><span class=\"text\">;</span><br/><span class=\"text\">    </span><span class=\"identifier\">qname</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"keyword\">new</span><span class=\"text\"> </span><span class=\"identifier\">QName</span><span class=\"lparen\">(</span><span class=\"string\">\"http://www.mod2.com/\"</span><span class=\"text\">, </span><span class=\"string\">\"col2\"</span><span class=\"rparen\">)</span><span class=\"text\">;</span><br/><span class=\"text\">    </span><span class=\"identifier\">type</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"identifier\">xqc</span><span class=\"text\">.</span><span class=\"identifier\">createAtomicType</span><span class=\"lparen\">(</span><span class=\"text\"> </span><span class=\"identifier\">XQItemType</span><span class=\"text\">.</span><span class=\"identifier\">XQBASETYPE_QNAME</span><span class=\"text\">, </span><span class=\"identifier\">qname</span><span class=\"text\">, </span><span class=\"identifier\">uri</span><span class=\"rparen\">)</span><span class=\"text\">;</span><br/><span class=\"text\">  </span><span class=\"rparen\">}</span><span class=\"text\"> </span><span class=\"keyword\">catch</span><span class=\"text\"> </span><span class=\"lparen\">(</span><span class=\"identifier\">URISyntaxException</span><span class=\"text\"> </span><span class=\"identifier\">e</span><span class=\"rparen\">)</span><span class=\"text\"> </span><span class=\"lparen\">{</span><br/><span class=\"text\">      </span><span class=\"keyword\">throw</span><span class=\"text\"> </span><span class=\"keyword\">new</span><span class=\"text\"> </span><span class=\"identifier\">XQException</span><span class=\"lparen\">(</span><span class=\"string\">\"Error creating QName: \"</span><span class=\"text\"> </span><span class=\"keyword operator\">+</span><span class=\"text\"> </span><span class=\"identifier\">e</span><span class=\"text\">.</span><span class=\"identifier\">getLocalizedMessage</span><span class=\"lparen\">(</span><span class=\"rparen\">)</span><span class=\"rparen\">)</span><span class=\"text\">;</span><br/><span class=\"text\">  </span><span class=\"rparen\">}</span><br/><span class=\"identifier\">XQItem</span><span class=\"text\"> </span><span class=\"identifier\">colName</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"identifier\">xqc</span><span class=\"text\">.</span><span class=\"identifier\">createItemFromString</span><span class=\"lparen\">(</span><span class=\"string\">\"col2\"</span><span class=\"text\">,  </span><span class=\"identifier\">type</span><span class=\"rparen\">)</span><span class=\"text\">;</span><br/><span class=\"identifier\">colManager</span><span class=\"text\">.</span><span class=\"identifier\">createCollection</span><span class=\"lparen\">(</span><span class=\"identifier\">colName</span><span class=\"rparen\">)</span><span class=\"text\">;</span><br/><span class=\"identifier\">XQCollection</span><span class=\"text\"> </span><span class=\"identifier\">collection</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"identifier\">colManager</span><span class=\"text\">.</span><span class=\"identifier\">getCollection</span><span class=\"lparen\">(</span><span class=\"identifier\">colName</span><span class=\"rparen\">)</span><span class=\"text\">;</span><br/><span class=\"identifier\">colName</span><span class=\"text\">.</span><span class=\"identifier\">close</span><span class=\"lparen\">(</span><span class=\"rparen\">)</span><span class=\"text\">;</span><br/><span class=\"identifier\">XQSequence</span><span class=\"text\"> </span><span class=\"identifier\">data</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"identifier\">xmlManager</span><span class=\"text\">.</span><span class=\"identifier\">parseXML</span><span class=\"lparen\">(</span><span class=\"string\">\"Book 1Book 2\"</span><span class=\"rparen\">)</span><span class=\"text\">;</span><br/><span class=\"identifier\">collection</span><span class=\"text\">.</span><span class=\"identifier\">insertNodesLast</span><span class=\"lparen\">(</span><span class=\"identifier\">data</span><span class=\"rparen\">)</span><span class=\"text\">;</span><br/><span class=\"identifier\">xqc</span><span class=\"text\">.</span><span class=\"identifier\">close</span><span class=\"lparen\">(</span><span class=\"rparen\">)</span><span class=\"text\">;</span><br/><br/></pre>\n<p>Our XQJ layer passes 100% of the XQJ TCK tests. Give it a try!</p>\n</div>\n</div>", "authors" : [  ], "tags" : [  ] }, { "title" : "Join Us @ NoSQL Now! 2012", "id" : "/60028135025/join-us--nosql-now-2012", "updated" : "Tue, 10 Jul 2012 00:00:00 -0400", "summary" : "Zorba is a proud partner of NoSQL Now! 2012, a conference covering the dynamic field of NoSQL technologies. This year’s edition features several XQuery-related talks and some of them will showcase new features in both XQuery 3.0 and Zorba.", "content" : "<div class=\"entry-content\">\n<div>\n<p>Zorba is a proud partner of <a href=\"http://nosql2012.dataversity.net/\">NoSQL Now! 2012</a>, a conference covering the dynamic field of NoSQL technologies. This year&#8217;s edition features several XQuery-related talks and some of them will showcase new features in both <a href=\"http://www.w3.org/TR/xquery-30/\">XQuery 3.0</a> and Zorba.</p>\n<p>Some people have claimed that XQuery was <a href=\"http://developer.marklogic.com/media/ML_shirt_design_NoSQL.jpg\">NoSQL before NoSQL was cool</a>. Well, this summer we get an opportunity to showcase that XQuery really is kind of cool but also to demonstrate where this technology fits in the NoSQL space.</p>\n<p>To get the party started, Daniela Florescu will present the latest <a href=\"http://nosql2012.dataversity.net/sessionPop.cfm?confid=70&amp;proposalid=4888\">Advances in XML and XQuery</a> in a tutorial format. Undoubtedly the most disruptive novelty in this area will be introduced by Jonathan Robie with <a href=\"http://nosql2012.dataversity.net/sessionPop.cfm?confid=70&amp;proposalid=4832\">JSONiq: XQuery for JSON, JSON for XQuery</a>. The JSONiq implementation in Zorba is currently in late development stage and you can already <a href=\"/html/jsoniq\">try it live</a>.</p>\n<p>For XQuery implementors looking to add JSON support to your own processor, Chris Hillery will tell us everything about it in<a href=\"http://nosql2012.dataversity.net/sessionPop.cfm?confid=70&amp;proposalid=4850\">Implementing JSONiq: Add JSON to your XQuery processor in no time</a>.</p>\n<p>Last but not least, Matthias Brantner will introduce the <a href=\"http://28.io/\">28msec platform</a> that integrates Zorba with the MongoDB scalable store. The talk is titled <a href=\"http://nosql2012.dataversity.net/sessionPop.cfm?confid=70&amp;proposalid=4841\">Harnessing Flexible Data in the Cloud</a>.</p>\n<p>We hope to see you there at the Zorba booth. We will happily answer questions and debug queries ;-) If you plan to register, don&#8217;t forget to use the <strong>ZORBA</strong> coupon code to get $500 off for the entire event, $300 off any of the 2-day options, or $100 off for the single day option.</p>\n<p>See you in Silicon Valley!</p>\n</div>\n</div>", "authors" : [  ], "tags" : [  ] }, { "title" : "Painless XML Schema typing with Zorba", "id" : "/60028086432/painless-xml-schema-typing-with-zorba", "updated" : "Tue, 26 Jun 2012 00:00:00 -0400", "summary" : "Providing a schema for your data makes your applications much more robust and can enable numerous optimizations in your query processor. However, many users shy away from the complexity of XML Schema. Well, what if you could generate a schema automatically from your data? Or what if you could generate a sample instance from a big schema and modify it with your data in just a few lines of code? Now you can!", "content" : "<div class=\"entry-content\">\n<div>\n<p>Providing a schema for your data makes your applications much more robust and can enable numerous optimizations in your query processor. However, many users shy away from the complexity of XML Schema. Well, what if you could generate a schema automatically from your data? Or what if you could generate a sample instance from a big schema and modify it with your data in just a few lines of code? Now you can!</p>\n<p>The schema-tools module contains functions to go in both directions between instances and schemas: <strong>xsd2inst</strong> to get an instance from a schema set and <strong>inst2xsd</strong> to get schema for a set of instances.</p>\n<p>Let’s dive in.</p>\n<h2>From schema to instance</h2>\n<p>This is quite useful when trying out a web-service API described by a schema or for generating data for unit or performance testing. In other domains like WSDL or more specific like XBRL the documents contain schema definitions for some parts of the document. For these xsd2inst helps with generating documents when using these web-services.</p>\n<p>Let&#8217;s look at an example - finding out the location of an IP address using the <a href=\"http://www.restfulwebservices.net/wcf/GeoIPService.svc\">GeoIPService</a>. The GeoIP service has <a href=\"http://www.restfulwebservices.net/wcf/GeoIPService.svc?wsdl\">a WSDL</a> that contains a link to <a href=\"http://www.restfulwebservices.net/wcf/GeoIPService.svc?xsd=xsd0\">the schema of a valid input document</a>. To find out what the input document should look like we can write the following:</p>\n<pre class=\"ace-static\"><span class=\"keyword\">import</span><span class=\"text\"> </span><span class=\"keyword\">module</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">st</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://www.zorba-xquery.com/modules/schema-tools\"</span><span class=\"text\">;</span><br/><span class=\"keyword\">import</span><span class=\"text\"> </span><span class=\"keyword\">module</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">http</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://expath.org/ns/http-client\"</span><span class=\"text\">;</span><br/><br/><span class=\"keyword\">declare</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">sto</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://www.zorba-xquery.com/modules/schema-tools/schema-tools-options\"</span><span class=\"text\">;</span><br/><br/><br/><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$xsd</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"support function\">http:send-request</span><span class=\"lparen\">(</span><span class=\"lparen\">(</span><span class=\"rparen\">)</span><span class=\"text\">, </span><span class=\"string\">\"http://www.restfulwebservices.net/wcf/GeoIPService.svc?xsd=xsd0\"</span><span class=\"rparen\">)</span><span class=\"lparen\">[</span><span class=\"constant\">2</span><span class=\"rparen\">]</span><span class=\"text\">/</span><span class=\"keyword operator\">*</span><br/><br/><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$opt</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> &lt;</span><span class=\"meta tag\">sto:xsd2inst-options</span><span class=\"text\">&gt;</span><br/><span class=\"text\">              &lt;</span><span class=\"meta tag\">sto:network-downloads</span><span class=\"text\">&gt;</span><span class=\"identifier\">true</span><span class=\"text\">&lt;/</span><span class=\"meta tag\">sto:network-downloads</span><span class=\"text\">&gt;</span><br/><span class=\"text\">        \t&lt;/</span><span class=\"meta tag\">sto:xsd2inst-options</span><span class=\"text\">&gt;</span><br/><span class=\"keyword\">return</span><br/><span class=\"text\">\t</span><span class=\"support function\">st:xsd2inst</span><span class=\"lparen\">(</span><span class=\"lparen\">(</span><span class=\"variable\">$xsd</span><span class=\"rparen\">)</span><span class=\"text\">, </span><span class=\"string\">\"Analyse\"</span><span class=\"text\">, </span><span class=\"variable\">$opt</span><span class=\"rparen\">)</span><br/><br/></pre>\n<p>Getting this result:</p>\n<pre class=\"ace-static\"><span class=\"xml_pe\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span><br/><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">ns:Analyse</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">xmlns:ns</span><span class=\"keyword operator\">=</span><span class=\"string\">\"http://www.restfulwebservices.net/ServiceContracts/2008/01\"</span><span class=\"meta tag\">&gt;</span><br/><span class=\"text\">  </span><span class=\"comment\">&lt;!--</span><span class=\"comment\">Optional:--&gt;</span><br/><span class=\"text\">  </span><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">ns:request</span><span class=\"meta tag\">&gt;</span><span class=\"text\">string</span><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">ns:request</span><span class=\"meta tag\">&gt;</span><br/><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">ns:Analyse</span><span class=\"meta tag\">&gt;</span></pre>\n<p>http:send-request() was used to retrieve the schema and st:xsd2inst() generated a valid instance for it.</p>\n<p>Now, using XQuery Update&#8217;s copy/modify/return construct, we can modify this instance to put a valid IP address into the <em>&lt;request&gt;</em>element.</p>\n<pre class=\"ace-static\"><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$xsd</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"support function\">http:send-request</span><span class=\"lparen\">(</span><span class=\"lparen\">(</span><span class=\"rparen\">)</span><span class=\"text\">, </span><span class=\"string\">\"http://www.restfulwebservices.net/wcf/GeoIPService.svc?xsd=xsd0\"</span><span class=\"rparen\">)</span><span class=\"lparen\">[</span><span class=\"constant\">2</span><span class=\"rparen\">]</span><span class=\"text\">/</span><span class=\"keyword operator\">*</span><br/><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$opt</span><span class=\"text\">  :</span><span class=\"keyword operator\">=</span><span class=\"text\"> &lt;</span><span class=\"meta tag\">sto:xsd2inst-options</span><span class=\"text\">&gt;</span><br/><span class=\"text\">           \t&lt;</span><span class=\"meta tag\">sto:network-downloads</span><span class=\"text\">&gt;</span><span class=\"identifier\">true</span><span class=\"text\">&lt;/</span><span class=\"meta tag\">sto:network-downloads</span><span class=\"text\">&gt;</span><br/><span class=\"text\">         \t&lt;/</span><span class=\"meta tag\">sto:xsd2inst-options</span><span class=\"text\">&gt;</span><br/><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$sampleInput</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><br/><span class=\"text\">\t</span><span class=\"support function\">st:xsd2inst</span><span class=\"lparen\">(</span><span class=\"lparen\">(</span><span class=\"variable\">$xsd</span><span class=\"rparen\">)</span><span class=\"text\">, </span><span class=\"string\">\"Analyse\"</span><span class=\"text\">, </span><span class=\"variable\">$opt</span><span class=\"rparen\">)</span><br/><span class=\"keyword\">return</span><span class=\"text\">    </span><br/><span class=\"text\">  </span><span class=\"keyword\">copy</span><span class=\"text\"> </span><span class=\"variable\">$d</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"variable\">$sampleInput</span><br/><span class=\"text\">  </span><span class=\"keyword\">modify</span><br/><span class=\"text\">  </span><span class=\"lparen\">(</span><br/><span class=\"text\">\t</span><span class=\"keyword\">replace</span><span class=\"text\"> </span><span class=\"keyword\">value</span><span class=\"text\"> </span><span class=\"keyword\">of</span><span class=\"text\"> </span><span class=\"keyword\">node</span><span class=\"text\"> </span><span class=\"variable\">$d</span><span class=\"text\">//</span><span class=\"keyword operator\">*</span><span class=\"text\">:</span><span class=\"identifier\">request</span><span class=\"text\"> </span><span class=\"keyword\">with</span><span class=\"text\"> </span><span class=\"string\">\"2.2.2.2\"</span><br/><span class=\"text\">  </span><span class=\"rparen\">)</span><br/><span class=\"text\">  </span><span class=\"keyword\">return</span><br/><span class=\"text\">\t</span><span class=\"variable\">$d</span><br/><br/></pre>\n<p>Returning:</p>\n<pre class=\"ace-static\"><span class=\"xml_pe\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span><br/><span class=\"text\">&lt;</span><span class=\"meta tag\">ns:Analyse</span><span class=\"text\"> </span><span class=\"meta tag\">xmlns:ns</span><span class=\"text\">=</span><span class=\"string\">\"http://www.restfulwebservices.net/ServiceContracts/2008/01\"</span><span class=\"text\">&gt;</span><br/><span class=\"text\">  </span><span class=\"comment\">&lt;!--</span><span class=\"comment\">Optional:--&gt;</span><br/><span class=\"text\">  &lt;</span><span class=\"meta tag\">ns:request</span><span class=\"text\">&gt;</span><span class=\"constant\">2.2</span><span class=\"text\">.</span><span class=\"constant\">2.2</span><span class=\"text\">&lt;/</span><span class=\"meta tag\">ns:request</span><span class=\"text\">&gt;</span><br/><span class=\"text\">&lt;/</span><span class=\"meta tag\">ns:Analyse</span><span class=\"text\">&gt;</span></pre>\n<p>With the request message constructed we can call the GeoIP web-service. Everything put together should look like this:</p>\n<pre class=\"ace-static\"><span class=\"keyword\">import</span><span class=\"text\"> </span><span class=\"keyword\">module</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">st</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://www.zorba-xquery.com/modules/schema-tools\"</span><span class=\"text\">;</span><br/><span class=\"keyword\">import</span><span class=\"text\"> </span><span class=\"keyword\">module</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">http</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://expath.org/ns/http-client\"</span><span class=\"text\">;</span><br/><br/><span class=\"keyword\">declare</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">sto</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://www.zorba-xquery.com/modules/schema-tools/schema-tools-options\"</span><span class=\"text\">;</span><br/><span class=\"keyword\">declare</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">soap</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://schemas.xmlsoap.org/soap/envelope/\"</span><span class=\"text\">;</span><br/><br/><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$xsd</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"support function\">http:send-request</span><span class=\"lparen\">(</span><span class=\"lparen\">(</span><span class=\"rparen\">)</span><span class=\"text\">, </span><span class=\"string\">\"http://www.restfulwebservices.net/wcf/GeoIPService.svc?xsd=xsd0\"</span><span class=\"rparen\">)</span><span class=\"lparen\">[</span><span class=\"constant\">2</span><span class=\"rparen\">]</span><span class=\"text\">/</span><span class=\"keyword operator\">*</span><br/><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$opt</span><span class=\"text\">  :</span><span class=\"keyword operator\">=</span><span class=\"text\"> &lt;</span><span class=\"meta tag\">sto:xsd2inst-options</span><span class=\"text\">&gt;</span><br/><span class=\"text\">           \t&lt;</span><span class=\"meta tag\">sto:network-downloads</span><span class=\"text\">&gt;</span><span class=\"identifier\">true</span><span class=\"text\">&lt;/</span><span class=\"meta tag\">sto:network-downloads</span><span class=\"text\">&gt;</span><br/><span class=\"text\">         \t&lt;/</span><span class=\"meta tag\">sto:xsd2inst-options</span><span class=\"text\">&gt;</span><br/><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$sampleInput</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><br/><span class=\"text\">\t</span><span class=\"support function\">st:xsd2inst</span><span class=\"lparen\">(</span><span class=\"lparen\">(</span><span class=\"variable\">$xsd</span><span class=\"rparen\">)</span><span class=\"text\">, </span><span class=\"string\">\"Analyse\"</span><span class=\"text\">, </span><span class=\"variable\">$opt</span><span class=\"rparen\">)</span><span class=\"text\">/</span><span class=\"keyword operator\">*</span><br/><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$input</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\">    </span><br/><span class=\"text\">  </span><span class=\"keyword\">copy</span><span class=\"text\"> </span><span class=\"variable\">$d</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"variable\">$sampleInput</span><br/><span class=\"text\">  </span><span class=\"keyword\">modify</span><br/><span class=\"text\">  </span><span class=\"lparen\">(</span><br/><span class=\"text\">\t</span><span class=\"keyword\">replace</span><span class=\"text\"> </span><span class=\"keyword\">value</span><span class=\"text\"> </span><span class=\"keyword\">of</span><span class=\"text\"> </span><span class=\"keyword\">node</span><span class=\"text\"> </span><span class=\"variable\">$d</span><span class=\"text\">//</span><span class=\"keyword operator\">*</span><span class=\"text\">:</span><span class=\"identifier\">request</span><span class=\"text\"> </span><span class=\"keyword\">with</span><span class=\"text\"> </span><span class=\"string\">\"2.2.2.2\"</span><br/><span class=\"text\">  </span><span class=\"rparen\">)</span><br/><span class=\"text\">  </span><span class=\"keyword\">return</span><br/><span class=\"text\">\t</span><span class=\"variable\">$d</span><br/><br/><span class=\"text\"> </span><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$req</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> &lt;</span><span class=\"meta tag\">http:request</span><span class=\"text\"> </span><span class=\"meta tag\">method</span><span class=\"text\">=</span><span class=\"string\">\"POST\"</span><span class=\"text\">&gt;</span><br/><span class=\"text\">\t\t\t\t&lt;</span><span class=\"meta tag\">http:header</span><span class=\"text\"> </span><span class=\"meta tag\">name</span><span class=\"text\">=</span><span class=\"string\">\"SOAPAction\"</span><span class=\"text\"> </span><span class=\"meta tag\">value</span><span class=\"text\">=</span><span class=\"string\">\"Analyse\"</span><span class=\"text\">/&gt;</span><br/><span class=\"text\">           \t&lt;</span><span class=\"meta tag\">http:body</span><span class=\"text\"> </span><span class=\"meta tag\">media-type</span><span class=\"text\">=</span><span class=\"string\">\"text/xml\"</span><span class=\"text\"> &gt;</span><br/><span class=\"text\">           \t&lt;/</span><span class=\"meta tag\">http:body</span><span class=\"text\">&gt;</span><br/><span class=\"text\">         \t&lt;/</span><span class=\"meta tag\">http:request</span><span class=\"text\">&gt;    </span><br/><span class=\"text\">       \t </span><br/><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$soap</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> &lt;</span><span class=\"meta tag\">soap:Envelope</span><span class=\"text\">&gt;</span><br/><span class=\"text\">           \t&lt;</span><span class=\"meta tag\">soap:Header</span><span class=\"text\">/&gt;</span><br/><span class=\"text\">           \t&lt;</span><span class=\"meta tag\">soap:Body</span><span class=\"text\">&gt;</span><br/><span class=\"text\">               \t</span><span class=\"lparen\">{</span><span class=\"variable\">$input</span><span class=\"rparen\">}</span><br/><span class=\"text\">           \t&lt;/</span><span class=\"meta tag\">soap:Body</span><span class=\"text\">&gt;</span><br/><span class=\"text\">         \t&lt;/</span><span class=\"meta tag\">soap:Envelope</span><span class=\"text\">&gt;  \t </span><br/><span class=\"text\">\t </span><br/><span class=\"keyword\">return</span><br/><span class=\"text\">  </span><span class=\"support function\">http:send-request</span><span class=\"lparen\">(</span><span class=\"variable\">$req</span><span class=\"text\">, </span><span class=\"string\">\"http://www.restfulwebservices.net/wcf/GeoIPService.svc\"</span><span class=\"text\">, </span><span class=\"variable\">$soap</span><span class=\"rparen\">)</span><span class=\"lparen\">[</span><span class=\"constant\">2</span><span class=\"rparen\">]</span></pre>\n<p>Which returns the following result:</p>\n<pre class=\"ace-static\"><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">s:Envelope</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">xmlns:s</span><span class=\"keyword operator\">=</span><span class=\"string\">\"http://schemas.xmlsoap.org/soap/envelope/\"</span><span class=\"meta tag\">&gt;</span><br/><span class=\"text\">  </span><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">s:Body</span><span class=\"meta tag\">&gt;</span><br/><span class=\"text\">\t</span><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">AnalyseResponse</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">xmlns</span><span class=\"keyword operator\">=</span><span class=\"string\">\"http://www.restfulwebservices.net/ServiceContracts/2008/01\"</span><span class=\"meta tag\">&gt;</span><br/><span class=\"text\">  \t</span><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">AnalyseResult</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">xmlns:a</span><span class=\"keyword operator\">=</span><span class=\"string\">\"http://www.restfulwebservices.net/DataContracts/2008/01\"</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">xmlns:i</span><span class=\"keyword operator\">=</span><span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span><span class=\"meta tag\">&gt;</span><br/><span class=\"text\">    \t</span><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">a:Registry</span><span class=\"meta tag\">&gt;</span><span class=\"text\">ARIN</span><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">a:Registry</span><span class=\"meta tag\">&gt;</span><br/><span class=\"text\">    \t</span><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">a:Assigned</span><span class=\"meta tag\">&gt;</span><span class=\"text\">772588800</span><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">a:Assigned</span><span class=\"meta tag\">&gt;</span><br/><span class=\"text\">    \t</span><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">a:CountryCode</span><span class=\"meta tag\">&gt;</span><span class=\"text\">US</span><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">a:CountryCode</span><span class=\"meta tag\">&gt;</span><br/><span class=\"text\">    \t</span><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">a:ISOCountryCode</span><span class=\"meta tag\">&gt;</span><span class=\"text\">USA</span><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">a:ISOCountryCode</span><span class=\"meta tag\">&gt;</span><br/><span class=\"text\">    \t</span><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">a:Country</span><span class=\"meta tag\">&gt;</span><span class=\"text\">UNITED STATES</span><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">a:Country</span><span class=\"meta tag\">&gt;</span><br/><span class=\"text\">  \t</span><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">AnalyseResult</span><span class=\"meta tag\">&gt;</span><br/><span class=\"text\">\t</span><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">AnalyseResponse</span><span class=\"meta tag\">&gt;</span><br/><span class=\"text\">  </span><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">s:Body</span><span class=\"meta tag\">&gt;</span><br/><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">s:Envelope</span><span class=\"meta tag\">&gt;</span></pre>\n<p>Run it <a href=\"http://www.zorba-xquery.com/html/demo#Sus4nEAK2c1o1vTzQUCaSJudj7I=\">live</a>.</p>\n<h2>From instances to schema</h2>\n<p>In many cases using a schema is a good idea to formally define the contract of the interface, and even the rules that describe how the contract might change so that it remains backwards compatible. There are cases when starting from an instance is faster, simpler, or easier to start with. For these cases, the inst2xsd tool is a good way to generate a schema.</p>\n<p>Let&#8217;s say we are creating our own web service based on GeoIP. The result we got in the last sample was not structured exactly how we like and we would like something simpler like this:</p>\n<pre class=\"ace-static\"><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">country</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">isoCode</span><span class=\"keyword operator\">=</span><span class=\"text\">”</span><span class=\"entity other.attribute-name\">USA</span><span class=\"text\">”</span><span class=\"meta tag\">&gt;</span><span class=\"text\">UNITED STATES</span><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">country</span><span class=\"meta tag\">&gt;</span></pre>\n<p>XQuery is made for performing these kinds of transformations and makes it really simple:</p>\n<pre class=\"ace-static\"><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$res</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> &lt;</span><span class=\"meta tag\">s:Envelope</span><span class=\"text\"> </span><span class=\"meta tag\">xmlns:s</span><span class=\"text\">=</span><span class=\"string\">\"http://schemas.xmlsoap.org/soap/envelope/\"</span><span class=\"text\">&gt;</span><br/><span class=\"text\">  ...</span><br/><span class=\"text\">&lt;/</span><span class=\"meta tag\">s:Envelope</span><span class=\"text\">&gt;</span><br/><br/><span class=\"keyword\">return</span><br/><span class=\"text\">  &lt;</span><span class=\"meta tag\">country</span><span class=\"text\"> </span><span class=\"meta tag\">isoCode</span><span class=\"text\">=</span><span class=\"string\">\"{fn:data($res//*:ISOCountryCode)}\"</span><span class=\"text\">&gt;</span><br/><span class=\"text\">    </span><span class=\"lparen\">{</span><span class=\"support function\">fn:data</span><span class=\"lparen\">(</span><span class=\"variable\">$res</span><span class=\"text\">//</span><span class=\"keyword operator\">*</span><span class=\"text\">:</span><span class=\"identifier\">Country</span><span class=\"rparen\">)</span><span class=\"rparen\">}</span><br/><span class=\"text\">  &lt;/</span><span class=\"meta tag\">country</span><span class=\"text\">&gt;</span></pre>\n<p>Now getting the schema for this structure is straightforward using the inst2xsd function. This function generates a schema for a given instance. The options element contain smart detection of simple types and when to use enumeration values.</p>\n<pre class=\"ace-static\"><span class=\"keyword\">import</span><span class=\"text\"> </span><span class=\"keyword\">module</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">st</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://www.zorba-xquery.com/modules/schema-tools\"</span><span class=\"text\">;</span><br/><br/><span class=\"keyword\">declare</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">sto</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://www.zorba-xquery.com/modules/schema-tools/schema-tools-options\"</span><span class=\"text\">;</span><br/><br/><br/><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$inst</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> &lt;</span><span class=\"meta tag\">country</span><span class=\"text\"> </span><span class=\"meta tag\">isoCode</span><span class=\"text\">=</span><span class=\"string\">\"USA\"</span><span class=\"text\">&gt;</span><span class=\"identifier\">UNITED</span><span class=\"text\"> </span><span class=\"identifier\">STATES</span><span class=\"text\">&lt;/</span><span class=\"meta tag\">country</span><span class=\"text\">&gt;</span><br/><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$opt</span><span class=\"text\">  :</span><span class=\"keyword operator\">=</span><span class=\"text\"> &lt;</span><span class=\"meta tag\">sto:inst2xsd-options</span><span class=\"text\">&gt;</span><br/><span class=\"text\">               &lt;</span><span class=\"meta tag\">sto:simple-content-types</span><span class=\"text\">&gt;</span><span class=\"identifier\">smart</span><span class=\"text\">&lt;/</span><span class=\"meta tag\">sto:simple-content-types</span><span class=\"text\">&gt;</span><br/><span class=\"text\">               &lt;</span><span class=\"meta tag\">sto:use-enumeration</span><span class=\"text\">&gt;</span><span class=\"constant\">2</span><span class=\"text\">&lt;/</span><span class=\"meta tag\">sto:use-enumeration</span><span class=\"text\">&gt;</span><br/><span class=\"text\">        \t &lt;/</span><span class=\"meta tag\">sto:inst2xsd-options</span><span class=\"text\">&gt;</span><br/><span class=\"keyword\">return</span><br/><span class=\"text\">  </span><span class=\"support function\">st:inst2xsd</span><span class=\"lparen\">(</span><span class=\"variable\">$inst</span><span class=\"text\">, </span><span class=\"variable\">$opt</span><span class=\"rparen\">)</span></pre>\n<p>This returns the full schema to represent our simple result:</p>\n<pre class=\"ace-static\"><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">xs:schema</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">xmlns:xs</span><span class=\"keyword operator\">=</span><span class=\"string\">\"http://www.w3.org/2001/XMLSchema\"</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">attributeFormDefault</span><span class=\"keyword operator\">=</span><span class=\"string\">\"unqualified\"</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">elementFormDefault</span><span class=\"keyword operator\">=</span><span class=\"string\">\"qualified\"</span><span class=\"meta tag\">&gt;</span><br/><span class=\"text\">  </span><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">xs:element</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">name</span><span class=\"keyword operator\">=</span><span class=\"string\">\"country\"</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">type</span><span class=\"keyword operator\">=</span><span class=\"string\">\"countryType\"</span><span class=\"meta tag\">/&gt;</span><br/><span class=\"text\">  </span><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">xs:complexType</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">name</span><span class=\"keyword operator\">=</span><span class=\"string\">\"countryType\"</span><span class=\"meta tag\">&gt;</span><br/><span class=\"text\">\t</span><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">xs:simpleContent</span><span class=\"meta tag\">&gt;</span><br/><span class=\"text\">  \t</span><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">xs:extension</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">base</span><span class=\"keyword operator\">=</span><span class=\"string\">\"xs:string\"</span><span class=\"meta tag\">&gt;</span><br/><span class=\"text\">    \t</span><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">xs:attribute</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">type</span><span class=\"keyword operator\">=</span><span class=\"string\">\"xs:string\"</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">name</span><span class=\"keyword operator\">=</span><span class=\"string\">\"isoCode\"</span><span class=\"meta tag\">/&gt;</span><br/><span class=\"text\">  \t</span><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">xs:extension</span><span class=\"meta tag\">&gt;</span><br/><span class=\"text\">\t</span><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">xs:simpleContent</span><span class=\"meta tag\">&gt;</span><br/><span class=\"text\">  </span><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">xs:complexType</span><span class=\"meta tag\">&gt;</span><br/><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">xs:schema</span><span class=\"meta tag\">&gt;</span></pre>\n<p>We can use this schema to make the result of our function typed or, if we make it a web-service, to describe the structure of the result. Try it <a href=\"http://www.zorba-xquery.com/html/demo#got4WDe+E7iZ3TnOc200rsVB7fY=\">live</a>.</p>\n<p>For a more complicated instance let&#8217;s look at an example that generates a sample schema for <a href=\"http://dev.iptc.org/files/SportsML-Examples/sportsml-2.2-soccer-sample.xml\">a document found on the web</a>. This document is an instance of SportsML, which has a formal schema defined by IPTC, but for this example let&#8217;s pretend there isn&#8217;t one.</p>\n<pre class=\"ace-static\"><span class=\"keyword\">import</span><span class=\"text\"> </span><span class=\"keyword\">module</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">st</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://www.zorba-xquery.com/modules/schema-tools\"</span><span class=\"text\">;</span><br/><span class=\"keyword\">import</span><span class=\"text\"> </span><span class=\"keyword\">module</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">http</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://expath.org/ns/http-client\"</span><span class=\"text\">;</span><br/><br/><span class=\"keyword\">declare</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">sto</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://www.zorba-xquery.com/modules/schema-tools/schema-tools-options\"</span><span class=\"text\">;</span><br/><br/><br/><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$inst</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"support function\">http:send-request</span><span class=\"lparen\">(</span><span class=\"lparen\">(</span><span class=\"rparen\">)</span><span class=\"text\">, </span><br/><span class=\"text\">    </span><span class=\"string\">\"http://dev.iptc.org/files/SportsML-Examples/sportsml-2.2-soccer-sample.xml\"</span><span class=\"rparen\">)</span><span class=\"lparen\">[</span><span class=\"constant\">2</span><span class=\"rparen\">]</span><span class=\"text\">/</span><span class=\"keyword operator\">*</span><br/><br/><span class=\"keyword\">return</span><br/><span class=\"text\">\t</span><span class=\"support function\">st:inst2xsd</span><span class=\"lparen\">(</span><span class=\"variable\">$inst</span><span class=\"text\">, </span><span class=\"lparen\">(</span><span class=\"rparen\">)</span><span class=\"rparen\">)</span></pre>\n<p>The result is a schema document defining this particular instance. <a href=\"http://www.zorba-xquery.com/html/demo#6d/B2CGmu1yd9tohtkhysIUE0OY=\">Try it live</a> to see the entire result.</p>\n<pre class=\"ace-static\"><span class=\"xml_pe\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span><br/><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">xs:schema</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">xmlns:xs</span><span class=\"keyword operator\">=</span><span class=\"string\">\"http://www.w3.org/2001/XMLSchema\"</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">attributeFormDefault</span><span class=\"keyword operator\">=</span><span class=\"string\">\"unqualified\"</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">elementFormDefault</span><span class=\"keyword operator\">=</span><span class=\"string\">\"qualified\"</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">targetNamespace</span><span class=\"keyword operator\">=</span><span class=\"string\">\"http://iptc.org/std/SportsML/2008-04-01/\"</span><span class=\"meta tag\">&gt;</span><br/><span class=\"text\">  </span><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">xs:element</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">xmlns:ns</span><span class=\"keyword operator\">=</span><span class=\"string\">\"http://iptc.org/std/SportsML/2008-04-01/\"</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">name</span><span class=\"keyword operator\">=</span><span class=\"string\">\"sports-content\"</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">type</span><span class=\"keyword operator\">=</span><span class=\"string\">\"ns:sports-contentType\"</span><span class=\"meta tag\">/&gt;</span><br/><span class=\"text\">  </span><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">xs:complexType</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">name</span><span class=\"keyword operator\">=</span><span class=\"string\">\"sports-contentType\"</span><span class=\"meta tag\">&gt;</span><br/><span class=\"text\">\t</span><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">xs:sequence</span><span class=\"meta tag\">&gt;</span><br/><span class=\"text\">  \t</span><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">xs:element</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">xmlns:ns</span><span class=\"keyword operator\">=</span><span class=\"string\">\"http://iptc.org/std/SportsML/2008-04-01/\"</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">type</span><span class=\"keyword operator\">=</span><span class=\"string\">\"ns:sports-metadataType\"</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">name</span><span class=\"keyword operator\">=</span><span class=\"string\">\"sports-metadata\"</span><span class=\"meta tag\">/&gt;</span><br/><span class=\"text\">  \t</span><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">xs:element</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">xmlns:ns</span><span class=\"keyword operator\">=</span><span class=\"string\">\"http://iptc.org/std/SportsML/2008-04-01/\"</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">type</span><span class=\"keyword operator\">=</span><span class=\"string\">\"ns:sports-eventType\"</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">name</span><span class=\"keyword operator\">=</span><span class=\"string\">\"sports-event\"</span><span class=\"meta tag\">/&gt;</span><br/><span class=\"text\">\t</span><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">xs:sequence</span><span class=\"meta tag\">&gt;</span><br/><span class=\"text\">  </span><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">xs:complexType</span><span class=\"meta tag\">&gt;</span><br/><span class=\"text\">  ...</span><br/><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">xs:schema</span><span class=\"meta tag\">&gt;</span></pre>\n<p>This sample provides quite a good start for somebody with relatively little XMLSchema experience to modify it for his uses.</p>\n<p>There are cases when the complete schema or parts of the schema is required inside the document it describes, like WSDL or XBRL. These cases require a deeper integration and knowledge of the domain.</p>\n<h2>Conclusion</h2>\n<p>As we&#8217;ve seen in the above examples, tools like inst2xsd and xsd2inst are quite useful in a variety of cases: when prototyping, while working with dynamic schemas, or in generating test samples.</p>\n<p>More detailed information is found in the <a href=\"/html/modules/zorba/data-processing/schema-tools\">documentation pages of the schema-tools module.</a></p>\n</div>\n</div>", "authors" : [  ], "tags" : [  ] }, { "title" : "Zorba 2.5, aka Dionysus", "id" : "/60028018460/zorba-25-aka-dionysus", "updated" : "Thu, 14 Jun 2012 00:00:00 -0400", "summary" : "The Zorba development team is pleased to announce the release of Zorba 2.5, codename Dionysus. The release is a major step forward in terms of new features, performance improvements, and bug fixes. It is available in our download section.", "content" : "<div class=\"entry-content\">\n<div>\n<p>The Zorba development team is pleased to announce the release of Zorba 2.5, codename <a href=\"http://en.wikipedia.org/wiki/Dionysus\">Dionysus</a>. The release is a major step forward in terms of new features, performance improvements, and bug fixes. It is available in our <a href=\"/html/download\">download section</a>.</p>\n<h2>Features</h2>\n<p>The main focus of this release has been to extend and improve Zorba&#8217;s language bindings. We have finally added support for the long requested <a href=\"/html/documentation/2.5.0/xqj\">XQJ binding - a standard Java interface</a>. Moreover, the existing language bindings for Ruby, Python, and PHP provide plenty of new classes and functions bringing their functionality very close to Zorba&#8217;s powerful C++ API.</p>\n<p>Additionally, Zorba comes with two new modules. The <a href=\"/html/modules/zorba/data-processing/schema-tools\">schema-tools module</a> contains function that allow generating XML schemas from sample data and vice versa. For example, this is extremely useful for generating data for unit or performance testing. The <a href=\"/html/modules/zorba/fulltext\">full-text module</a> provides access to a variety of full-text primitives such as tokenization, stemming, stop-word detection, and thesaurus lookup for plenty of languages. With this module, XQuery developers have easy means to examining and indexing their text-centric information.</p>\n<p>Last but not least, we added eight new XQuery 3.0 functions including fn:path, fn:environment-variables, and fn:unparsed-text.</p>\n<p>We will showcase some of the new features in upcoming blog entries over the next couple of weeks.</p>\n<h2>Performance Improvements &amp; Bug Fixes</h2>\n<p>On top of the new features, we have improved the performance of the compiler (e.g., when compiling recursive functions) and the runtime (e.g., the insertion of nodes into collections). Also, several functions, such as the file module&#8217;s read-text-lines function, have been enhanced to handle unlimited text streams while maintaining a low memory footprint.</p>\n<p>In addition, Zorba 2.5 contains more then 30 bug fixes spread across all parts of the system from XQuery modules, compiler, and runtime all the way down to the store. Please see our <a href=\"https://launchpadlibrarian.net/107506719/ChangeLog\">ChangeLog</a> for an exhaustive list.</p>\n<p>As always, we strongly appreciate your bug reports and your feedback. Until then: May the FLWOR be with you!</p>\n</div>\n</div>", "authors" : [  ], "tags" : [  ] }, { "title" : "XML Streaming with XQuery", "id" : "/60027975996/xml-streaming-with-xquery", "updated" : "Thu, 31 May 2012 00:00:00 -0400", "summary" : "Are you familiar with that awkward moment when you realize that fn:doc() is no good to deal with the 24 GB XML file you would like to process? Here’s a quick tip that will make you feel like an XML Rock Star.", "content" : "<div class=\"entry-content\">\n<div>\n<p>Are you familiar with that awkward moment when you realize that <em>fn:doc()</em> is no good to deal with the <a href=\"http://dumps.wikimedia.org/enwikibooks/20120520/\">24&#160;GB XML file</a> you would like to process? Here&#8217;s a quick tip that will make you feel like an <a href=\"http://www.youtube.com/watch?v=a8SNp_cQfrA\">XML Rock Star</a>.</p>\n\n<p><a href=\"http://www.zorba.io/documentation/latest/modules/zorba/data-converters/xml/?anchor=parse-2\">xml:parse()</a> is the Swiss army knife of XML parsing. This function provides the same parsing utilities from top notch XML libraries but in the XQuery userland: from DTD or XML Schema validation to XML entities and XIncludes subsitutions. It prevents you from doing unnecessary round-tripping between XQuery and other programming languages.</p>\n<p>Moreover, this function is especially convenient for parsing large documents or streams of data. For instance, in this <a href=\"http://www.zorba-xquery.com/html/demo#CGPfEyXKvDwDfgzek/VTOIAIrJ8=\">live example</a>, even tough we fetch a 700MB XML document via HTTP, Zorba only consumes the required resources to compute the result. So how does this work?</p>\n<p>Let&#8217;s dive in.</p>\n<p>We would like to parse a <a href=\"http://dumps.wikimedia.org/enwikibooks/20120520/\">dump of the English wikibooks</a> and create a timeline of all pages related to XQuery</p>\n<p>In a first step, we are reading a Wikibooks dataset (available at <a href=\"http://dumps.wikimedia.org/enwikibooks/\"><a href=\"http://dumps.wikimedia.org/enwikibooks\">http://dumps.wikimedia.org/enwikibooks</a></a>) from a file. The dataset used in the example is a database dump containing the metadata of all pages in order to get the creation date of each page (e.g. enwikibooks-20120520-pages-meta-history.xml). After this, we use <a href=\"http://www.zorba.io/documentation/latest/modules/zorba/data-converters/xml/?anchor=parse-2\">xml:parse()</a> to parse the string into XML fragments (i.e. the page elements in the dataset) and iterate over each such fragment.</p>\n<pre class=\"ace-static\"><span class=\"keyword\">import</span><span class=\"text\"> </span><span class=\"keyword\">module</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">file</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://expath.org/ns/file\"</span><span class=\"text\">;</span><br/><span class=\"keyword\">import</span><span class=\"text\"> </span><span class=\"keyword\">module</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">p</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://zorba.io/modules/xml\"</span><span class=\"text\">;</span><br/><br/><span class=\"keyword\">import</span><span class=\"text\"> </span><span class=\"keyword\">schema</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">opt</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://zorba.io/modules/xml-options\"</span><span class=\"text\">;</span><br/><br/><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$raw-data</span><span class=\"text\"> </span><span class=\"keyword\">as</span><span class=\"text\"> </span><span class=\"identifier\">xs</span><span class=\"text\">:</span><span class=\"identifier\">string</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"support function\">file:read-text</span><span class=\"lparen\">(</span><span class=\"string\">\"enwikibooks-20120520-pages-meta-history.xml\"</span><span class=\"rparen\">)</span><br/><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$pages</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"support function\">p:parse</span><span class=\"lparen\">(</span><span class=\"variable\">$raw-data</span><span class=\"text\">, &lt;</span><span class=\"meta tag\">opt:options</span><span class=\"text\">&gt;</span><br/><span class=\"text\">                                   &lt;</span><span class=\"meta tag\">opt:parse-external-parsed-entity</span><span class=\"text\"> </span><span class=\"meta tag\">opt:skip-root-nodes</span><span class=\"text\">=</span><span class=\"string\">\"1\"</span><span class=\"text\">/&gt;</span><br/><span class=\"text\">                                 &lt;/</span><span class=\"meta tag\">opt:options</span><span class=\"text\">&gt;</span><span class=\"rparen\">)</span><br/><span class=\"keyword\">for</span><span class=\"text\"> </span><span class=\"variable\">$page</span><span class=\"text\"> </span><span class=\"keyword\">in</span><span class=\"text\"> </span><span class=\"variable\">$pages</span><br/><span class=\"keyword\">return</span><br/><span class=\"text\"> </span><span class=\"variable\">$page</span></pre>\n<p>In the code snippet above, it&#8217;s important to note that the execution happens in a streaming manner from top to bottom. First, the string returned by <em>file:read-text()</em> is streamed and never entirely materialized in memory. That is, the 24GB of raw data will never be loaded into memory at once. Second, we ask the XML parser to only return the children of the document&#8217;s root element as a sequence of elements. This is done using the <em>\"&lt;opt:parse-external-parsed-entity opt:skip-root-nodes=\"1\"/&gt;\"</em> option. It makes sure that the entire document is never materialized in memory and the resulting sequence of elements can be processed in a streaming fashion.</p>\n<p>Once this is done, generating the timeline is a piece of cake. We select only the pages whose title starts with XQuery. For each XQuery page, we compute the creation date of the first revision of that page. The full query is available below.</p>\n<pre class=\"ace-static\"><span class=\"keyword\">import</span><span class=\"text\"> </span><span class=\"keyword\">module</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">file</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://expath.org/ns/file\"</span><span class=\"text\">;</span><br/><span class=\"keyword\">import</span><span class=\"text\"> </span><span class=\"keyword\">module</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">p</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://zorba.io/modules/xml\"</span><span class=\"text\">;</span><br/><br/><span class=\"keyword\">import</span><span class=\"text\"> </span><span class=\"keyword\">schema</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">opt</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://zorba.io/modules/xml-options\"</span><span class=\"text\">;</span><br/><br/><span class=\"keyword\">declare</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">w</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://www.mediawiki.org/xml/export-0.6/\"</span><span class=\"text\">;</span><br/><br/><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$raw-data</span><span class=\"text\"> </span><span class=\"keyword\">as</span><span class=\"text\"> </span><span class=\"identifier\">xs</span><span class=\"text\">:</span><span class=\"identifier\">string</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"support function\">file:read-text</span><span class=\"lparen\">(</span><span class=\"string\">\"enwikibooks-20120520-pages-meta-history.xml\"</span><span class=\"rparen\">)</span><br/><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$pages</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"support function\">p:parse</span><span class=\"lparen\">(</span><span class=\"variable\">$raw-data</span><span class=\"text\">, &lt;</span><span class=\"meta tag\">opt:options</span><span class=\"text\">&gt;</span><br/><span class=\"text\">                                   &lt;</span><span class=\"meta tag\">opt:parse-external-parsed-entity</span><span class=\"text\"> </span><span class=\"meta tag\">opt:skip-root-nodes</span><span class=\"text\">=</span><span class=\"string\">\"1\"</span><span class=\"text\">/&gt;</span><br/><span class=\"text\">                                 &lt;/</span><span class=\"meta tag\">opt:options</span><span class=\"text\">&gt;</span><span class=\"rparen\">)</span><br/><span class=\"keyword\">for</span><span class=\"text\"> </span><span class=\"variable\">$page</span><span class=\"text\"> </span><span class=\"keyword\">in</span><span class=\"text\"> </span><span class=\"variable\">$pages</span><br/><span class=\"keyword\">where</span><span class=\"text\"> </span><span class=\"support function\">starts-with</span><span class=\"lparen\">(</span><span class=\"variable\">$page</span><span class=\"text\">/</span><span class=\"identifier\">w</span><span class=\"text\">:</span><span class=\"identifier\">title</span><span class=\"text\">, </span><span class=\"string\">\"XQuery\"</span><span class=\"rparen\">)</span><br/><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$title</span><span class=\"text\">          :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"variable\">$page</span><span class=\"text\">/</span><span class=\"identifier\">w</span><span class=\"text\">:</span><span class=\"identifier\">title</span><span class=\"text\">/</span><span class=\"support function\">text</span><span class=\"lparen\">(</span><span class=\"rparen\">)</span><br/><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$creation-date</span><span class=\"text\">  :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"support function\">min</span><span class=\"lparen\">(</span><span class=\"variable\">$page</span><span class=\"text\">/</span><span class=\"identifier\">w</span><span class=\"text\">:</span><span class=\"identifier\">revision</span><span class=\"text\">/</span><span class=\"identifier\">w</span><span class=\"text\">:</span><span class=\"identifier\">timestamp</span><span class=\"text\">/</span><span class=\"support function\">xs:dateTime</span><span class=\"lparen\">(</span><span class=\"text\">.</span><span class=\"rparen\">)</span><span class=\"rparen\">)</span><br/><span class=\"keyword\">return</span><br/><span class=\"text\">&lt;</span><span class=\"meta tag\">page</span><span class=\"text\"> </span><span class=\"meta tag\">title</span><span class=\"text\">=</span><span class=\"string\">\"{$title}\"</span><span class=\"text\"> </span><span class=\"meta tag\">date</span><span class=\"text\">=</span><span class=\"string\">\"{$creation-date}\"</span><span class=\"text\"> /&gt;</span></pre>\n<p>Pretty simple, no?</p>\n<p><em>xml:parse()</em> is to XML what <a href=\"http://www.zorba-xquery.com/documentation/latest/modules/zorba/languages/xqxq\">XQXQ</a> is to XQuery. We are looking to provide a rich programming experience that will enable developers to stay in the XQuery userland and avoid unnecessary roundtrips between XQuery and another technology.</p>\n<p>Traditional XML streaming APIs such as XMLReader or SAX provide very good performance but have extremely low productivity. From this perspective, <em>xml:parse()</em> is quite an interesting function because it does not give up on anything. This function provides steady performance and is 100% bound to the XQuery processing model.</p>\n<img alt=\"xml:parse() vs fn:doc() vs XMLReader/SAX\" src=\"/images/blog/xml-parse.png\"/><p>We hope that you will take <em>xml:parse()</em> for a ride and send us feedback. And as always, may the FLWOR be with you! ;-)</p>\n</div>\n</div>", "authors" : [  ], "tags" : [  ] }, { "title" : "Caching Results of Functions", "id" : "/60027902618/caching-results-of-functions", "updated" : "Mon, 16 Apr 2012 00:00:00 -0400", "summary" : "Caching of function results may improve performance if computationally expensive functions are invoked multiple times with the same arguments.\n\n  If the optimization level is O1 or higher, Zorba automatically caches results of recursive, deterministic, and non-sequential functions whose parameter and return types are subtypes of xs:anyAtomicType. Specifically, if such a function is called more than once with the same arguments, the result of the first call will be cached and subsequent calls will return the cached value without re-evaluating the function.", "content" : "<div class=\"entry-content\">\n<div>\n<p>Caching of function results may improve performance if computationally expensive functions are invoked multiple times with the same arguments.</p>\n<p>If the optimization level is <a href=\"http://www.zorba-xquery.com/html/documentation/2.1.0/cxx/structZorba__CompilerHints\">O1 or higher</a>, Zorba automatically caches results of recursive, deterministic, and non-sequential functions whose parameter and return types are subtypes of <em>xs:anyAtomicType</em>. Specifically, if such a function is called more than once with the same arguments, the result of the first call will be cached and subsequent calls will return the cached value without re-evaluating the function.</p>\n<p>For example, in the following recursive function computing a fibonacci number, each result is automatically cached and therefore performance dramatically improves.</p>\n<pre class=\"ace-static\"><span class=\"keyword\">declare</span><span class=\"text\"> </span><span class=\"keyword\">function</span><span class=\"text\"> </span><span class=\"support function\">local:fib</span><span class=\"lparen\">(</span><span class=\"variable\">$n</span><span class=\"text\"> </span><span class=\"keyword\">as</span><span class=\"text\"> </span><span class=\"identifier\">xs</span><span class=\"text\">:</span><span class=\"identifier\">integer</span><span class=\"rparen\">)</span><span class=\"text\"> </span><span class=\"keyword\">as</span><span class=\"text\"> </span><span class=\"identifier\">xs</span><span class=\"text\">:</span><span class=\"identifier\">integer</span><br/><span class=\"lparen\">{</span><br/><span class=\"text\"> </span><span class=\"keyword\">if</span><span class=\"text\"> </span><span class=\"lparen\">(</span><span class=\"variable\">$n</span><span class=\"text\"> </span><span class=\"keyword\">eq</span><span class=\"text\"> </span><span class=\"constant\">0</span><span class=\"rparen\">)</span><span class=\"text\"> </span><span class=\"keyword\">then</span><span class=\"text\"> </span><span class=\"constant\">0</span><br/><span class=\"text\"> </span><span class=\"keyword\">else</span><span class=\"text\"> </span><span class=\"keyword\">if</span><span class=\"text\"> </span><span class=\"lparen\">(</span><span class=\"variable\">$n</span><span class=\"text\"> </span><span class=\"keyword\">eq</span><span class=\"text\"> </span><span class=\"constant\">1</span><span class=\"rparen\">)</span><span class=\"text\"> </span><span class=\"keyword\">then</span><span class=\"text\"> </span><span class=\"constant\">1</span><br/><span class=\"text\"> </span><span class=\"keyword\">else</span><span class=\"text\"> </span><span class=\"support function\">local:fib</span><span class=\"lparen\">(</span><span class=\"variable\">$n</span><span class=\"text\"> </span><span class=\"keyword operator\">-</span><span class=\"text\"> </span><span class=\"constant\">1</span><span class=\"rparen\">)</span><span class=\"text\"> </span><span class=\"keyword operator\">+</span><span class=\"text\"> </span><span class=\"support function\">local:fib</span><span class=\"lparen\">(</span><span class=\"variable\">$n</span><span class=\"text\"> </span><span class=\"keyword operator\">-</span><span class=\"text\"> </span><span class=\"constant\">2</span><span class=\"rparen\">)</span><br/><span class=\"rparen\">}</span><span class=\"text\">;</span><br/><br/><span class=\"support function\">local:fib</span><span class=\"lparen\">(</span><span class=\"constant\">90</span><span class=\"rparen\">)</span></pre>\n<p>In order to disable function caching explicitly, the user can specify the no-cache annotation:</p>\n<pre class=\"ace-static\"><span class=\"keyword\">declare</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">an</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://www.zorba-xquery.com/annotations\"</span><span class=\"text\">;</span><br/><br/><span class=\"keyword\">declare</span><span class=\"text\"> %</span><span class=\"identifier\">an</span><span class=\"text\">:</span><span class=\"identifier\">no</span><span class=\"keyword operator\">-</span><span class=\"identifier\">cache</span><span class=\"text\"> </span><span class=\"keyword\">function</span><span class=\"text\"> </span><span class=\"support function\">local:fib</span><span class=\"lparen\">(</span><span class=\"variable\">$n</span><span class=\"text\"> </span><span class=\"keyword\">as</span><span class=\"text\"> </span><span class=\"identifier\">xs</span><span class=\"text\">:</span><span class=\"identifier\">integer</span><span class=\"rparen\">)</span><span class=\"text\"> </span><span class=\"keyword\">as</span><span class=\"text\"> </span><span class=\"identifier\">xs</span><span class=\"text\">:</span><span class=\"identifier\">integer</span><span class=\"text\"> </span><span class=\"lparen\">{</span><span class=\"text\"> ... </span><span class=\"rparen\">}</span><span class=\"text\">;</span></pre>\n<p>In the above example with caching, the complexity of the function is reduced from <em>O(1.6<sup><small>n</small></sup>)</em> to <em>O(n)</em>. Just to give you an impression about the difference in raw execution time: The query with caching gives the result in a couple of milliseconds whereas the query without caching virtually never finishes. Also, executing the query with several other XQuery processors didn&#8217;t give a result within a reasonable amount of time.</p>\n<p>This powerful optimization is possible because of Zorba&#8217;s classification of functions into simple, nondeterministic, and sequential. While the results of simple functions can be cached without changing the semantics of the query, the result of nondeterministic or sequential functions can not be cached. For example, if the result of a sequential function that sends an HTTP POST request (using the http-client module) were cached, the HTTP request would be made only once - which is not what the user expected. Similarly, the result of a nondeterministic function (e.g., one returning random numbers) can not be cached without changing the semantics of the query.</p>\n<p>In addition to automatic caching, the user may use the cache annotation to enforce caching of functions whose result would not have been automatically cached. However, this only works if the function is not updating and its parameter and return types are subtypes of xs:anyAtomicType; otherwise, Zorba will raise a warning (<em>zwarn:ZWST0005</em>) and ignore the cache annotation.</p>\n<p>Please note that for reasons already given above, explicitly enforcing caching for sequential or nondeterministic functions might not give the intended result. In such cases, Zorba will raise a warning (<em>zwarn:ZWST0006</em>) but still obey the cache annotation.</p>\n</div>\n</div>", "authors" : [  ], "tags" : [  ] }, { "title" : "JSON Streaming with XQuery", "id" : "/60027825488/json-streaming-with-xquery", "updated" : "Fri, 30 Mar 2012 00:00:00 -0400", "summary" : "Zorba 2.2 significantly improves the processing of XML, JSON, and textual streams. In this post, we would like to showcase how XQuery can be leveraged to build applications on top of the Twitter Streaming API.", "content" : "<div class=\"entry-content\">\n<div>\n<p><img alt=\"image\" src=\"/images/blog/googleearth.png\"/><a href=\"http://www.zorba-xquery.com/html/entry/2012/03/22/Zorba_22\">Zorba 2.2</a> significantly improves the processing of XML, JSON, and textual streams. In this post, we would like to showcase how XQuery can be leveraged to build applications on top of the <a href=\"https://dev.twitter.com/docs/streaming-api\">Twitter Streaming API</a>.</p>\n<h2>The Application</h2>\n<p>The application we would like to build is fairly trivial. First, we fetch a stream of public statuses from Twitter (aka tweets). Each tweet is parsed as JSON. If the tweet is geo-tagged, we transform it into a <a href=\"https://developers.google.com/kml/documentation/kml_tut#placemarks\">KML placemark</a>. Finally, we store the tweets into a KML document.</p>\n<p>To keep the KML document fresh with the latest tweets, we will overwrite it every time an arbitrary number of tweets have been processed. To visualize the Twitter updates with Google earth, we will create a <a href=\"https://developers.google.com/kml/documentation/kml_tut#network_links\">KML Network Link</a> that points to the KML document updated by Zorba.</p>\n<p>Let&#8217;s dive in.</p>\n<h2>The Tweets</h2>\n<p>First things first: we fetch a stream of tweets from Twitter.</p>\n<p>We will use the <a href=\"https://dev.twitter.com/docs/streaming-api/methods\">statuses/sample</a> method from the Twitter Streaming API. This method returns a random sample of tweets. Since this method is returning a stream, the connection between the client and the server will virtually never end.</p>\n<p>The good news is that <a href=\"http://www.zorba-xquery.com/html/modules/expath/http-client\">EXPath HTTP Client implementation in Zorba</a> streams HTTP responses. This is particularly well suited to process large amount of data efficiently that are returned from an HTTP server. This feature is also a savior in this particular application scenario since the HTTP response we would like to process is never-ending.</p>\n<p>Let&#8217;s go ahead and write a small query that fetches the stream of tweets. We ask the HTTP client to serialize the HTTP response as text by using the attribute <em>override-media-type=&#8221;text/plain&#8221;</em>.</p>\n<pre class=\"ace-static\"><span class=\"keyword\">import</span><span class=\"text\"> </span><span class=\"keyword\">module</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">http</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://expath.org/ns/http-client\"</span><span class=\"text\">;</span><br/><br/><span class=\"support function\">http:send-request</span><span class=\"lparen\">(</span><br/><span class=\"text\">  &lt;</span><span class=\"meta tag\">http:request</span><span class=\"text\"> </span><span class=\"meta tag\">href</span><span class=\"text\">=</span><span class=\"string\">\"https://stream.twitter.com/1/statuses/sample.json\"</span><br/><span class=\"text\">                </span><span class=\"meta tag\">method</span><span class=\"text\">=</span><span class=\"string\">\"GET\"</span><br/><span class=\"text\">                </span><span class=\"meta tag\">username</span><span class=\"text\">=</span><span class=\"string\">\"xqueryblog\"</span><br/><span class=\"text\">                </span><span class=\"meta tag\">password</span><span class=\"text\">=</span><span class=\"string\">\"1qaz2w\"</span><br/><span class=\"text\">                </span><span class=\"meta tag\">override-media-type</span><span class=\"text\">=</span><span class=\"string\">\"text/plain\"</span><br/><span class=\"text\">  /&gt;</span><span class=\"rparen\">)</span></pre>\n<p>If you execute this query, you will notice that the HTTP response from the <em>send-request()</em> function is already being serialized even thought the HTTP connection is not closed yet. Pretty cool, no?</p>\n<p>At this point, we want to transform the stream into a sequence of tweets. By default, the Twitter API delimits each JSON objects with a carriage return character (<em>&amp;#13;</em>). Zorba provides a <a href=\"http://www.zorba-xquery.com/html/modules/zorba/xdm/atomic/string#split-2\">split()</a> function to return a sequence of strings from an input. This function is similar to <em>fn:tokenize()</em> but doesn&#8217;t use a regular expression as a separator. This restriction makes it easier to split large/infinite strings in a streaming manner.</p>\n<p>In the code snippet below, we split the response for each tweet and parse its JSON representation using the <a href=\"http://www.zorba-xquery.com/html/modules/zorba/data-converters/json\">JSON module</a>.</p>\n<pre class=\"ace-static\"><span class=\"keyword\">import</span><span class=\"text\"> </span><span class=\"keyword\">module</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">http</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://expath.org/ns/http-client\"</span><span class=\"text\">;</span><br/><br/><span class=\"keyword\">import</span><span class=\"text\"> </span><span class=\"keyword\">module</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">string</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://www.zorba-xquery.com/modules/string\"</span><span class=\"text\">;</span><br/><span class=\"keyword\">import</span><span class=\"text\"> </span><span class=\"keyword\">module</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"keyword\">json</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://www.zorba-xquery.com/modules/converters/json\"</span><span class=\"text\">;</span><br/><span class=\"text\">                </span><br/><span class=\"keyword\">declare</span><span class=\"text\"> </span><span class=\"keyword\">namespace</span><span class=\"text\"> </span><span class=\"identifier\">j</span><span class=\"text\">   </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"http://john.snelson.org.uk/parsing-json-into-xquery\"</span><span class=\"text\">;</span><br/><br/><span class=\"keyword\">declare</span><span class=\"text\"> </span><span class=\"keyword\">function</span><span class=\"text\"> </span><span class=\"support function\">local:parse-tweets</span><span class=\"lparen\">(</span><span class=\"variable\">$stream</span><span class=\"text\"> </span><span class=\"keyword\">as</span><span class=\"text\"> </span><span class=\"identifier\">xs</span><span class=\"text\">:</span><span class=\"identifier\">string</span><span class=\"rparen\">)</span><span class=\"text\"> </span><span class=\"keyword\">as</span><span class=\"text\"> </span><span class=\"support function\">element</span><span class=\"lparen\">(</span><span class=\"identifier\">j</span><span class=\"text\">:</span><span class=\"keyword\">json</span><span class=\"rparen\">)</span><span class=\"keyword operator\">*</span><br/><span class=\"lparen\">{</span><br/><span class=\"text\">  </span><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$raw-tweets</span><span class=\"text\"> </span><span class=\"keyword\">as</span><span class=\"text\"> </span><span class=\"identifier\">xs</span><span class=\"text\">:</span><span class=\"identifier\">string</span><span class=\"keyword operator\">*</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"support function\">string:split</span><span class=\"lparen\">(</span><span class=\"variable\">$stream</span><span class=\"text\">, </span><span class=\"string\">\"&amp;#13;\"</span><span class=\"rparen\">)</span><br/><span class=\"text\">  </span><span class=\"keyword\">for</span><span class=\"text\"> </span><span class=\"variable\">$raw-tweet</span><span class=\"text\"> </span><span class=\"keyword\">in</span><span class=\"text\"> </span><span class=\"variable\">$raw-tweets</span><br/><span class=\"text\">  </span><span class=\"keyword\">return</span><span class=\"text\">  </span><span class=\"support function\">json:parse</span><span class=\"lparen\">(</span><span class=\"variable\">$raw-tweet</span><span class=\"rparen\">)</span><br/><span class=\"rparen\">}</span><span class=\"text\">;      </span><br/><br/><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$stream</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><br/><span class=\"text\">  </span><span class=\"support function\">http:send-request</span><span class=\"lparen\">(</span><br/><span class=\"text\">    &lt;</span><span class=\"meta tag\">http:request</span><span class=\"text\"> </span><span class=\"meta tag\">href</span><span class=\"text\">=</span><span class=\"string\">\"https://stream.twitter.com/1/statuses/sample.json\"</span><br/><span class=\"text\">                  </span><span class=\"meta tag\">method</span><span class=\"text\">=</span><span class=\"string\">\"GET\"</span><br/><span class=\"text\">                  </span><span class=\"meta tag\">username</span><span class=\"text\">=</span><span class=\"string\">\"xqueryblog\"</span><br/><span class=\"text\">                  </span><span class=\"meta tag\">password</span><span class=\"text\">=</span><span class=\"string\">\"1qaz2w\"</span><br/><span class=\"text\">                  </span><span class=\"meta tag\">override-media-type</span><span class=\"text\">=</span><span class=\"string\">\"text/plain\"</span><br/><span class=\"text\">  /&gt;</span><span class=\"rparen\">)</span><span class=\"lparen\">[</span><span class=\"constant\">2</span><span class=\"rparen\">]</span><br/><span class=\"keyword\">return</span><br/><span class=\"support function\">local:parse-tweets</span><span class=\"lparen\">(</span><span class=\"variable\">$stream</span><span class=\"rparen\">)</span></pre>\n<p>In the query above, the predicate <em>[2]</em> means that we are only interested by the HTTP response body. The HTTP response status code and headers are available in the first item of the function result. Examples on how to use the EXPath HTTP client are available in the<a href=\"http://www.zorba-xquery.com/html/demo\">Zorba live demo</a> interface.</p>\n<p>Some tweets contain unicode characters that are not supported in XML 1.0. Therefore, you should run the query above by setting the version parameter from the XML serialization to 1.1:</p>\n<pre class=\"ace-static\">$zorba -q streaming-example.xq -f -i -z version=\"1.1\"</pre>\n<h2>The Placemarks</h2>\n<p>The next step is to transform each tweet into a KML placemark. As you can see in the code snippet below, this is a pretty straightforward operation.</p>\n<pre class=\"ace-static\"><span class=\"keyword\">declare</span><span class=\"text\"> </span><span class=\"keyword\">function</span><span class=\"text\"> </span><span class=\"support function\">local:placemark</span><span class=\"lparen\">(</span><span class=\"variable\">$json</span><span class=\"text\"> </span><span class=\"keyword\">as</span><span class=\"text\"> </span><span class=\"support function\">element</span><span class=\"lparen\">(</span><span class=\"identifier\">j</span><span class=\"text\">:</span><span class=\"keyword\">json</span><span class=\"rparen\">)</span><span class=\"rparen\">)</span><br/><span class=\"lparen\">{</span><br/><span class=\"text\">  </span><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$coordinates</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"variable\">$json</span><span class=\"text\">/</span><span class=\"identifier\">j</span><span class=\"text\">:</span><span class=\"identifier\">pair</span><span class=\"lparen\">[</span><span class=\"text\">@</span><span class=\"identifier\">name</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"coordinates\"</span><span class=\"rparen\">]</span><span class=\"text\">/</span><span class=\"identifier\">j</span><span class=\"text\">:</span><span class=\"identifier\">pair</span><span class=\"lparen\">[</span><span class=\"text\">@</span><span class=\"identifier\">name</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"coordinates\"</span><span class=\"rparen\">]</span><span class=\"text\">/</span><span class=\"identifier\">j</span><span class=\"text\">:</span><span class=\"keyword\">item</span><br/><span class=\"text\">  </span><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$lat</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"variable\">$coordinates</span><span class=\"lparen\">[</span><span class=\"constant\">1</span><span class=\"rparen\">]</span><span class=\"text\">/</span><span class=\"support function\">text</span><span class=\"lparen\">(</span><span class=\"rparen\">)</span><br/><span class=\"text\">  </span><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$long</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"variable\">$coordinates</span><span class=\"lparen\">[</span><span class=\"constant\">2</span><span class=\"rparen\">]</span><span class=\"text\">/</span><span class=\"support function\">text</span><span class=\"lparen\">(</span><span class=\"rparen\">)</span><br/><span class=\"text\">  </span><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$coordinates</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"variable\">$lat</span><span class=\"text\"> || </span><span class=\"string\">\", \"</span><span class=\"text\"> || </span><span class=\"variable\">$long</span><span class=\"text\"> || </span><span class=\"string\">\", 0\"</span><br/><span class=\"text\">  </span><span class=\"keyword\">return</span><br/><span class=\"text\">  &lt;</span><span class=\"meta tag\">Placemark</span><span class=\"text\"> </span><span class=\"meta tag\">xmlns</span><span class=\"text\">=</span><span class=\"string\">\"http://www.opengis.net/kml/2.2\"</span><span class=\"text\">&gt;</span><br/><span class=\"text\">    &lt;</span><span class=\"meta tag\">name</span><span class=\"text\">&gt;</span><span class=\"lparen\">{</span><span class=\"variable\">$json</span><span class=\"text\">//</span><span class=\"identifier\">j</span><span class=\"text\">:</span><span class=\"identifier\">pair</span><span class=\"lparen\">[</span><span class=\"text\">@</span><span class=\"identifier\">name</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"name\"</span><span class=\"rparen\">]</span><span class=\"text\">/</span><span class=\"support function\">text</span><span class=\"lparen\">(</span><span class=\"rparen\">)</span><span class=\"rparen\">}</span><span class=\"text\">&lt;/</span><span class=\"meta tag\">name</span><span class=\"text\">&gt;</span><br/><span class=\"text\">    &lt;</span><span class=\"meta tag\">visibility</span><span class=\"text\">&gt;</span><span class=\"constant\">1</span><span class=\"text\">&lt;/</span><span class=\"meta tag\">visibility</span><span class=\"text\">&gt;</span><br/><span class=\"text\">    &lt;</span><span class=\"meta tag\">description</span><span class=\"text\">&gt;</span><span class=\"lparen\">{</span><span class=\"variable\">$json</span><span class=\"text\">/</span><span class=\"identifier\">j</span><span class=\"text\">:</span><span class=\"identifier\">pair</span><span class=\"lparen\">[</span><span class=\"text\">@</span><span class=\"identifier\">name</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"text\"</span><span class=\"rparen\">]</span><span class=\"text\">/</span><span class=\"support function\">text</span><span class=\"lparen\">(</span><span class=\"rparen\">)</span><span class=\"rparen\">}</span><span class=\"text\">&lt;/</span><span class=\"meta tag\">description</span><span class=\"text\">&gt;</span><br/><span class=\"text\">    &lt;</span><span class=\"meta tag\">Style</span><span class=\"text\">&gt;</span><br/><span class=\"text\">      &lt;</span><span class=\"meta tag\">IconStyle</span><span class=\"text\">&gt;</span><br/><span class=\"text\">        &lt;</span><span class=\"meta tag\">scale</span><span class=\"text\">&gt;</span><span class=\"constant\">2</span><span class=\"text\">&lt;/</span><span class=\"meta tag\">scale</span><span class=\"text\">&gt;</span><br/><span class=\"text\">        &lt;</span><span class=\"meta tag\">Icon</span><span class=\"text\">&gt;</span><br/><span class=\"text\">          &lt;</span><span class=\"meta tag\">href</span><span class=\"text\">&gt;</span><span class=\"lparen\">{</span><span class=\"variable\">$json</span><span class=\"text\">//</span><span class=\"identifier\">j</span><span class=\"text\">:</span><span class=\"identifier\">pair</span><span class=\"lparen\">[</span><span class=\"text\">@</span><span class=\"identifier\">name</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"profile_image_url\"</span><span class=\"rparen\">]</span><span class=\"text\">/</span><span class=\"support function\">text</span><span class=\"lparen\">(</span><span class=\"rparen\">)</span><span class=\"rparen\">}</span><span class=\"text\">&lt;/</span><span class=\"meta tag\">href</span><span class=\"text\">&gt;</span><br/><span class=\"text\">        &lt;/</span><span class=\"meta tag\">Icon</span><span class=\"text\">&gt;</span><br/><span class=\"text\">      &lt;/</span><span class=\"meta tag\">IconStyle</span><span class=\"text\">&gt;</span><br/><span class=\"text\">      &lt;</span><span class=\"meta tag\">LabelStyle</span><span class=\"text\">&gt;&lt;</span><span class=\"meta tag\">scale</span><span class=\"text\">&gt;</span><span class=\"constant\">1</span><span class=\"text\">&lt;/</span><span class=\"meta tag\">scale</span><span class=\"text\">&gt;&lt;/</span><span class=\"meta tag\">LabelStyle</span><span class=\"text\">&gt;</span><br/><span class=\"text\">    &lt;/</span><span class=\"meta tag\">Style</span><span class=\"text\">&gt;</span><br/><span class=\"text\">    &lt;</span><span class=\"meta tag\">Point</span><span class=\"text\">&gt;</span><br/><span class=\"text\">      &lt;</span><span class=\"meta tag\">extrude</span><span class=\"text\">&gt;</span><span class=\"constant\">0</span><span class=\"text\">&lt;/</span><span class=\"meta tag\">extrude</span><span class=\"text\">&gt;</span><br/><span class=\"text\">      &lt;</span><span class=\"meta tag\">tessellate</span><span class=\"text\">&gt;</span><span class=\"constant\">1</span><span class=\"text\">&lt;/</span><span class=\"meta tag\">tessellate</span><span class=\"text\">&gt;</span><br/><span class=\"text\">      &lt;</span><span class=\"meta tag\">coordinates</span><span class=\"text\">&gt;</span><span class=\"lparen\">{</span><span class=\"variable\">$coordinates</span><span class=\"rparen\">}</span><span class=\"text\">&lt;/</span><span class=\"meta tag\">coordinates</span><span class=\"text\">&gt;</span><br/><span class=\"text\">    &lt;/</span><span class=\"meta tag\">Point</span><span class=\"text\">&gt;</span><br/><span class=\"text\">  &lt;/</span><span class=\"meta tag\">Placemark</span><span class=\"text\">&gt;</span><br/><span class=\"rparen\">}</span><span class=\"text\">;</span><br/><span class=\"text\">        </span></pre>\n<p>See <a href=\"http://bazaar.launchpad.net/~zorba-coders/zorba/demos/view/head:/twitter-streaming/example3.xq\">example3.xq</a> to use this function directly with the Twitter API.</p>\n<h2>Google Earth Integration</h2>\n<p>We&#8217;re almost there. To integrate with Google Earth, we need to add some scripting to our query. First, we define a function named<em>fetch-placemarks($limit)</em>. This function will fetch a certain number of tweets from Twitter and transform them into KML placemarks. The number of tweets to fetch is set by the <em>$limit</em> parameter. See the function definition below.</p>\n<pre class=\"ace-static\"><span class=\"keyword\">declare</span><span class=\"text\"> %</span><span class=\"identifier\">ann</span><span class=\"text\">:</span><span class=\"identifier\">sequential</span><span class=\"text\"> </span><span class=\"keyword\">function</span><span class=\"text\"> </span><span class=\"support function\">local:fetch-placemarks</span><span class=\"lparen\">(</span><span class=\"variable\">$limit</span><span class=\"text\"> </span><span class=\"keyword\">as</span><span class=\"text\"> </span><span class=\"identifier\">xs</span><span class=\"text\">:</span><span class=\"identifier\">integer</span><span class=\"rparen\">)</span><br/><span class=\"keyword\">as</span><span class=\"text\"> </span><span class=\"support function\">element</span><span class=\"lparen\">(</span><span class=\"identifier\">Placemark</span><span class=\"rparen\">)</span><span class=\"keyword operator\">*</span><br/><span class=\"lparen\">{</span><br/><span class=\"text\">  </span><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$stream</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><br/><span class=\"text\">    </span><span class=\"support function\">http:send-request</span><span class=\"lparen\">(</span><br/><span class=\"text\">      &lt;</span><span class=\"meta tag\">http:request</span><span class=\"text\"> </span><span class=\"meta tag\">href</span><span class=\"text\">=</span><span class=\"string\">\"https://stream.twitter.com/1/statuses/sample.json\"</span><br/><span class=\"text\">                    </span><span class=\"meta tag\">method</span><span class=\"text\">=</span><span class=\"string\">\"GET\"</span><br/><span class=\"text\">                    </span><span class=\"meta tag\">username</span><span class=\"text\">=</span><span class=\"string\">\"xqueryblog\"</span><br/><span class=\"text\">                    </span><span class=\"meta tag\">password</span><span class=\"text\">=</span><span class=\"string\">\"1qaz2w\"</span><br/><span class=\"text\">                    </span><span class=\"meta tag\">override-media-type</span><span class=\"text\">=</span><span class=\"string\">\"text/plain\"</span><br/><span class=\"text\">    /&gt;</span><span class=\"rparen\">)</span><span class=\"lparen\">[</span><span class=\"constant\">2</span><span class=\"rparen\">]</span><br/><span class=\"text\">  </span><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$tweets</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"support function\">local:parse-tweets</span><span class=\"lparen\">(</span><span class=\"variable\">$stream</span><span class=\"rparen\">)</span><br/><span class=\"text\">  </span><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$tweets</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"support function\">subsequence</span><span class=\"lparen\">(</span><span class=\"variable\">$tweets</span><span class=\"text\">, </span><span class=\"constant\">1</span><span class=\"text\">, </span><span class=\"variable\">$limit</span><span class=\"rparen\">)</span><br/><span class=\"text\">  </span><span class=\"keyword\">for</span><span class=\"text\"> </span><span class=\"variable\">$tweet</span><span class=\"text\"> </span><span class=\"keyword\">in</span><span class=\"text\"> </span><span class=\"variable\">$tweets</span><br/><span class=\"text\">  </span><span class=\"keyword\">where</span><span class=\"text\"> </span><span class=\"variable\">$tweet</span><span class=\"text\">/</span><span class=\"identifier\">j</span><span class=\"text\">:</span><span class=\"identifier\">pair</span><span class=\"lparen\">[</span><span class=\"text\">@</span><span class=\"identifier\">name</span><span class=\"text\"> </span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"coordinates\"</span><span class=\"rparen\">]</span><span class=\"text\">/@</span><span class=\"identifier\">type</span><span class=\"text\"> !</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"string\">\"null\"</span><span class=\"text\"> </span><br/><span class=\"text\">  </span><span class=\"keyword\">return</span><span class=\"text\"> </span><span class=\"support function\">local:placemark</span><span class=\"lparen\">(</span><span class=\"variable\">$tweet</span><span class=\"rparen\">)</span><br/><span class=\"rparen\">}</span><span class=\"text\">;</span></pre>\n<p>This function invokes <em>parse-tweets()</em> which is the exact same function that we declared previously. The main query expression an infinite loop to fetch the KML placemarks from a Twitter stream and store it into a KML document named <em>tweets.xml</em>. For each <em>while</em>iteration, the <em>tweets.xml</em> document will be refreshed with new content. This is done in the main query below.</p>\n<pre class=\"ace-static\"><span class=\"comment\">(:</span><span class=\"comment\"> XQuery 4ever :)</span><br/><span class=\"support function\">while</span><span class=\"lparen\">(</span><span class=\"support function\">true</span><span class=\"lparen\">(</span><span class=\"rparen\">)</span><span class=\"rparen\">)</span><span class=\"text\"> </span><span class=\"lparen\">{</span><br/><span class=\"text\">  </span><span class=\"support function\">trace</span><span class=\"lparen\">(</span><span class=\"string\">\"...\"</span><span class=\"text\">, </span><span class=\"string\">\"refresh KML document\"</span><span class=\"rparen\">)</span><span class=\"text\">;</span><br/><span class=\"text\">  </span><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$placemarks</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><span class=\"text\"> </span><span class=\"support function\">local:fetch-placemarks</span><span class=\"lparen\">(</span><span class=\"constant\">1000</span><span class=\"rparen\">)</span><br/><span class=\"text\">  </span><span class=\"keyword\">let</span><span class=\"text\"> </span><span class=\"variable\">$kml</span><span class=\"text\"> :</span><span class=\"keyword operator\">=</span><br/><span class=\"text\">   &lt;</span><span class=\"meta tag\">kml</span><span class=\"text\"> </span><span class=\"meta tag\">xmlns</span><span class=\"text\">=</span><span class=\"string\">\"http://www.opengis.net/kml/2.2\"</span><br/><span class=\"text\">         </span><span class=\"meta tag\">xmlns:atom</span><span class=\"text\">=</span><span class=\"string\">\"http://www.w3.org/2005/Atom\"</span><br/><span class=\"text\">         </span><span class=\"meta tag\">xmlns:gx</span><span class=\"text\">=</span><span class=\"string\">\"http://www.google.com/kml/ext/2.2\"</span><span class=\"text\">&gt;</span><br/><span class=\"text\">      &lt;</span><span class=\"meta tag\">Document</span><span class=\"text\">&gt;</span><br/><span class=\"text\">        &lt;</span><span class=\"meta tag\">name</span><span class=\"text\">&gt;</span><span class=\"identifier\">Tweets</span><span class=\"text\">&lt;/</span><span class=\"meta tag\">name</span><span class=\"text\">&gt;</span><br/><span class=\"text\">        &lt;</span><span class=\"meta tag\">visibility</span><span class=\"text\">&gt;</span><span class=\"constant\">1</span><span class=\"text\">&lt;/</span><span class=\"meta tag\">visibility</span><span class=\"text\">&gt;</span><br/><span class=\"text\">        &lt;</span><span class=\"meta tag\">Folder</span><span class=\"text\"> </span><span class=\"meta tag\">id</span><span class=\"text\">=</span><span class=\"string\">\"tweets\"</span><span class=\"text\">&gt;</span><br/><span class=\"text\">        </span><span class=\"lparen\">{</span><span class=\"variable\">$placemarks</span><span class=\"rparen\">}</span><br/><span class=\"text\">        &lt;/</span><span class=\"meta tag\">Folder</span><span class=\"text\">&gt;</span><br/><span class=\"text\">      &lt;/</span><span class=\"meta tag\">Document</span><span class=\"text\">&gt;</span><br/><span class=\"text\">   &lt;/</span><span class=\"meta tag\">kml</span><span class=\"text\">&gt;</span><br/><span class=\"text\">   </span><span class=\"keyword\">return</span><span class=\"text\"> </span><span class=\"support function\">file:write</span><span class=\"lparen\">(</span><span class=\"string\">\"tweets.kml\"</span><span class=\"text\">, </span><span class=\"variable\">$kml</span><span class=\"text\">, </span><span class=\"lparen\">(</span><span class=\"rparen\">)</span><span class=\"rparen\">)</span><span class=\"text\">;</span><br/><span class=\"rparen\">}</span></pre>\n<p>Notice that the main query invokes <em>fetch-placemarks()</em> which is the exact same function that we declared previously.</p>\n<p>Finally, we create <a href=\"https://developers.google.com/kml/documentation/kml_tut#network_links\">network link</a> that points to <em>tweets.xml</em>:</p>\n<pre class=\"ace-static\"><span class=\"xml_pe\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span><br/><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">kml</span><span class=\"text\"> </span><span class=\"entity other.attribute-name\">xmlns</span><span class=\"keyword operator\">=</span><span class=\"string\">\"http://www.opengis.net/kml/2.2\"</span><span class=\"meta tag\">&gt;</span><br/><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">NetworkLink</span><span class=\"meta tag\">&gt;</span><br/><span class=\"text\">  </span><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">name</span><span class=\"meta tag\">&gt;</span><span class=\"text\">Realtime Tweets</span><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">name</span><span class=\"meta tag\">&gt;</span><br/><span class=\"text\">  </span><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">Link</span><span class=\"meta tag\">&gt;</span><br/><span class=\"text\">    </span><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">href</span><span class=\"meta tag\">&gt;</span><span class=\"text\">file:///{PATH}/tweets.kml</span><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">href</span><span class=\"meta tag\">&gt;</span><br/><span class=\"text\">    </span><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">refreshMode</span><span class=\"meta tag\">&gt;</span><span class=\"text\">onInterval</span><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">refreshMode</span><span class=\"meta tag\">&gt;</span><br/><span class=\"text\">    </span><span class=\"meta tag\">&lt;</span><span class=\"meta tag.tag-name\">refreshInterval</span><span class=\"meta tag\">&gt;</span><span class=\"text\">5</span><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">refreshInterval</span><span class=\"meta tag\">&gt;</span><br/><span class=\"text\">  </span><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">Link</span><span class=\"meta tag\">&gt;</span><br/><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">NetworkLink</span><span class=\"meta tag\">&gt;</span><br/><span class=\"meta tag\">&lt;/</span><span class=\"meta tag.tag-name\">kml</span><span class=\"meta tag\">&gt;</span></pre>\n<p>Add the network link to Google Earth and that&#8217;s it &#8212; we&#8217;re done.</p>\n<img alt=\"image\" src=\"/images/blog/randomtweets.png\"/><br/><h2>Take-Away</h2>\n<p>The source code of this application is available on <a href=\"http://bazaar.launchpad.net/~zorba-coders/zorba/demos/files/head:/twitter-streaming/\">Launchpad</a>. We hope that you will put Zorba streaming capabilities to the test.</p>\n<p>If you are looking for more complex JSON processing with XQuery, you should checkout the <a href=\"http://www.zorba-xquery.com/html/jsoniq\">Zorba JSONiq development branch</a>.</p>\n</div>\n</div>", "authors" : [  ], "tags" : [  ] }, { "title" : "Zorba 2.2, aka Coeus", "id" : "/60027695561/zorba-22-aka-coeus", "updated" : "Thu, 01 Mar 2012 00:00:00 -0500", "summary" : "We are very excited to announce the release of Zorba 2.2, codename Coeus. It is available in our download section.", "content" : "<div class=\"entry-content\">\n<div>\n<p>We are very excited to announce the release of Zorba 2.2, codename <a href=\"http://en.wikipedia.org/wiki/Coeus\">Coeus</a>. It is available in our <a href=\"http://www.zorba-xquery.com/html/download\">download section</a>.</p>\n<p>So what&#8217;s new?</p>\n<h2>New features</h2>\n<p>First, we are introducing a new <a href=\"http://www.zorba-xquery.com/html/modules/zorba/xdm/atomic/uri\">module for decoding URIs</a>. Then we worked on several improvements to enable the processing of XML, JSON, and text in streaming manner. The new <a href=\"http://www.zorba-xquery.com/html/modules/zorba/data-converters/xml#parse-xml-fragment-2\">parse-xml-fragment()</a> function has been reworked to parse and process huge chunks of XML data as streams. The <a href=\"http://www.zorba-xquery.com/html/modules/zorba/data-converters/json\">JSON module</a> has been dramatically improved and is now able to parse and serialize streams of JSON documents. We are introducing a new <a href=\"http://www.zorba-xquery.com/html/modules/zorba/xdm/atomic/string#split-2\">split()</a> function to tokenize streamable strings. Finally, <a href=\"http://www.zorba-xquery.com/html/modules/expath/file#read-text-2\">file:read-text()</a> and <a href=\"http://www.zorba-xquery.com/html/modules/expath/http-client#send-request-1\">http:send-request()</a> are now supporting arbitrary text encodings.</p>\n<p>The ItemFactory from the <a href=\"http://www.zorba-xquery.com/html/documentation/2.2.0/cxx/classes\">Zorba C++ API</a> has been extended with methods: <a href=\"http://www.zorba-xquery.com/html/documentation/2.2.0/cxx/classzorba_1_1ItemFactory#a5ee4a08dc9d22cd45133f1306ccaa368\">createDayTimeDuration</a>, <a href=\"http://www.zorba-xquery.com/html/documentation/2.2.0/cxx/classzorba_1_1ItemFactory#ae2c0fdefd2515bed1a2ef479ac99883f\">createYearMonthDuration</a>,<a href=\"http://www.zorba-xquery.com/html/documentation/2.2.0/cxx/classzorba_1_1ItemFactory#ad67a518abfd2df801f5617ec2365fe1d\">createDocumentNode</a>, <a href=\"http://www.zorba-xquery.com/html/documentation/2.2.0/cxx/classzorba_1_1ItemFactory#a7f88edbf86f43e744fae61e3a7ca3a11\">createCommentNode</a>, and <a href=\"http://www.zorba-xquery.com/html/documentation/2.2.0/cxx/classzorba_1_1ItemFactory#ab3ebb9de0413dd8bf831e39c85d8632e\">createPiNode()</a>. Also the StaticContext contains two new methods: <a href=\"http://www.zorba-xquery.com/html/documentation/2.2.0/cxx/classzorba_1_1StaticContext#ac0d94cd0e4fb3f821a4273ecd9273253\">getFunctions()</a>and <a href=\"http://www.zorba-xquery.com/html/documentation/2.2.0/cxx/classzorba_1_1StaticContext#a7f7c934ef18c6e8f5153f4c1315a72b5\">getNamespaceBindings</a>.</p>\n<p>The new PHP interface that we <a href=\"http://www.zorba-xquery.com/html/entry/2011/12/27/PHP_Meets_XQuery\">introduced</a> in December is now shipped by default with Zorba and contains several improvements.</p>\n<p>Last but not least, you can forget about <em>fn:concat()</em> and use the <a href=\"http://www.w3.org/TR/xquery-30/#id-string-concat-expr\">XQuery 3.0 string concatenation expressions</a>.</p>\n<pre class=\"ace-static\"><span class=\"string\">\"Hello \"</span><span class=\"text\"> || </span><span class=\"string\">\"Zorba \"</span><span class=\"text\"> || </span><span class=\"string\">\"2.2\"</span></pre>\n<h2>Optimizations</h2>\n<p>Results of deterministic functions with atomic parameters and return types are cached by the runtime. This behavior can be controlled with the <em>%ann:cache</em> and <em>%ann:no-cache</em> annotations.</p>\n<p>Input nodes in nodes constructors are not copied systematically anymore. This behavior can be controlled with the <em>%ann:propagates-input-nodes</em> and <em>%ann:must-copy-input-nodes</em> annotations.</p>\n<p>Several performance improvements have been implemented: type operators, base64Binary processing, and other XQuery expressions.</p>\n<h2>Bug Reports</h2>\n<p>We pinned down more than thirty bug reports. You can find a comprehensive list of these bugs in our <a href=\"https://launchpadlibrarian.net/97678336/ChangeLog\">ChangeLog</a>.</p>\n<h2>That&#8217;s All Folks!</h2>\n<p>Please checkout the <a href=\"https://launchpadlibrarian.net/97678336/ChangeLog\">2.2 ChangeLog</a> for the complete list of changes in this new version of Zorba.</p>\n<p>During the upcoming weeks, we will go over some of these new features in more details and showcase how they can be leveraged in your applications.</p>\n<p>We are actively working on our next milestone, <a href=\"https://launchpad.net/zorba/+milestone/2.5\">Zorba 2.5 &#8220;Dionysus&#8221;</a>. Please keep us posted with <a href=\"https://bugs.launchpad.net/zorba\">bugs reports</a> and <a href=\"http://zorba.uservoice.com/forums/145664-what-should-we-work-on-next-\">feedback</a>. We strongly appreciate those.</p>\n<p>We hope you enjoy Zorba 2.2 and stay tuned for more.</p>\n<p>In the meantime, may the FLWOR be with you!</p>\n</div>\n</div>", "authors" : [  ], "tags" : [  ] }, { "title" : "Zorba @ FOSDEM", "id" : "/60027643315/zorba--fosdem", "updated" : "Thu, 01 Mar 2012 00:00:00 -0500", "summary" : "When you arrive in a room full of hackers decorated with 4chan memes, you know that you just landed at FOSDEM.", "content" : "<div class=\"entry-info\">\n<p>When you arrive in a room full of hackers decorated with <a href=\"http://www.zorba-xquery.com/images/blog/philosoraptor.jpg\">4chan memes</a>, you know that you just landed at <a href=\"http://fosdem.org/\">FOSDEM</a>.</p>\n</div>\n<div class=\"entry-content\">\n<p>FOSDEM is one of the biggest open source developer meetings in the world. For anyone interested in open source software development and Belgium beers, it is the place to be.</p>\n<p>We took advantage of the <a href=\"http://fosdem.org/2012/schedule/tracks/lightningtalks\">lightning talks sessions</a> to give a brief overview of the Zorba XQuery Processor.</p>\n<p>See video below.</p>\n<iframe frameborder=\"0\" height=\"315\" src=\"http://www.youtube.com/embed/M0WWfo8fusg\" width=\"420\"></iframe></div>", "authors" : [  ], "tags" : [  ] }, { "title" : "From XML Prague with Love", "id" : "/60027582262/from-xml-prague-with-love", "updated" : "Fri, 17 Feb 2012 00:00:00 -0500", "summary" : "XML & Prague. Does it get any better than this for angle brackets aficionados?\n  Every year, XML Prague is one of the most exciting events of the year for the Zorba development team.\n  And for the 2012 edition, the organisation committee pulled out all the stops.", "content" : "<div class=\"entry-content\">\n<p>XML &amp; Prague. Does it get any better than this for angle brackets aficionados?<br/>Every year, <a href=\"http://www.xmlprague.cz/\">XML Prague</a> is one of the most exciting events of the year for the Zorba development team.<br/>And for the 2012 edition, the organisation committee pulled out all the stops.</p>\n<p>Contributors to the Zorba project were attending the conference. From the left to the right: Rodolfo Ochoa (Oracle), Dennis Knochenwefel (28msec), David Graf (28msec), and Juan Zacarias (Oracle).</p>\n<p><img alt=\"image\" src=\"http://media.tumblr.com/527ccf1b6d3a3bc81ada62576491f262/tumblr_inline_mx6mr0HhSr1rjv2qx.jpg\"/></p>\n<p>It all began on Thursday, February 10th, with the <a href=\"http://www.xmlprague.cz/2012/pre-conference-friday.html\">The pre-conference day</a>. Various sessions were held with three XML databases on the menu: <a href=\"http://exist.sourceforge.net/\">eXist-db</a>, <a href=\"http://basex.org/\">BaseX</a>, and <a href=\"http://www.28msec.com/\">28msec</a>.</p>\n<p>Note that 28msec leverages Zorba to run queries and web applications entirely written in XQuery. In a nutshell, 28msec is putting Zorba to the Cloud and is backing it with a scalable store.</p>\n<p>The pre-conference day was just an appetizer for the main conference track on Saturday and Sunday. The videos of all the talks are available on the <a href=\"http://www.xmlprague.cz/2012/files/video-archive-1.html\">XML Prague TV archive</a>. XQuery was well represented with a couple of very interesting talks.</p>\n<p>First, Jonathan Robie and Michael Kay introduced us to the <a href=\"http://www.xmlprague.cz/2012/sessions.html#Whats-New-in-XPath/XSLT/XQuery-3.0-and-XML-Schema-1.1\">novelties in XQuery &amp; XSLT 3.0</a>.</p>\n<p><img alt=\"image\" src=\"http://media.tumblr.com/13939f58031a7f95a1308d1d6c87493a/tumblr_inline_mx6mrmxsAf1rjv2qx.jpg\"/></p>\n\n<p>Then Adam Retter presented an elegant set of <a href=\"http://www.xmlprague.cz/2012/sessions.html#RESTful-XQuery---Standardised-XQuery-3.0-Annotations-for-REST\">XQuery 3.0 annotations</a> to build RESTful XQuery applications.</p>\n<p><img alt=\"image\" src=\"http://media.tumblr.com/e51c819aef0e89a6105e56a793271138/tumblr_inline_mx6ms0YPP91rjv2qx.jpg\"/></p>\n\n<p>Finally, John Snelson showcased <a href=\"http://www.xmlprague.cz/2012/sessions.html#Transform.XQ-A-Transformation-Library-for-XQuery-3.0\">transform.xq</a> a pure XQuery 3.0 library that brings the template-matching paradigm from XSLT to XQuery developments.</p>\n\n<p><img alt=\"image\" src=\"http://media.tumblr.com/58be546a9fab066f8b8d041d32a1243c/tumblr_inline_mx6msfF82G1rjv2qx.jpg\"/></p>\n\n<p></p>\nThe different sessions gave a great insight on how the new features in XQuery 3.0 can be leveraged to build a new generation of XQuery applications.\n<p>The most disruptive talk during the conference was undoubtedly the introduction of <a href=\"http://jsoniq.org/\">JSONiq</a> by Jonathan Robie. JSONiq extends the XQuery Data Model with JSON entities. The project has two goals:</p>\n<ul><li>To provide the expertise and maturity of XQuery to JSON-oriented systems such as NoSQL databases.</li>\n<li>To provide first-class support for JSON to XQuery applications.</li>\n</ul><br/><p>Zorba implements JSONiq in <a href=\"https://code.launchpad.net/~zorba-coders/zorba/jsoniq\">a development branch</a>. You can try it live <a href=\"http://www.zorba-xquery.com/html/jsoniq\">here</a>.</p>\n<p><img alt=\"image\" src=\"http://media.tumblr.com/5822d76759ad117eec65f5687364cd97/tumblr_inline_mx6mt0lqwq1rjv2qx.jpg\"/></p>\n\n<p>An enormous Thank You to the XMLPrague organization comittee and to all speakers for such an inspiring weekend.<br/>Looking forward to the next edition.</p>\n</div>", "authors" : [  ], "tags" : [  ] } ] }